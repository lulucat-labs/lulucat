import{b as Fe}from"./chunk-I2R6SGZU.js";import{a as ot}from"./chunk-BAUTUSPJ.js";import{a as rt}from"./chunk-4TXBJTY4.js";import{a as ce}from"./chunk-YDKVBWIO.js";import{a as nt}from"./chunk-4PFFVHVY.js";import{a as le}from"./chunk-2QOKJOXY.js";import{c as $e,l as tt,m as se}from"./chunk-HNJT6VHX.js";import{a as et}from"./chunk-R6UCQXIY.js";import{a as ie}from"./chunk-DIVFRUSZ.js";import{a as at}from"./chunk-RIBJE2RV.js";import{b as Pe}from"./chunk-2AZAHALD.js";import{f as Ae}from"./chunk-APUK5GYS.js";import{d as G}from"./chunk-F4XZWNG2.js";import{b as me}from"./chunk-UNBGCT5E.js";import{j as Xe}from"./chunk-2LNDMD6C.js";import{h as je,i as Je}from"./chunk-KX7CSB3G.js";import{a as ae}from"./chunk-HZNY4MK4.js";import{h as re}from"./chunk-4HGOSSS7.js";import{e as Ze}from"./chunk-74FNJDB7.js";import{o as Rt}from"./chunk-AUURQ3HI.js";import{K as He,Na as q,Oa as xe,Pa as K,Qa as qe,Ra as Ke,Sa as Ye,Y as ve,cc as ne}from"./chunk-B32MCU7F.js";import{Ja as ee,Na as Ue}from"./chunk-N4B7HQY5.js";import{d as ze,f as Mt}from"./chunk-TKFT6XV3.js";import{I as P}from"./chunk-2BGRD7AD.js";import{c as Qe}from"./chunk-AIPMH74P.js";import{B as j,Ba as Be,Bc as Ge,Cc as Dt,Ib as De,Kb as v,Ob as we,Pb as Se,Rb as Me,V as be,_a as ye,aa as $,hc as ge}from"./chunk-Q23SA7M6.js";import{c as Re}from"./chunk-E44TZGUB.js";import{K as Z,f as Oe,oa as Le}from"./chunk-KBQXBPIW.js";import{O as Te,l as Ee,w as b}from"./chunk-364XNTHB.js";import{a as R}from"./chunk-PDSGFBX4.js";import{T as Ne,V as Ve,_ as oe,aa as _e,t as Ie,u as We,v as te}from"./chunk-GAMT4PKF.js";import{b as Gt}from"./chunk-TKZ7N5JX.js";import{f as _,o as s,q as c}from"./chunk-FJHLV356.js";s();c();var ke=_(R());s();c();var z=_(R());ye();s();c();var it=_(ne());s();c();Mt();function pe(e){return async()=>await ze().handleTxBySigner(e)}ye();function zt({walletId:e,method:r,message:a,onConfirm:n}){let o=(0,it.useDispatch)();return async()=>{let i=await o(pe({walletId:e,localType:$,method:r,params:{message:a}})),{publicKey:l,signature:p}=i||{},m=Ke(qe(l),p);return n(m)}}var st=zt;var ct=e=>{let{walletId:r,method:a,params:n,source:o,onConfirm:t,onCancel:i}=e,l=o==="dapp",[p,m]=(0,z.useState)({}),u=typeof n?.message=="string"?n?.message:new TextDecoder().decode(n?.message),d=st({walletId:r,method:a,message:u,onConfirm:t}),h,y,S;l||(h=d,y=!0,S=i);let T=le(e),N=G(Be)||{},g=ae(N?.localType,r),w=(0,z.useMemo)(()=>({method:a,dappData:JSON.stringify({message:u}),dappInfo:l?T:{},from:g,chainIndex:N.chainId}),[g]),C=re(r),D=rt({unapproved:e,onConfirm:h,onConfirmReplace:y,onCancel:S,preExecInfo:p}),A=ce({initialType:C.initialType}),M=(0,z.useMemo)(()=>[A()].filter(Boolean),[A]);return z.default.createElement(se,{preExecParams:w,buttonGroup:D,txType:tt.signMessage,handleCancel:S,walletAccount:C,onUpdatePreExecInfo:m,chainHeaderTips:M,localType:N?.localType,slot:{advanced:z.default.createElement(nt,{message:u})}})};s();c();var kt=_(R());s();c();var B=_(R()),ue=_(Rt());Le();Te();be();s();c();Te();var Ut=({feeLoading:e,estimateFailed:r,isSufficientGas:a,isSufficientBalance:n,onCancel:o,onConfirm:t,chainConfirmDisabled:i=!1,coinWithBalance:l={},preExecInfo:p={}})=>{let{isBalanceLoading:m}=l,d=i||e||r||(!a||!n)||p?.canConfirm===!1,{loading:h,onClick:y}=Pe(o),S={onClick:y,loading:h,actionType:Ae.ACTION_TYPE.CANCEL,btnText:b("wallet_dapp_connection_btn_reject")},{loading:T,onClick:N}=Pe(t),g={disabled:d,loading:T||m,onClick:N,actionType:Ae.ACTION_TYPE.CONFIRM};return{buttonGroup:[S,g],handleCancel:o}},lt=Ut;s();c();var E=_(R());Te();s();c();var J={root:"_root_b2owh_1",text:"_text_b2owh_4",currentChainText:"_currentChainText_b2owh_7",switchNetwork:"_switchNetwork_b2owh_12"};function Wt({origin:e,providerType:r,chainName:a,onClick:n,onClose:o,onNetworkChange:t}){let[i,l]=(0,E.useState)(!1);return E.default.createElement(Qe.Box,{className:J.root},E.default.createElement(Re,{closable:!1,desc:E.default.createElement("span",{className:J.text},E.default.createElement("span",{className:J.currentChainText},b("wallet_extension_approval_toast_current_switch",{network:a})),E.default.createElement("span",{className:J.switchNetwork,onClick:()=>{l(!0),n&&n()}},b("wallet_extension_approval_textbtn_current_switch")))}),E.default.createElement(Fe,{origin:e,visible:i,onClose:()=>{l(!1),o&&o()},onNetworkChange:t,providerType:r},E.default.createElement(Fe.Header,{title:b("wallet_extension_sonic_desc_switch_network")})))}var mt=Wt;s();c();Le();s();c();var x=_(R());ge();s();c();var pt=_(Gt());Dt();ge();async function ut(e){let{SolWallet:r}=await Xe(),a=new r,n=[];try{let o=(e||[]).filter(Boolean);o.length>0&&(n=await a.deserializeMessages({data:o}))}catch{}return(n||[]).reduce(({totalPriorityFee:o,priorityFees:t},i,l)=>{let{deserialized:p,computeUnitLimit:m,computeUnitPrice:u}=i||{};if(p){let d=Ye(m,u);o=v(o,d),t[l]=d}else t[l]="0";return{totalPriorityFee:o,priorityFees:t}},{totalPriorityFee:"0",priorityFees:[]})}var ft="SetComputeUnitLimit",Vt="SetComputeUnitPrice";function dt(e){let r=e.some(n=>{try{return oe.decodeInstructionType(n)===ft}catch{return!1}}),a=e.some(n=>{try{return oe.decodeInstructionType(n)===Vt}catch{return!1}});return{hasLimitInstruction:r,hasPriceInstruction:a}}function Ct(e,r,a){if(we(r||0,0)||we(a||0,0))return e;let{hasPriceInstruction:n,hasLimitInstruction:o}=dt(e);if(n)return e;let t=[...e],i=_e.setComputeUnitPrice({microLamports:r});if(t.unshift(i),o){let p=t.findIndex(m=>{try{return oe.decodeInstructionType(m)===ft}catch{return!1}});t.splice(p,1)}let l=_e.setComputeUnitLimit({units:a});return t.unshift(l),t}async function Ht(e,r,a){let n=new Ve(Ge.requestSolanaMethodUrlToFullnode);n._rpcRequest=ve;let o=await Promise.all((e.message?.addressTableLookups||[]).map(m=>n.getAccountInfo(m.accountKey).then(u=>new Ne({key:m.accountKey,state:Ne.deserialize(u.data)})))),t=We.decompile(e.message,{addressLookupTableAccounts:o}),{hasPriceInstruction:i}=dt(t.instructions);if(i)return q(e,K(e));t.instructions=Ct(t.instructions,r,a);let l=new te(t.compileToV0Message(o)),p=K(l);return q(l,p)}async function ht(e,r,a,n){return new Promise(o=>{try{let t=pt.base.fromBase58(e);try{t=Ie.from(t)}catch{t=te.deserialize(t)}if(!n){o(e);return}if(t instanceof Ie){t.instructions=Ct(t.instructions,r,a);let i=K(t);o(q(t,i))}else t instanceof te?Ht(t,r,a).then(o).catch(()=>{o(e)}):o(e)}catch{o(e)}})}function vt({coinId:e,transactions:r,address:a,replace:n,disabled:o,unitLimits:t,signInfo:i}){let[l,p]=(0,x.useState)(0),[m,u]=(0,x.useState)(null),[d,h]=(0,x.useState)([]),[y,S]=(0,x.useState)("0"),[T,N]=(0,x.useState)([]),[g,w]=(0,x.useState)(!1),C=m?.fee||"0",[D,A]=(0,x.useState)(r||[]),M=at(),F=G(e),{disabledSignInfo:V=!1,disabledPreExecute:U=!1}=o||{},O=L=>{p(L?f=>f+1:f=>f-1)};return(0,x.useEffect)(()=>{t&&h(t)},[t]),(0,x.useEffect)(()=>{i&&u(i)},[i]),(0,x.useEffect)(()=>{(async function(){if(!(V||!e)){O(!0);try{let{data:f={}}=await He({coinId:e,address:a}),{info:k={}}=f;u(k),w(!1)}catch{w(!0)}finally{O(!1)}}})()},[a,e,V]),(0,x.useEffect)(()=>{(async function(){if(!(U||!e)&&!(!n||!F?.chainId)){O(!0);try{let f=await M({coinId:e,from:a,chainId:F.chainId,simulateTransactionParamList:(r||[]).map(({serializedMessage:k})=>({transaction:k,sigVerify:!1,replaceRecentBlockhash:!0}))});h(f.unitLimits),w(!1)}catch{w(!0)}finally{O(!1)}}})()},[r,n,a,F?.chainId,U,e]),(0,x.useEffect)(()=>{(async function(){if(!(n&&(!m||!d?.length))){O(!0);try{let f=r||[];n&&(f=await Promise.all(f.map(async(H,Q)=>{let{serializedMessage:X,whetherModified:Y,...de}=H,Ce=await ht(X,m.computeUnitPrice,d[Q],Y);return{...de,serializedMessage:Ce,whetherModified:Y}})));let{totalPriorityFee:k,priorityFees:fe}=await ut(f.map(({serializedMessage:H})=>H));S(k),A(f),N(fe),w(!1)}catch{w(!0)}finally{O(!1)}}})()},[r,n,m,d]),{loading:l>0,baseFee:C,totalPriorityFee:y,priorityFees:T,totalFee:v(De(C,(r||[]).length),y),signInfo:m,estimateFailed:g,replacedTransactions:D}}var Tt=vt;ge();var qt=({from:e,coinId:r,preExecInfo:a,walletId:n,transactions:o,addPriorityFee:t})=>{let i=a?.loading,l=a?.unitGasLimitList||[],p=l.find(F=>Z(F)||Me(F,"0")),{loading:m,totalFee:u,baseFee:d,priorityFees:h,estimateFailed:y,signInfo:S,replacedTransactions:T}=Tt({coinId:r,transactions:o||[],address:e,replace:t,unitLimits:l,disabled:{disabledPreExecute:!0}}),N=S?.solRent||"0",g=y||!i&&!!p,w=et(r,n)||{},{coinAmountInt:C}=w,D=Z(C)||Se(C,u)||i,A=Z(C)||Se(C,v(u,N))||i;return{loading:m,networkFeeProps:{loading:m,networkFee:u,estimateFailed:g,coinId:r},isSufficientGas:D,baseFee:d,priorityFees:h,networkFee:u,estimateFailed:g,estimateFailedMsg:p?.msg,isSufficientBalance:A,selfRent:N,replacedTransactions:T,coinWithBalance:w}},yt=qt;function Kt({txId:e,coinId:r,walletId:a,transactions:n=[],dappInfo:o={},showDappInfo:t=!0,addPriorityFee:i=!0,showSwitchNetwork:l=!0,onConfirm:p,onCancel:m,onAddressCopy:u=Oe,onNetworkChange:d,method:h}){let y=me(j),S=r||y?.coinId,T=G(S)||{},N=T.localType,g=re(a),w=ae(N,a),[C,D]=(0,B.useState)({}),A=(0,B.useMemo)(()=>n.map(W=>{try{if(W.serializedMessage)return W;let he=K(W);return{instanceType:he,serializedMessage:q(W,he),needToReplaceRecentBlockhash:!W.recentBlockhash}}catch{return null}}).filter(Boolean),[n.length]),{networkFee:M,isSufficientGas:F,networkFeeProps:V,estimateFailed:U,estimateFailedMsg:O,loading:L,isSufficientBalance:f,selfRent:k,replacedTransactions:fe,coinWithBalance:H}=yt({from:w,coinId:S,walletId:a,transactions:A,addPriorityFee:i,preExecInfo:C}),Q=(0,ue.useMemoizedFn)(()=>!f&&F?{message:b("walletextension_toast_text_reserve_rent_exempt",{number:Ee.div(k,10**T?.decimals)}),level:761}:null),X=ce({initialType:g.initialType}),Y=(0,ue.useMemoizedFn)(()=>C?.needFillUp?{message:b("wallet_extension_trade_text_insufficient_funds_sol"),level:770,type:$e.FEE_BALANCE_INSUFFICIENT,txId:e,coinId:T?.coinId,address:w,walletId:a}:null),de=(0,B.useMemo)(()=>[Q(),X(),Y()].filter(Boolean),[Q,X,Y]),Ce=(0,B.useMemo)(()=>({dappData:JSON.stringify(A.map(W=>({transaction:W.serializedMessage,sigVerify:!1,replaceRecentBlockhash:!0}))),from:w,dappInfo:t?o:{},chainIndex:T?.chainId,method:h,forceLoading:!0}),[T?.chainId]),Lt=(0,ue.useMemoizedFn)(async()=>{await p({serviceCharge:M,replacedTransactions:fe,serializedTransactions:A})}),{handleCancel:Et,buttonGroup:bt}=lt({feeLoading:L,estimateFailed:U,isSufficientGas:F,isSufficientBalance:f,onCancel:m,onConfirm:Lt,chainConfirmDisabled:Ze(g.initialType),coinWithBalance:H,preExecInfo:C}),Bt={txId:e,baseCoin:T,estimateFailed:U,isSufficientBalance:f,isSufficientGas:F,estimateFailedMsg:O,coinWithBalance:H};return B.default.createElement(se,{slot:{top:l&&B.default.createElement(mt,{providerType:j,chainName:T?.chainName,onNetworkChange:d})},chainHeaderTips:de,networkFeeProps:V,preExecParams:Ce,onAddressCopy:u,walletAccount:g,handleCancel:Et,buttonGroup:bt,localType:T?.localType,txState:Bt,onUpdatePreExecInfo:D})}var wt=Kt;s();c();var St=_(R()),gt=_(ne());Ue();function Yt({walletId:e,localType:r,id:a,origin:n}){let o=(0,gt.useDispatch)(),t=ie(e);return(0,St.useCallback)(async()=>{t({trade:"contract_interaction",all_confirmation:"cancel",network:r,dapp_url:n}),await o(je(a)),await ee(o)},[t,a,r,n])}var It=Yt;s();c();var Nt=_(R()),_t=_(ne());Ue();function jt({coinId:e,id:r,walletId:a,localType:n,origin:o}){let t=(0,_t.useDispatch)(),i=ie(a);return(0,Nt.useCallback)(async({replacedTransactions:l,serviceCharge:p})=>{let m={coinId:e,replacedTransactions:l,serviceCharge:p};i({page_type:"contract_interaction",all_confirmation:"confirm",network:n,dapp_url:o}),await t(Je(r,m)),await ee(t)},[i,n,o])}var xt=jt;s();c();be();function Jt(e){let a=me(j)?.coinId,{coinId:n,showSwitchNetwork:o=!0}=e?.params?.extParams||{};return{coinId:n||a,showSwitchNetwork:o}}var At=Jt;s();c();var Pt=_(ne());ye();function Qt({coinId:e,walletId:r,method:a,okxArgs:n,onConfirm:o}){let t=(0,Pt.useDispatch)();return async({replacedTransactions:i,serviceCharge:l,serializedTransactions:p})=>{let d=await t(pe({walletId:r,localType:$,method:a,params:{message:p,okxArgs:n},extraParams:{coinId:e,replacedTransactions:i,serviceCharge:l}})),h;if(a===P.SIGN_ALL_TRANSACTIONS)h=(d.signedTransactionResults||[]).map(({serializedTransaction:y,type:S})=>xe(y,S));else if(a===P.SIGN_TRANSACTION){let{instanceType:y}=p[0]||{};h=xe(d.serializedTransaction,y)}else a===P.SIGN_AND_SEND_TRANSACTION&&(h=d);return o(h)}}var Ft=Qt;var Ot=e=>{let{id:r,coinId:a,method:n,params:o,walletId:t,origin:i,source:l,dappInfo:p,showDappInfo:m=!0,addPriorityFee:u=!0,showSwitchNetwork:d,onConfirm:h,onCancel:y,onAddressCopy:S,okxArgs:T}=e,{coinId:N,showSwitchNetwork:g}=At(e),w=le(e),C=a||N,A=(G(C)||{}).localType,M=o?.message||[],F=xt({coinId:C,id:r,walletId:t,localType:A,origin:i}),V=It({walletId:t,localType:A,id:r,origin:i}),U=ot({walletId:t}),O=Ft({coinId:C,walletId:t,method:n,okxArgs:T,onConfirm:h}),L,f,k;return l==="dapp"?(L=F,f=V,k=U):(L=O,f=y,k=S),kt.default.createElement(wt,{method:n,coinId:C,showSwitchNetwork:typeof d=="boolean"?d:g,txId:r,walletId:t,transactions:M,dappInfo:p||w,showDappInfo:m,addPriorityFee:u,onConfirm:L,onCancel:f,onAddressCopy:k})};function Xt(e){switch(e.method){case P.SIGN_TRANSACTION:case P.RPC_SIGN_TRANSACTION:case P.SIGN_AND_SEND_TRANSACTION:case P.RPC_SIGN_AND_SEND_TRANSACTION:case P.SIGN_ALL_TRANSACTIONS:case P.RPC_SIGN_ALL_TRANSACTIONS:return ke.default.createElement(Ot,{...e});case P.SIGN_MESSAGE:case P.RPC_SIGN_MESSAGE:return ke.default.createElement(ct,{...e});default:return""}}var dr=Xt;export{ut as a,dr as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-QEWWDRCI.js.map
