import{w as ae}from"./chunk-UW2D7AS7.js";import{a as w,b as ce,d as P}from"./chunk-WRZIZFIL.js";import{c as pe,i as Ce}from"./chunk-DPRLOZH7.js";import{a as ne,h as ue,i as le,j as ge}from"./chunk-DEQWBIFF.js";import{a as me}from"./chunk-KOPPPKVA.js";import{a as de,b as fe}from"./chunk-F5ELBQNP.js";import{a as ie}from"./chunk-HZPID3WW.js";import{o as Re}from"./chunk-AUURQ3HI.js";import{C as ee,Eb as oe,Kb as se,cb as te,cc as Ue,db as re,tb as q,y as Be}from"./chunk-B32MCU7F.js";import{la as X,ma as ye}from"./chunk-N4B7HQY5.js";import{Ac as De,Bc as Z,Cc as Me,Ib as Q,Kb as v,Lb as V,hc as Te,yc as Y}from"./chunk-Q23SA7M6.js";import{G as _,f as K,ka as G,m as E,oa as J}from"./chunk-KBQXBPIW.js";import{a as ke}from"./chunk-PDSGFBX4.js";import{f as x,o as S,q as b}from"./chunk-FJHLV356.js";S();b();J();var A=x(Be());Te();var Fe=(0,A.createSelectorCreator)(A.defaultMemoize,_),xe=Fe(i=>{let{createdMap:s={},needSyncMap:n={}}=i.metamask;return{createdMap:s,needSyncMap:n}},q,({createdMap:i,needSyncMap:s},n)=>{let d=Boolean(i[n]),u=Boolean(s[n]);return!(!d||u)}),Ee=(0,A.createSelector)(xe,le,q,i=>i.metamask?.walletConfig?.currentNetworkUniqueId||"",oe,ae,ue,te,re,ee,se,(i,s,n,d,u,g,l,T,W,y,M)=>{let I=null;y?.length&&s?.[n]&&(I=ge({isReady:s[n]?.coins&&i,defaultBaseCoinsCoinIds:l.size>0?Array.from(l):[],addedCoins:T[n]??[],reducedCoins:W[n]??[],balanceCoins:s[n]?.coins??[],defi:s[n]?.defi,nft:s[n]?.nft,networks:y.map(m=>({chainId:m})),hiddenSmallAssets:M,customFilter:({chainId:m})=>d===""||m===Number(d)}));let c="0",B="0",U="0",D="0",R="0",F="0";if(I){let{tokenTotalAssetsUSD:m,defiTotalAssetsUSD:t,nftTotalAssetsUSD:p,smallTotalAssetsUSD:r,platformTotalAssetsUSD:e}=I;D=p,R=t,F=m,U=e,c=m,c=V(c,r),g&&(c=v(c,D)),c=v(c,t),B=c,c=Q(c,u?.usdToThisRate??"1")}else return{walletAsset:"--",walletAssetUSD:"--",platformAssetUSD:"--",nftBalanceUSD:"--"};return{walletAsset:c,walletAssetUSD:B,platformAssetUSD:U,nftBalanceUSD:D,defiBalanceUSD:R,tokenBalanceUSD:F}}),je=Ee;S();b();ye();var Pe={light:"light",dark:"dark"},z=X({name:"activityBanners",initialState:{bannerList:[]},reducers:{setBannerList:(i,s)=>{let{allData:n,closedBanners:d,theme:u}=s.payload,g=n;d?.length>0&&(g=n.filter(l=>!d.find(T=>T===l.id))),i.bannerList=g.map(l=>({...l,img:u===Pe.dark?l.nightLogo:l.dayLogo}))}}}),{setBannerList:Ge}=z.actions,Je=z.reducer,Qe=i=>i[z.name].bannerList;S();b();var k=x(ke()),Ie=x(Ue()),a=x(Re());J();Me();De();var N=300,mn=()=>{let i=ie(),s=(0,Ie.useDispatch)(),n=pe(i),d=me(),u=(0,k.useRef)({}),g=(0,k.useRef)({}),l=(0,k.useRef)({}),{data:T,set:W}=de(fe.coinTickers),y=Ce();(0,k.useEffect)(()=>{s(ne(y))},[s,y]);let M=t=>{W({...T,...t})},I=(0,a.useMemoizedFn)(async t=>{let p=E(t,N),r=[];try{(await Promise.all(p.map(o=>{let O=o.filter(h=>l.current[h]),f={coinIds:o,aggregationCoinIdList:O},C={headers:{currency:"usd"}};return Y(Z.postMarketUrl,f,C)})))?.forEach(o=>{Array.isArray(o?.data)&&(r=r.concat(o.data))})}catch{K()}r.forEach(e=>{e?.coinId&&(g.current[e.coinId]={coinToUSDRate:e?.currencyAmount,coinPriceChangePercent24h:e?.priceChangePercent24h,priceCoinId:e?.priceCoinId,anchorStatus:e?.anchorStatus??null})}),M(g.current)}),{needFetchCoinIds:c,needFetchData:B}=(0,a.useCreation)(()=>{if(n.length||d.length){let t=n.concat(d).filter(e=>Boolean(e?.coinId));return G(t,"coinId").reduce((e,o)=>(e.needFetchCoinIds.push(o.coinId),e.needFetchData.push({coinId:o.coinId,baseCoinId:o?.baseCoinId,chainIndex:o?.chainId,tokenAddress:o?.address,aggregation:o?.aggregation}),e),{needFetchCoinIds:[],needFetchData:[]})}return{needFetchCoinIds:[],needFetchData:[]}},[n,d]),U=(0,a.useMemoizedFn)(t=>{if(!t?.length)return;let{coinIdToInstIdMap:p,coinIdAggregationMap:r}=t.reduce((f,C)=>{let{coinIdToInstIdMap:h,coinIdAggregationMap:j}=f,{coinId:$,baseCoinId:Se,chainIndex:H,tokenAddress:be,aggregation:Ae}=C,L="";return Se===0?L=`${H}`:L=`${H}-${be}`,h[$]=L,j[$]=Ae,{coinIdToInstIdMap:h,coinIdAggregationMap:j}},{coinIdToInstIdMap:{},coinIdAggregationMap:{}});l.current=r;let e=[],o=Object.entries(p).reduce((f,[C,h])=>(u.current[C]||(u.current[C]=h,e.push(C),f.push({channel:P,instId:h})),f),[]);E(o,N).forEach(f=>{w.sendChannel({op:"subscribe",args:f})}),e.length&&I(e)}),{run:D}=(0,a.useDebounceFn)(U,{wait:200}),{run:R}=(0,a.useDebounceFn)(()=>{M(g.current)},{wait:1e3}),F=(0,a.useMemoizedFn)(()=>{I(Object.keys(u.current))}),m=(0,a.useMemoizedFn)(t=>{if(!t||!Array.isArray(t?.data))return;let{data:p}=t,r=p[0];if(r?.coinId){let e=r.coinId,o=g.current[e];g.current[e]={...o,coinToUSDRate:r.price,coinPriceChangePercent24h:r.priceChangePercent24h},R()}});ce(P,{onError:F,onSuccess:m,pollingInterval:30*1e3}),(0,a.useDeepCompareEffect)(()=>{D(B)},[c]),(0,a.useUnmount)(()=>{let t=Object.values(u.current).map(r=>({channel:P,instId:r}));E(t,N).forEach(r=>{w.sendChannel({op:"unsubscribe",args:r})}),u.current={}})};export{Ge as a,Je as b,Qe as c,mn as d,xe as e,je as f};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-ISNSSIZJ.js.map
