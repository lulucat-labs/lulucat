import{b as Gt,d as jt}from"./chunk-QBO66WYA.js";import{b as Ht,c as Vt}from"./chunk-MSEKW37V.js";import{a as Kt}from"./chunk-LVFFHQXT.js";import{a as Ue}from"./chunk-N5KXYLI6.js";import{a as Be}from"./chunk-G6PPKZHQ.js";import{a as oe}from"./chunk-2P7I7CKT.js";import{b as Pt,c as ht,d as gt,e as kt,f as Tt,g as Et,l as xt,m as Ct,n as St,o as At}from"./chunk-BETSGZLN.js";import{a as We,b as Dt}from"./chunk-KPMUK7JJ.js";import{T as nt,d as at,e as it,m as X}from"./chunk-ZV6IBWDM.js";import{a as Lt,c as Rt,d as zt}from"./chunk-G7B74XXT.js";import{a as te}from"./chunk-YYUUDQVK.js";import{a as vt}from"./chunk-HJB4XHU5.js";import{a as Mt,b as Wt,c as Bt,d as Ut,e as Ot}from"./chunk-QR7BG2TV.js";import{h as st}from"./chunk-AKJZXDVD.js";import{a as Ft}from"./chunk-GOMM7VSE.js";import{l as ct,m as mt,n as pt,o as dt}from"./chunk-LTMEFQRN.js";import{b as Pe,c as he}from"./chunk-MSUJSPID.js";import{h as v,i as D}from"./chunk-TU5XNYNZ.js";import{a as we}from"./chunk-MZFOYMI4.js";import{C as ft,F as Me,L as ut,Ta as yt,a as j,ha as _t,hb as wt,y as fe}from"./chunk-WSXZYUQ4.js";import{q as O}from"./chunk-IRNZUYU4.js";import{o as ne}from"./chunk-AUURQ3HI.js";import{cc as _e,sb as It,wb as ue}from"./chunk-B32MCU7F.js";import{a as ie}from"./chunk-VLKJDIZ5.js";import{d as b,f as de}from"./chunk-TKFT6XV3.js";import{c as B,d as bt,e as ye,g as ee}from"./chunk-ZWQEMYA4.js";import{g as Nt}from"./chunk-ELX2GHLL.js";import{c as g}from"./chunk-AIPMH74P.js";import{Uc as lt,_c as Ro,ic as me,jc as Do,kc as pe,m as Ze,n as qe,o as Je,q as be,qc as Qe,u as ce,z as Le}from"./chunk-Q23SA7M6.js";import{D as Q,H as ae,d as tt,o as ot,q as J,r as rt}from"./chunk-E44TZGUB.js";import{F as le,M as $e,l as Ke,o as Ye,oa as Ne}from"./chunk-KBQXBPIW.js";import{O as se,w as p}from"./chunk-364XNTHB.js";import{H as Fo,T as Xe,U as et,ca as h}from"./chunk-W7JONHX2.js";import{a as G}from"./chunk-PDSGFBX4.js";import{f,o as r,q as s}from"./chunk-FJHLV356.js";r();s();var T=f(G()),Ce=f(_e()),ze=f(ie()),Z=f(ne());se();de();r();s();var V=f(G()),ge=f(ne());de();Do();Le();r();s();r();s();function zo(){}var Yt=zo;var $t=Yt;r();s();var F=f(G());se();r();s();var K={root:"_root_15akf_1",image:"_image_15akf_4",title:"_title_15akf_7",desc:"_desc_15akf_15",btns:"_btns_15akf_23","cancel-width":"_cancel-width_15akf_26",cancelWidth:"_cancel-width_15akf_26"};function Oe({type:t,step:o,onCancel:e,onRetry:a}){let l=Nt({light:"./static/images/passkey-light-big.png",dark:"./static/images/passkey-dark-big.png"}),i={["create"]:{title:{text:"wallet_extension_biometrics_drawer_title_verification",keys:{num:1,total:2},color:"var(--okd-color-content-primary)"},desc:"wallet_extension_biometrics_drawer_desc_verification",cancel:"commonall_text_btn_cancel",onCancel:e},["verify"]:{title:{text:t==="create"?"wallet_extension_biometrics_drawer_title_verification":"wallet_extension_biometrics_drawer_title_unlock",keys:{num:2,total:2},color:"var(--okd-color-content-primary)"},desc:t==="create"?"wallet_extension_biometrics_drawer_desc_verification":"wallet_extension_biometrics_drawer_desc_unlock",cancel:"commonall_text_btn_cancel",onCancel:e},["error"]:{title:{text:"wallet_extension_biometrics_drawer_title_fail_setup",color:"var(--okd-color-semantic-negative)"},desc:"wallet_extension_biometrics_drawer_desc_fail_setup",confirm:"commonall_emptystate_text_try_again",onConfirm:a,cancel:"commonall_text_btn_cancel",onCancel:e},["init"]:null,["success"]:null}[o];return i?F.default.createElement(g.Container,{className:K.root},F.default.createElement(g.FlexBox,{className:K.image,align:g.ALIGN.center,justify:"center"},F.default.createElement(tt,{src:l,width:120,height:120})),F.default.createElement(O.Text,{strong:700,className:K.title,style:{color:i.title.color}},p(i.title.text,i.title.keys)),F.default.createElement(O.Text,{strong:400,className:K.desc},p(i.desc)),F.default.createElement(g.FlexBox,{className:K.btns,align:g.ALIGN.center,justify:"center"},F.default.createElement(h,{block:i.confirm,category:h.CATEGORY.fill,type:h.TYPE.gray,size:h.SIZE.lg,onClick:()=>{i.onCancel()},className:vt({[K.cancelWidth]:!i.confirm})},p(i.cancel)),i.confirm?F.default.createElement(h,{block:!0,category:h.CATEGORY.fill,type:h.TYPE.highlight,size:h.SIZE.lg,onClick:()=>{i.onConfirm()}},p(i.confirm)):null)):null}function Y(){let[t]=he(Pe.credentialId),[o,e]=(0,V.useState)("init"),[a,l]=(0,V.useState)("init"),n=(0,V.useRef)(null),i=(0,V.useRef)(y=>y),w=async(y,d)=>{try{l("create"),e("create"),i.current=y,await Be(500);let{password:M,credential:A,credentialId:N}=await Bt(d??"");e("verify");try{await Ut({credential:A,password:M})}catch(z){$t(),e("error"),await y(null,z);return}n.current?.destroy(),e("success"),await y({password:M,credentialId:N})}catch(M){e("error"),await y(null,M)}},c=async y=>{try{l("verify"),e("verify"),i.current=y;let{password:d}=await Ot(t);await b().verifyPassword(d),n.current?.destroy(),e("success"),await y(!!d)}catch{e("error"),await y(!1)}},E=()=>{e("init"),l("init"),n.current?.destroy()},S=()=>{a==="create"&&w(i.current),a==="verify"&&c(i.current)},I=async()=>{me()!==ce&&(n.current||(n.current=ot.action({mask:!1})),await Be(100),n.current.update({visible:!0,mask:!0,onClose:()=>{E()},children:V.default.createElement(Oe,{step:o,type:a,onRetry:()=>{S()},onCancel:()=>{E()}})}))};return(0,ge.useUpdateEffect)(()=>{if(o==="init"||o==="success"){n.current?.destroy();return}I()},[o]),(0,ge.useUnmount)(()=>{n.current?.destroy()}),{create:w,verify:c}}Qe();Le();r();s();var x=f(G()),Te=f(ne());se();r();s();var ke={root:"_root_cl85f_1",passwordInput:"_passwordInput_cl85f_6"};var Zt=({onBack:t,onComplete:o})=>{let l=oe().get("from")===_.HARDWARE,n=Q.useForm(),[i,w]=(0,x.useState)({}),[c,{setTrue:E,setFalse:S}]=(0,Te.useBoolean)(!1),I=!i.password||!i.confirm||i.password?.length<We||i.confirm?.length<We||i.password!==i.confirm,y=(0,Te.useMemoizedFn)(async()=>{let{password:A,confirm:N}=i;if(!(c||I)){if(A!==N){n.setErrors({confirm:p("wallet_settings_reset_passord_errortip_input_error")});return}nt(),E(),await o(N),S()}},[I,i]),d=(0,x.useCallback)(async A=>{(A?.key==="Enter"||A?.keyCode===13)&&await y()},[]),M=Vt();return(0,x.useEffect)(()=>(document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)}),[]),x.default.createElement(Ht,{className:ke.root,title:p("wallet_signup_maintitle_set_password"),desc:p(l?"wallet_extension_signup_subtitle_set_password_hardware":"wallet_extension_subtitle_password_unlock"),onBack:t},({formClass:A,formErrorClass:N,itemClass:z})=>x.default.createElement(Q,{form:n,size:J.SIZE.lg,validateTrigger:["onChange","onBlur"],className:A,errorClassName:N,onValuesChange:(H,W)=>{w(W)}},x.default.createElement(Q.Item,{name:"password",style:{marginBottom:0},className:z,label:p("wallet_set_password_subtitle_password")},x.default.createElement(J.Password,{autoComplete:"off",size:J.SIZE.xl,inputClassName:ke.passwordInput,placeholder:p("wallet_settings_reset_passord_placeholder_input_desc")})),x.default.createElement(Q.Item,{noStyle:!0,shouldUpdate:(H,W)=>H.password!==W.password},({getFieldValue:H})=>{let W=H("password");return x.default.createElement(Dt,{password:W})}),x.default.createElement(Q.Item,{name:"confirm",className:z,label:p("wallet_settings_reset_passord_subtitle_password_confirmation"),style:{flex:1,marginTop:"32px"}},x.default.createElement(J.Password,{autoComplete:"off",size:J.SIZE.xl,inputClassName:ke.passwordInput,placeholder:p("wallet_settings_reset_passord_placeholder_input_password_confirmation"),onChange:()=>{n.cleanErrors("confirm")}})),x.default.createElement(we.FooterActions,{usePortal:!0,renderNative:!0,affixStyle:M,buttonGroup:[{loading:c,disabled:I,block:!0,type:h.TYPE.highlight,category:h.CATEGORY.fill,size:h.SIZE.lg,btnText:p("wallet_set_password_btn_confirm"),onClick:y}]})))};r();s();r();s();var L=f(G());var qt=f(Fo());se();r();s();var R={content:"_content_1cywj_1",title:"_title_1cywj_4",desc:"_desc_1cywj_12",list:"_list_1cywj_19",item:"_item_1cywj_22","item-select":"_item-select_1cywj_39",itemSelect:"_item-select_1cywj_39","item-content":"_item-content_1cywj_42",itemContent:"_item-content_1cywj_42","item-title":"_item-title_1cywj_46",itemTitle:"_item-title_1cywj_46","item-desc":"_item-desc_1cywj_54",itemDesc:"_item-desc_1cywj_54",link:"_link_1cywj_61",anchor:"_anchor_1cywj_65",icon:"_icon_1cywj_66"};function ve({list:t,active:o,history:e}){return L.default.createElement(L.default.Fragment,null,t.map(a=>L.default.createElement(g.FlexBox,{className:(0,qt.default)(R.item,{[R.itemSelect]:o(a.type)}),direction:g.DIRECTION.horizontal,align:g.ALIGN.center,justify:"space-between",onClick:()=>{a.onClick()}},L.default.createElement(g.Box,{className:R.itemContent},L.default.createElement(O.Text,{className:R.itemTitle},p(a.title)),L.default.createElement(O.Text,{className:R.itemDesc},p(a.desc)),a.link?L.default.createElement(g.FlexBox,{className:R.link,direction:g.DIRECTION.horizontal,align:g.ALIGN.center},L.default.createElement(et,{alt:p(a.link.text),rel:"nofollow",onClick:l=>{l.stopPropagation(),l.preventDefault(),st(),e.push(a.link.url)},className:R.anchor},p(a.link.text)),L.default.createElement(Xe,{iconName:"okds-arrow-chevron-right-centered-md",className:R.icon})):null,a.bottomElement??null),o(a.type)?L.default.createElement(rt.Circle,{checked:!0}):null)))}var Jt=ve;r();s();var Xt=f(G()),De=f(_e()),eo=f(ie());se();r();s();var Qt={"recommend-label":"_recommend-label_1iacj_1",recommendLabel:"_recommend-label_1iacj_1"};function to(){let t=(0,eo.useHistory)(),o=(0,De.useSelector)(ue),e=(0,De.useSelector)(It);o&&!e&&t.replace(j)}var oo=({handleClickPasskey:t,handleClickPassword:o,completedOnboarding:e,passwordType:a})=>[{type:2,title:"wallet_extension_biometrics_radio_title_authentication",desc:"wallet_extension_biometrics_radio_desc_authentication",onClick:t,bottomElement:Xt.default.createElement("div",{className:Qt.recommendLabel},p("wallet_biometrics_tag_recommend"))},{type:1,title:"wallet_extension_biometrics_radio_title_password",desc:"wallet_extension_biometrics_radio_desc_password",onClick:o,link:e&&a===1?{url:fe,text:"wallet_extension_biometrics_btn_change_password"}:null}],ro=async({result:t,modifyPassword:o})=>{let e=!1;return e=await o(t?.password),e},so=!1,ao=async()=>await Mt(),io=t=>{};r();s();var $={root:"_root_mpzi1_1",content:"_content_mpzi1_4",title:"_title_mpzi1_7",desc:"_desc_mpzi1_15",list:"_list_mpzi1_22",item:"_item_mpzi1_25","item-select":"_item-select_mpzi1_32",itemSelect:"_item-select_mpzi1_32","item-title":"_item-title_mpzi1_35",itemTitle:"_item-title_mpzi1_35","item-desc":"_item-desc_mpzi1_43",itemDesc:"_item-desc_mpzi1_43",link:"_link_mpzi1_50",anchor:"_anchor_mpzi1_54",icon:"_icon_mpzi1_55",forgot:"_forgot_mpzi1_67"};r();s();r();s();function Ho(){let{verify:t}=Y();return async e=>{await t(a=>{a&&e()})}}var no=Ho;var lo=no;r();s();var Po=f(G()),Ee=f(_e()),ho=f(ie());Ne();de();r();s();Ne();de();var Re={[ye.addAccount]({hardware:t,account:o,baseChain:e,walletId:a}){return b().addHardwareWalletAccount(t,o,e,a)},[ye.addChain]({account:t,baseChain:o,walletId:e}){return b().addChainForHardwareWallet(t,o,e)},others({hardware:t,account:o,baseChain:e}){return b().importHardwareWalletAccount(t,o,e)}},Vo={async[B.ledger](t){let{otherInfo:o}=t,{ledgerInfo:e}=o;t.hardwareWalletModel=e.productName||ee[B.ledger]},[B.trezor](t){t.hardwareWalletModel=ee[B.trezor]},[B.keystone](t){let{otherInfo:o}=t,{keystoneInfo:e}=o;t.hardwareWalletModel=e.device||ee[B.keystone]},[B.onekey](t){let{otherInfo:o}=t,{onekeyInfo:e}=o,a=e?.deviceType?`${bt[B.onekey]} ${Ke(e?.deviceType)}`:"";t.hardwareWalletModel=a||ee[B.onekey]}},co=({accounts:t,hardware:o,baseChain:e,walletId:a,type:l,...n})=>async()=>{let i;for(let w=0;w<t.length;w++){let c=Ye(t[w]);c.otherInfo=n,await Vo[o](c),c.hardwareWalletType=ee[o];let E=Re[l];E||(i?.walletId?(l=ye.addAccount,a=i.walletId,E=Re[l]):E=Re.others);let S=await E({hardware:o,account:c,baseChain:e,walletId:a});i??=S}return i};r();s();var mo=f(ie()),po=f(ne());Ro();var Go=()=>{let t=(0,mo.useHistory)();return(0,po.useMemoizedFn)((...o)=>{let e=o[0];t.push({pathname:_t,search:`?type=${lt.INITIALIZE}`,...e!==void 0&&{state:{hasPassword:e}}})})},fo=Go;r();s();var _o=f(ie()),yo=f(ne());Ne();r();s();var uo="NEW_USER_JUST_SET";function jo(){let t=(0,_o.useHistory)(),{isSyncSupported:o,hasSyncEnabled:e,hasWalletDataOnCloud:a,isDataValidated:l}=Kt();return(0,yo.useMemoizedFn)(n=>o&&l&&$e(e)&&!a&&[_.CREATE,_.SEED,_.KEY].includes(n)?(t.replace({pathname:wt,search:`?user=${uo}&type=${n}`}),n):null)}var wo=jo;Qe();Le();var xe=t=>{let o=(0,ho.useHistory)(),e=(0,Ee.useDispatch)(),a=wo(),l=fo(),{seedPhrase:n,privateKey:i,mpcInfo:w,unlockHardwareWallets:c,chooseNetworkList:E,isTonMnemonic:S}=(0,Ee.useSelector)(m=>({seedPhrase:Pt(m),isTonMnemonic:Et(m),privateKey:ht(m),chooseNetworkList:Tt(m),mpcInfo:kt(m),unlockHardwareWallets:gt(m)})),{setValue:I}=jt(),{value:y}=Gt();(t===_.SEED&&!n||t===_.KEY&&!i||t===_.BULK&&!y||t===_.MPC&&(!w||le(w))||t===_.HARDWARE&&(!c||le(c)))&&o.push(j);let d=m=>{if(a(t))return;let C=`${Me}/${t}`,{keyringName:P="",walletName:q=""}=m||{},re=`${P}-${q}`;o.push({pathname:C,state:{walletName:re,anim:"1",next:j}})},M=async m=>{await e(ct(m)),await e(te()),a(t)||l(!0)},A=async m=>{let C=n?.trim().toLowerCase().match(/\w+/gu)?.join(" ")||"",P=await e(mt(m,{mnemonic:C,isTonMnemonic:S}));e(xt()),await e(te()),d(P)},N=async m=>{let C=await e(pt(m,{baseChains:E,privateKey:i}));e(Ct()),await e(te()),d(C)},z=m=>{I(m),o.push(yt)},H=async(m,C)=>{le(c)||(await b().setPassword(m,!0),await e(v(C?2:1)),await e(D(C)),await e(co(c)),await e(te()),e(St()));let P=`${Me}/${_.HARDWARE}`;pe()===Je&&globalThis.platform.openExtensionInPopup(`${P}?anim=1`)},W=async m=>{let{cipherText:C,privateKey:P,mpcId:q,userInfo:re}=w;if(C&&P&&q){let Ae=await e(dt(m,{cipherText:C,privateKey:P},{mpcId:q,userInfo:re},!0));e(At()),await e(te()),d(Ae)}},Se={[_.CREATE]:M,[_.SEED]:A,[_.KEY]:N,[_.BULK]:z,[_.HARDWARE]:H,[_.MPC]:W};return(0,Po.useCallback)(async(m,C)=>{try{await Se[t](m,C)}catch(P){ae.error(P.message?P.message:JSON.stringify(P))}},[t])};r();s();r();s();var go=f(_e());var Ko=()=>{let{create:t}=Y(),e=oe().get("from")||_.CREATE,a=xe(e),l=(0,go.useDispatch)();return async(...n)=>{await t(async i=>{if(i){let{password:w,credentialId:c}=i;await a(w,c),await l(v(2)),await l(D(c)),X({button_name:"biometric",platform:"extension"})}else await a(...n,null),await l(v(1)),await l(D(null))},...n)}},ko=Ko;var To=ko;var _={SEED:"seed",KEY:"key",HARDWARE:"hardware",CREATE:"create",MPC:"mpc",BULK:"bulk"},Yo=()=>{let t=(0,ze.useHistory)(),o=pe(),e=o===Ze||o===be,a=o===qe,l=o===be;return{openNotification:()=>{let{pathname:w,search:c}=t.location,E=c?"&":"?",S="openFromThisPage=1";globalThis.platform.openExtensionInPopup(`${w}${c}${E}${S}`,null,!l)},closeNotification:()=>{window.close()},needOpenNotification:e,isNotification:a}};function $o(){let t=(0,ze.useHistory)(),o=(0,Ce.useDispatch)(),e=lo(),{needOpenNotification:a,isNotification:l,openNotification:n,closeNotification:i}=Yo(),w=()=>{a?t.goBack():t.push(j)},[c]=he(Pe.passwordType),[,E]=Lt(),[S,I]=(0,T.useState)(2),y=me()===ce?"telegram":"extension";(0,Z.useMount)(async()=>{await Wt()||I(1)});let d=(0,Ce.useSelector)(ue);to();let[M,A]=(0,T.useState)(!1);(0,Z.useAsyncEffect)(async()=>{try{if(await ao(d))return;let U=d?ut:ft;t.replace({pathname:U,search:t.location.search})}finally{A(!0)}},[]);let N=oe(),z=N.get("from")||_.CREATE,H=xe(z),W=N.get("openFromThisPage")==="1",Se=k=>d?c===k:S===k,[He,{toggle:m}]=(0,Z.useToggle)(!1),[C,{toggle:P}]=(0,Z.useToggle)(!1),q=Ue(at),re=Ue(it),{create:Ae,verify:Eo}=Y(),xo=To(),Co=async()=>{if(a){n();return}xo()},So=async()=>{P()},Ao=async k=>{await Ae(async U=>{if(U){let je=!1,vo=U?.credentialId;m(),je=await ro({result:U,modifyPassword:b().modifyPassword}),je&&(ae.success(p("wallet_edit_wallet_toast_renamed_success")),await o(v(2)),E(!0),await o(D(vo)),X({button_name:"biometric",platform:y}),l&&W&&i())}},so?k:"")},Ve=async k=>{let U=null;k?(P(),U=await b().modifyPassword(k)):U=!0,U&&(ae.success(p("wallet_edit_wallet_toast_renamed_success")),await o(v(1)),E(!0),await o(D(void 0)),X({button_name:"password",platform:y}),l&&W&&i())},Io=()=>{if(!d){I(2);return}if(d&&c===2){t.goBack();return}if(a){n();return}m()},No=async()=>{if(!d){I(1);return}if(d&&c===1){t.goBack();return}if(a){n();return}await Eo(k=>{k&&P()})},bo=()=>{m()},Lo=async()=>{await e(P,Ve)},[Mo,Ie]=(0,T.useState)(!1),Wo=async()=>{try{Ie(!0),S===2?(await Co(),q()):(await So(),re())}catch{Ie(!1)}finally{Ie(!1)}},Ge=async k=>{io(k),k?bo():Lo()},Bo=()=>{t.push({pathname:fe})},Uo=()=>oo({handleOpenVerify:Ge,handleSetPassword:Bo,handleClickPasskey:Io,handleClickPassword:No,completedOnboarding:d,passwordType:c});if(!M)return null;if(He)return T.default.createElement(zt,{onBack:m,callback:Ao});if(C)return T.default.createElement(Zt,{onBack:P,onComplete:async k=>{d?await Ve(k):(await H(k),await o(v(1)),await o(D(void 0)),X({button_name:"password",platform:y}))}});let Oo={list:Uo(),active:Se,passwordType:c,history:t,handleOpenVerify:Ge};return T.default.createElement(g.Box,{className:$.root},T.default.createElement(Ft,{bordered:!1,closeable:!1,onBack:w}),T.default.createElement(g.Container,{className:$.content},T.default.createElement(O.Text,{className:$.title},p("wallet_extension_biometrics_header_title_unlock")),T.default.createElement(O.Text,{className:$.desc},p("wallet_extension_biometrics_desc_unlock")),T.default.createElement(g.Box,{className:$.list},T.default.createElement(Jt,{...Oo})),T.default.createElement(we.FooterActions,null,d?T.default.createElement(Rt,{className:$.forgot,strong:!0}):T.default.createElement(h,{block:!0,category:h.CATEGORY.fill,type:h.TYPE.highlight,size:h.SIZE.lg,loading:Mo,onClick:()=>{Wo()}},p("commonall_button_text_next")))))}export{co as a,fo as b,wo as c,To as d,_ as e,$o as f};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-ZLQG6XAC.js.map
