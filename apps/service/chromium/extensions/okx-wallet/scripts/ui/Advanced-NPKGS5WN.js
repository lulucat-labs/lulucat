import{a as Ui,b as Ji,c as dn,d as oe,e as pn,f as Fe,g as wn,h as re,i as Zr,j as se,k as ie,l as On,m as oo,n as Nn,o as Dn,p as Fn,r as xn,s as tr}from"./chunk-2UEAMWBZ.js";import"./chunk-4WN6OBDI.js";import{a as kn,b as Jo,c as Rn,d as bn,e as vn,f as Zo,g as Ln,h as Pn}from"./chunk-GA4UQZOX.js";import"./chunk-TC5Y3PWY.js";import{C as Ko,a as un,f as ee,g as ln,h as st,m as mn,n as hn,o as Sn,q as Tn,r as zr,t as Cn,z as In}from"./chunk-4JKSWKJD.js";import{a as Yr,b as Vt,c as an,d as cn,e as fn,i as jo,m as Xr}from"./chunk-PV5K2HOA.js";import{a as Jr}from"./chunk-OT3DBMMD.js";import{a as k,b as _}from"./chunk-KLQ5LRUF.js";import{a as rn,b as $r,c as Ut,f as yn,i as to,j as eo,n as $o,o as Yo,p as Xo,s as zo}from"./chunk-6WFUVR6N.js";import"./chunk-ALZKZKT7.js";import{a as te,b as sn,c as nn,e as An,f as _n,g as En}from"./chunk-RR6UKVVV.js";import{b as q}from"./chunk-DDR2PRIQ.js";import{a as D,b as qi,c as Y}from"./chunk-5NZYX7T6.js";import{b as Ct,c as qt,d as E}from"./chunk-H4BR5O6P.js";import"./chunk-QBAWFARF.js";import{a as $i}from"./chunk-FYV4ZBAP.js";import{a as Hi,e as ji}from"./chunk-L7GCSSD7.js";import"./chunk-TXAI4LDH.js";import"./chunk-4R7IARNY.js";import"./chunk-PDCHDYT2.js";import{b as Ho}from"./chunk-AZH4OWJP.js";import{a as R,b as Zt}from"./chunk-DPLPUTOK.js";import{a as Ki}from"./chunk-QTWRPB4V.js";import{a as Uo,b as Z,c as lt,d as Vi}from"./chunk-V4H2MEPY.js";import{a as gn}from"./chunk-WN5ZMYXK.js";import{E as zi,F as Kr,G as Ne,h as jr,l as Go,m as Yi,p as Oe,q as Wo,r as Xi}from"./chunk-WCLMZJ77.js";import{c as Qo,d as De,f as Zi,g as tn,h as en,i as on}from"./chunk-BNJC2TPG.js";import{a as Ot,b as we,d as Gi,e as vt,i as Wi,j as Qi,l as tt,m as Vo,o as Hr}from"./chunk-DQ2IBJ6G.js";import{b as h,d as cc}from"./chunk-IYVZOFWF.js";import{a as T,b as Qr,c as Bt,d as ht,f as J,g as Pe}from"./chunk-O43TNQSD.js";import{$,$b as Ai,A as Po,Ac as Ni,D as N,Dc as Di,E as ye,Ec as Fi,F as ke,Fc as xi,G as ti,Ga as Ur,Gc as Mi,H as Re,Ha as ai,I as Jt,Ia as wt,J as Nr,Jc as Bi,K as ze,L as ei,Lb as di,M as wo,Mb as li,Nb as mi,Oa as Vr,Ob as pi,P as K,Pa as Gr,Pb as hi,Q as bt,Qb as fi,R as Pt,Ra as Fo,Rb as Si,S as Dr,Sa as rt,Sb as gi,T as be,Tb as Mo,U as Oo,Ub as Ti,V as gt,W as No,X as oi,Zb as Ci,_ as Fr,_b as Ii,a as ko,aa as Tt,b as Ro,ba as ri,bb as Ze,bc as _i,c as Ke,cb as V,cc as Ei,d as $e,da as xr,db as C,dc as yi,e as bo,ea as si,f as Ye,fa as Do,fb as ci,g as Or,ga as Je,h as vo,i as Ee,ic as Bo,j as $s,k as Xe,l as Ys,mb as pt,nb as dt,o as nt,oa as z,ob as Wr,p as et,pa as _t,pc as ki,q as ot,qa as ve,qb as ui,qc as Ri,rc as qo,s as Xs,sa as Mr,sc as bi,t as zs,tc as vi,u as U,v as Lo,va as Br,vb as xo,vc as Li,w as Js,wa as qr,wb as w,wc as Pi,x as Zs,xa as ii,xc as wi,ya as ni,yb as Le,zc as Oi}from"./chunk-LUYLQDIU.js";import{a as Gs,b as Dt,e as ut,f as St,g as Ft,h as Ws,i as M,j as xt,k as B,l as Rt}from"./chunk-ZOUFDRHZ.js";import{a as je,b as Qs,c as Mt,d as Eo,e as Hs,f as js,g as Ks,m as yo,n as P}from"./chunk-QZXD2Q4G.js";import"./chunk-MFVLNWG5.js";import"./chunk-ROB5HGLC.js";import"./chunk-FYE3XUPR.js";import"./chunk-QCINCBGO.js";import{a as zt}from"./chunk-VLKJDIZ5.js";import"./chunk-XXICVAVV.js";import{G as Xt,H as b,k as Vs}from"./chunk-E44TZGUB.js";import{$ as xs,A as vs,B as Ls,D as Ps,F as H,I as ws,J as jt,K as We,N as Os,S as Ns,T as Ds,V as Fs,Y as Kt,c as X,f as kt,fa as $t,ga as vr,h as At,ha as Ms,i as Nt,j as I,ja as Qe,ka as Lr,la as Pr,na as He,oa as L,p as Rs,r as Io,u as bs,v as Ge,x as Ao,y as _o}from"./chunk-KBQXBPIW.js";import{D as y,K as Bs,M as qs,O as j,z as wr}from"./chunk-364XNTHB.js";import{ca as Yt,d as Us}from"./chunk-W7JONHX2.js";import"./chunk-O3LHCDGR.js";import{a as G}from"./chunk-PDSGFBX4.js";import"./chunk-CWRZ2WAJ.js";import"./chunk-OMIXKWD3.js";import"./chunk-PBODVK5S.js";import"./chunk-OENPHC74.js";import"./chunk-TNAXYRKK.js";import"./chunk-3CPUV3E7.js";import"./chunk-SHMKQUVK.js";import{f as x,h as s,o as u,q as d}from"./chunk-FJHLV356.js";u();d();var br=x(G()),ac=x(zt());u();d();var Bn=x(G());u();d();var er=x(G());var Mn=({children:a,rootStore:t})=>{let e=qi(t),o=(0,er.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return er.default.createElement(e.Provider,{value:o},a)};var qn=Rt(({swapRootStore:a,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:r}}=a.getInstance(),i=o||r,n=a.getInstance();return i===w.BRIDGE&&(n=t.getInstance()),Bn.default.createElement(Mn,{rootStore:n},e)});u();d();var sr=x(G());u();d();u();d();var ro=x(G());var uc=()=>{let a=R.get(Ur);if(a){if(R.remove(Ur),a.startsWith(Hs))return wt.MEME_BUY;if(a.startsWith(lt))return wt.BRIDGE;if(a.startsWith(Z))return wt.SWAP}return R.get(ai)||wt.SWAP},dc=a=>({[wt.SWAP]:Z,[wt.BRIDGE]:lt,[wt.MEME_BUY]:js,[wt.MEME_SELL]:Ks})[a]||Z,lc=()=>{let{params:a,replace:t}=te(),{autoSwitch:e,from:o}=a,r=uc();if(e===$r.BRIDGE&&!o.tokenContractAddress){let i=dc(r);t({pathname:i,params:{...a,autoSwitch:void 0}})}},Un=a=>{let{params:t,replace:e}=te(),{autoSwitch:o}=t,[r,i]=(0,ro.useState)(""),[n,c]=(0,ro.useState)(!0);return lc(),(0,ro.useEffect)(()=>{a&&(async()=>{if(a===w.SWAP&&o===$r.BRIDGE){let m=await Ut.judgeTabTypeByParams(t?.from,t?.to);m===w.BRIDGE&&e({pathname:lt,params:{...t,autoSwitch:void 0}}),i(m),c(!1)}else i(a),c(!1)})().catch(()=>{})},[a]),{tabType:r,autoSwitching:n}};u();d();var or=x(G()),Vn=x(zt());var Gn=()=>{let{pathname:a}=(0,Vn.useLocation)(),[t,e]=(0,or.useState)("");return(0,or.useEffect)(()=>{switch(a){case Uo:case Z:e(w.SWAP);break;case lt:e(w.BRIDGE);break;default:break}},[a]),t};u();d();var ts=x(G());var Wn=(a,t)=>{let{accountStore:e}=Y(),{params:o}=te(),{btcAddressType:r}=o;(0,ts.useEffect)(()=>{e.setBtcAddressType(r)},[]);let i=sn();(0,ts.useEffect)(()=>{async function n(){let c=new Ut(a,o),{from:l,to:m,tab:p,inputAmount:g,error:S}=await c.initTokenPair(t);S||i(l,m,g,p)}a&&n().catch(()=>{})},[a])};u();d();var Qn=x(G()),Hn=x(zt());var jn=a=>{let{fromToStore:t}=Y(),{from:e,to:o}=t,{params:r,replace:i}=te(),{pathname:n}=(0,Hn.useLocation)(),c=nn();(0,Qn.useEffect)(()=>{let l=c(e,o);l&&a&&[Z,lt].includes(n)&&(new Ut(a).writeTabInfoToLocalStorage(l),i({params:{...l,feeConfig:r.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,a,n])};var mc=a=>{let t=Gn(),{tabType:e}=Un(t);Wn(e,a),jn(e)},Kn=mc;u();d();var Yn=x(G());u();d();function pc(a){return new Promise(t=>setTimeout(t,a))}async function xe(a,t=3,e=0){let o;for(let r=0;r<t;r++)try{return await a()}catch(i){o=i,e&&r<t-1&&await pc(e)}throw o}function hc(a,t,e){let o=Ct();return{promise:a(t,{...e,signal:o.signal}),cancel:()=>o.abort()}}function fc(a,t,e){if(rt())return hc(a,t,e);let o=new AbortController,r=o.signal;return{promise:a(t,{...e,signal:r}),cancel:()=>o.abort()}}function $n(a,t){return fc(E.get,a,t)}function Xn(){let{accountStore:a,receiveAddressStore:t}=Y(),{address:e,setUserForbiddenBridge:o}=a,{receiveAddrObj:r,computedSwapHighLight:i}=t,{specifiedAddress:n}=r||{};(0,Yn.useEffect)(()=>{let c=()=>{};if(e&&i){let{promise:l,cancel:m}=$n(wi,{params:{userWalletAddress:e,receiveWalletAddress:n}});c=m,l.then(p=>{o(p?.data.blackListTypes||wo)}).catch(()=>{o(wo)})}else o(wo);return c},[e,o,n,i])}u();d();var zn=x(G());function es(){let{accountStore:{address:a}}=Y();(0,zn.useEffect)(()=>{_.setTags({address:a})},[a])}u();d();var Jn=x(G());var Sc=()=>{let{accountStore:a,fromToStore:t,approveStore:e,recentTransactionStore:o,tokenModalStore:r}=Y();(0,Jn.useEffect)(()=>{let{computedAccountWalletAddresses:i}=a;return i&&(Vt.addListen("error",()=>{e.onSocketError(),o.onSocketError(),t.setNeedBalanceLoading(!1),t.getSwapTokenBalance(),r.reloadTokenList()}),Vt.addListen(Yr.DEX_PUSH_ENGINE,n=>{o.onSocket(n),e.onSocket(n)}),Vt.addListen(Yr.WALLET_ASSET,n=>{n&&(r.updateAllTokenList(n),t.updateFromBalancePush(n))}),Vt.init(i)),()=>{Vt.removeAll(),Vt.wsInstance&&i&&Vt.logout(i)}},[a.computedAccountWalletAddresses,o.onSocket,r.updateAllTokenList,t.updateFromBalancePush,a,o,r])},Zn=Sc;u();d();var ea=x(G());L();var ta=({token:a,onListenData:t=kt})=>{(0,ea.useEffect)(()=>{if(!Vo(a))return kt;let e=an({subscribeParams:{channel:cn.DEX_MARKET_TX_CHANNEL,chainId:a.chainId,tokenAddress:a.tokenContractAddress},onListenData:o=>{t(o?.[0]||{})},onListenError:kt});return()=>{e()}},[a?.chainId,a?.tokenContractAddress])},gc=()=>{let{fromToStore:a={}}=Y(),{from:t,updateFromUsdPriceFromWs:e,to:o,updateToUsdPriceFromWs:r}=a;ta({token:t,onListenData:e}),ta({token:o,onListenData:r})},oa=gc;u();d();var Gt=x(G()),ra=x(zt());var Tc=({currency:a,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,addressBookList:r,walletList:i,t:n,dispatch:c,currentTab:l,onBack:m})=>{let{commonStore:p,accountStore:g,recentTransactionStore:S,reset:A}=Y(),v=(0,ra.useHistory)();(0,Gt.useEffect)(()=>{P.setRuntimeContext({history:v,toLocale:n,dispatch:c,walletInfo:e,onBack:m})},[n,v,c,e,m]),(0,Gt.useEffect)(()=>{t&&g.setWalletConfig(t)},[t]),(0,Gt.useEffect)(()=>(p.getUserUnit(a),p.fetchChainList({businessLine:1,currentTab:l}).catch(()=>{p.setChainListLoadError(!0)}),()=>{A()}),[]),(0,Gt.useEffect)(()=>{g.setAddressBookList(r)},[r]),(0,Gt.useEffect)(()=>{g.setWalletList(i)},[i]),(0,Gt.useEffect)(()=>{g.setKeyringIdentityTypeEnum(o)},[o]),(0,Gt.useEffect)(()=>{t.walletId?S.updatePendingOrders(t.walletId):S.setPendingOrders([])},[t.walletId,l]),un()},sa=Tc;u();d();var at=x(G()),Wt=x(zt());u();d();var Me=x(G()),rr=x(zt()),ha=x(cc());u();d();var ia=x(G());var Cc=()=>{let{fromToStore:a}=Y(),{visibleAddFunds:t,addFundsParams:e,closeAddFunds:o}=a;return ia.default.createElement(dn,{visible:t,params:e,onBack:()=>{o()}})},na=Rt(Cc);u();d();var aa=x(G());var ca=()=>{let{fromToStore:a}=Y(),{closeAddFunds:t}=a;(0,aa.useEffect)(()=>{t()},[])};u();d();var ua=x(G());function da(){return ua.default.createElement(mn,{iconStyle:{fontSize:24},tooltipProps:{show:!1},iconClassName:oe.rightIcon})}u();d();var la=x(G()),ma=x(zt());function pa(){let a=(0,ma.useLocation)(),t=hn(),{isTelegramMiniApp:e}=P.global,o=a.pathname;return(0,la.useMemo)(()=>!e&&o===Z&&t,[e,o,t])}var Ic=[Z,lt],Ac=({children:a,onBack:t})=>{let{showNavigator:e,title:o}=pn(),r=(0,rr.useLocation)(),i=(0,rr.useHistory)(),{isTelegramMiniApp:n}=P.global,{Navigator:c}=P.components,l=r.pathname.includes(Mt),m=pa();ca();let p=()=>{l&&Oe({...st(),button_name:"back"}),t?t(i.goBack,Ic.includes(r.pathname)):i.goBack()},g=()=>n?oe.telegramContainer:e?oe.extensionContainer:oe.extensionContainerNoHeader;return Me.default.createElement("div",{className:(0,ha.default)("universe-swap background-base-primary",oe.wrapper)},e?Me.default.createElement(c,{asPage:!0,title:o,onBack:p,closeable:m?{children:Me.default.createElement(da,null)}:!1}):null,Me.default.createElement("div",{className:g()},a),Me.default.createElement(na,null))},fa=Rt(Ac);var _c=(0,at.lazy)(()=>import("./Swap-4B7VRD4P.js")),Ec=(0,at.lazy)(()=>import("./Bridge-DMKKWP6A.js")),yc=(0,at.lazy)(()=>import("./OrderDetail-BP7XYBMI.js")),kc=(0,at.lazy)(()=>import("./Contract-GF3I5CYA.js")),Rc=(0,at.lazy)(()=>import("./Approve-L5K7MFEG.js")),bc=(0,at.lazy)(()=>import("./Solana-KMSUW2UC.js")),vc=({onBack:a})=>{let t=(0,Wt.useLocation)();return at.default.createElement(fa,{onBack:a},at.default.createElement(at.Suspense,null,at.default.createElement(Wt.Switch,null,[{path:Z,component:_c,exact:!0},{path:lt,component:Ec,exact:!0},{path:Qs,component:yc,exact:!0},{path:Mt,component:kc,exact:!0},{path:Eo,component:Rc,exact:!0},{path:yo,component:bc,exact:!0}].map((o,r)=>at.default.createElement(Wt.Route,{key:r,path:o.path,component:o.component,exact:o.exact})),at.default.createElement(Wt.Redirect,{from:Uo,to:{pathname:Z,search:t.search},strict:!0,exact:!0}))))},Sa=vc;var Lc=({currency:a,currentWallet:t,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,walletInfo:i,onBack:n,t:c,dispatch:l,currentTab:m=w.SWAP})=>{Kn(i.chainId),sa({currency:a,currentWallet:t,walletInfo:i,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,t:c,dispatch:l,currentTab:m,onBack:n}),Xn(),Zn(),es(),oa();let{initialized:p}=Ji();return p?sr.default.createElement(Sa,{onBack:n}):null},ga=(0,sr.memo)(Rt(Lc));u();d();var Ta=x(G());j();var Pc=()=>{let a=Bs.hash.split("?")[1],t=new qs(a),e=t.get("pageSource"),o=t.get("bot");(0,Ta.useEffect)(()=>{let r;e&&(r=e),o&&(r="bot"),r&&Zt.set("pageSource",r)},[e,o])},Ca=Pc;u();d();u();d();u();d();L();j();var so=class{constructor(t){s(this,"checkTokenValid",async t=>{if(!Vo(t))return!1;let[e,o]=await y(E.get(Bi,{params:Kt(t,["chainId","tokenContractAddress"])}));return e?!1:o.data.supportMarket});this.rootStore=t,this.accountStore=t.accountStore,B(this,{},{autoBind:!0})}};u();d();L();j();var io=class{constructor(t){s(this,"showLimitDialog",!1);s(this,"setShowLimitDialog",t=>{this.showLimitDialog=t});s(this,"cancelRef",null);s(this,"callbackList",[]);s(this,"addToCallbackList",t=>{this.callbackList.push(t)});s(this,"removeFromCallbackList",t=>{this.callbackList=this.callbackList.filter(e=>e!==t)});s(this,"updateTokenCollectStatus",async({tokenInfo:t,callBack:e})=>{let{isConnectedWallet:o}=this.accountStore;if(!o){this.walletWarnInterceptor();return}this.cancelRef&&this.cancelRef.abort(),this.cancelRef=Ct();let r={tokenContractAddress:t?.tokenContractAddress,chainId:Number(t?.chainId),symbol:t?.tokenSymbol,decimal:t?.decimals,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,isCustomToken:t?.isCustomToken||t?.isSubscribe},[i,n]=await y(E.post(Bo,r,{signal:this.cancelRef.signal}));this.handleResult({error:i,res:n,callBack:e,tokenInfo:t})});s(this,"debounceUpdateTokenCollectStatus",Io(this.updateTokenCollectStatus,500));s(this,"walletWarnInterceptor",()=>{b.error({title:h("swaptrade_selecttoken_toast_connect_wallet"),duration:_t})});this.rootStore=t,this.commonStore=t.commonStore,this.accountStore=t.accountStore,B(this,{},{autoBind:!0})}handleResult({error:t,res:e,callBack:o,tokenInfo:r}){if(!qt(t)&&t)t?.code===10023?b.error(h("swaptrade_selecttoken_modal_favorite_limitreached")):b.error(h("swaptrade_pricechart_no_connection_desc"));else if(e){if(e?.data===0)o({selected:!1,tokenInfo:r}),this.callbackList.forEach(i=>{i({selected:!1,tokenInfo:r})}),b.success({title:h("swaptrade_selecttoken_toast_removed_from_favorite"),duration:_t});else if(e?.data===1){let i=Zi(),{isMarketHomeUrl:n}=tn();!n&&Wo({business_type:i?Mr.LIMIT_ORDER:Mr.SWAP}),o({selected:!0,tokenInfo:r}),this.callbackList.forEach(c=>{c({selected:!0,tokenInfo:r})}),b.success({title:h("swaptrade_selecttoken_toast_added_to_favorite"),duration:_t})}}}};var Qt=class{constructor(){Qt.instance?(this.commonStore=Qt.instance.commonStore,this.accountStore=Qt.instance.accountStore,this.updateCollectionStore=Qt.instance.updateCollectionStore,this.checkTokenStore=Qt.instance.checkTokenStore):(this.commonStore=new On(this),this.accountStore=new wn(this),this.updateCollectionStore=new io(this),this.checkTokenStore=new so(this),Qt.instance=this)}},ne=Qt;s(ne,"instance",null);u();d();u();d();L();j();var os=class{constructor(t){this.approveTokenDefaultConfig={status:N.Unknown,approvedAmount:"0"};this.approveTokensConfig={};this.getApproveTokenMapKey=(t,e)=>{let o=this.commonStore.getTokenAddress(t);return`${t.chainId}_${o}_${e}`};this.registerApproveToken=(t,e)=>{let o=this.getApproveTokenMapKey(t,e),r=I(this.approveTokensConfig,o);H(r)&&(this.approveTokensConfig[o]={...this.approveTokenDefaultConfig})};this.registerCurrentApproveToken=()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;this.registerApproveToken(t,e)};this.updateApproveTokenConfig=(t,e,o)=>{let r=this.getApproveTokenMapKey(t,e),i=I(this.approveTokensConfig,r),n=H(i),c=i||this.approveTokenDefaultConfig;this.approveTokensConfig[r]={...c,...o},n&&_.stuff("if you want to update approve token config, you should register it first.")};this.removeApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);delete this.approveTokensConfig[o]};this.updateCurrentApproveTokenConfig=t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode;this.updateApproveTokenConfig(e,o,t)};this.getApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);return I(this.approveTokensConfig,o,this.approveTokenDefaultConfig)};this.clearNonApprovingTokensConfig=()=>{let t=Ds(this.approveTokensConfig,e=>[N.Approving,N.CancelApproving].includes(e.status));this.approveTokensConfig={...t}};this.isApprovalCheckRequired=()=>{let{computedIsSolanaChain:t,computedIsAptosChain:e}=this.fromToStore,{quote:{bestRoute:o}}=this.rootStore.quoteStore,r=this.commonStore.computedCurrentTabIsLimit,{token:i}=this.computedTokenAndTradeModeCode,{isNativeToken:n}=i;return(r?!0:o?.needApprove==="1")&&!n&&!t&&!e};this.validApproveAmountLessSwapAmount=t=>{let{token:e}=this.computedTokenAndTradeModeCode;return T.BigNumber(t).isLessThan(e.amount||"0")};this.isValidApprovalStatus=(t,e)=>{let o=Bt(t),r=this.validApproveAmountLessSwapAmount(t);return o?N.UnApproved:r&&e?N.CancelApprove:r?N.UnApproved:N.Approved};this.generateApproveRequestParams=t=>{let{address:e}=this.accountStore,{token:o}=this.computedTokenAndTradeModeCode,{tokenContractAddress:r,chainId:i}=o;return{userWalletAddress:e,tokenContractAddress:r,chainId:i,cancelApproveTag:t}};this.fetchApproveAllowance=()=>{let t=this.getDefiPlatformIds();return E.get(_i,{params:{...this.generateApproveRequestParams(),defiPlatformIds:t}}).then(e=>e?.data)};this.fetchApproveData=t=>{let e=this.fromToStore.computedIsCrossChain?this.getBridgeDefiPlatformId():I(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformId",$),o={...this.generateApproveRequestParams(t),defiPlatformId:e};return E.get(Ei,{params:o}).then(r=>{let{id:i,data:n,from:c,to:l,unsignedTx:m}=r?.data||{},p={data:n,from:c,to:l};return _.info(k.APPROVE_DATA,{id:i,data:n,from:c,to:l,unsignedTx:m,cancelApproveTag:t}),Jo(o.chainId)&&(p=JSON.parse(m)),{transactionPayload:p,id:i}})};this.getBridgeDefiPlatformId=()=>{let e=this.rootStore.quoteStore.quote?.bestRoute,o=Number(e?.bridge?.bridgeType),r=e?.bridge?.defiPlatformId;return o===ri?r:$};this.approveStatusIsPending=()=>[N.Approving,N.CancelApproving].includes(this.computedApprovalStatus);this.isPendingNeedCheck=async()=>{this.approveStatusIsPending()&&this.checkApprove().catch(()=>{})};this.isPendingNotCheck=async()=>{this.approveStatusIsPending()||this.checkApprove().catch(()=>{})};this.getDefiPlatformIds=()=>{let{computedIsCrossChain:t}=this.fromToStore;if(t){let e=I(this,"rootStore.quoteStore.pathSelectionRouterList");return Array.isArray(e)?Qe(e.map(o=>o.bridge?.defiPlatformId).filter(o=>o!==void 0)):[$]}return I(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformInfoList",[{defiPlatformId:$}]).map(e=>e.defiPlatformId)};this.checkApprove=async()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;if(!this.isApprovalCheckRequired()){this.getDefiPlatformIds().forEach(n=>{this.registerApproveToken(t,n),this.updateApproveTokenConfig(t,n,{status:N.Approved,tagStatus:N.UnApproved})});return}let{tokenContractAddress:o}=t,{address:r}=this.accountStore;if(o&&r){let[,i]=await y(this.fetchApproveAllowance());if(!i){this.updateApproveTokenConfig(t,e,{status:N.Unknown});return}Object.keys(i).forEach(n=>{let c=i[n];this.calcApproveState({approveInfo:c,token:t,tradeModeCode:Number(n)})})}};this.calcApproveState=({approveInfo:t,token:e,tradeModeCode:o})=>{let{decimals:r}=e,i=Number(t.status)===N.Approved?t.amount:"0",n=we(i,r)||"0",c=t?.needCancelApproveToken,l=this.isValidApprovalStatus(n,c);this.registerApproveToken(e,o),this.updateApproveTokenConfig(e,o,{status:l,tagStatus:l,approvedAmount:n})};this.fetchApproveDataErrorTips=(t,e)=>{this.updateCurrentApproveTokenConfig({status:N.UnApproved});let o=q(t?.tokenSymbol);Yo({title:e?h("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:o}):h("swaptrade_toast_approve_fail",{tokenSymbol:o})})};this.approveErrorTips=({error:t,chainId:e,transactionPayload:o,token:r,tradeModeCode:i,cancelApproveTag:n})=>{_.error(k.APPROVE_TOKEN_ERROR,{chainId:e,transactionPayload:o,error:t,token:r,tradeModeCode:i}),oo(t)||Xt.error({title:h("swaptrade_home_toast_broadcast_failed")}),this.updateApproveTokenConfig(r,i,{status:this.isCancelApprove(n)?N.CancelApprove:N.UnApproved})};this.isCancelApprove=t=>t===ye.CANCEL_APPROVE;this.setApprove=async t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode,{chainId:r}=e;this.updateApproveTokenConfig(e,o,{status:this.isCancelApprove(t)?N.CancelApproving:N.Approving});try{let{id:i,transactionPayload:n}=await this.fetchApproveData(t);await this.approveToken({chainId:r,transactionPayload:n}).then(({result:c})=>this.saveApprove({id:i,chainId:r,transactionHash:c,cancelApproveTag:t})).catch(c=>{this.approveErrorTips({error:c,chainId:r,transactionPayload:n,token:e,tradeModeCode:o,cancelApproveTag:t})})}catch{this.fetchApproveDataErrorTips(e,t)}};this.saveApprove=async({id:t,chainId:e,transactionHash:o,cancelApproveTag:r})=>{if(!o)return;let{address:i}=this.accountStore,n=I(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformId",$);_.info(k.SAVE_APPROVE,{id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:r,defiPlatformId:n});try{await E.post(yi,{id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:r,defiPlatformId:n})}catch(c){_.info(k.SAVE_APPROVE_ERROR,{error:c?.message,id:t,transactionHash:o,chainId:e,userWalletAddress:i,cancelApproveTag:r,defiPlatformId:n})}};this.onSocket=async t=>{if(t?.type==="1"&&t?.dexData&&t.dexData.type==="approve"){let e=t.dexData,{status:o,transactionHash:r,fromTokenSymbol:i,fromTokenAddress:n,exploreUrl:c,solanaToast:l,platformId:m}=e,p=rt();if(l==="1"){if(p)return;let O=o===ke.CANCEL_APPROVE_SUBMITTED?"swaptrade_transfer_toast_ccy_unrevoke_submit":"swaptrade_transfer_notification_approval_submit";$o({title:h(O,{ccy:q(i)})});return}let{token:g,tradeModeCode:S}=this.computedTokenAndTradeModeCode,A={chainId:e.chainId,tokenContractAddress:n},v=this.commonStore.equalsToken(g,A),F=String(S)===String(m);if(v&&F&&await this.isPendingNeedCheck(),(!v||v&&!F)&&this.removeApproveTokenConfig(A,m),o===ke.APPROVE_SUCCESS){let O=h("swaptrade_toast_approve_success",{tokenSymbol:q(i)});!p&&$o({title:O,exploreUrl:c}),eo.emit(to.APPROVE,{data:r,status:0,message:O})}else if(o===ke.APPROVE_FAILED&&!p){let O=h("swaptrade_toast_approve_fail",{tokenSymbol:q(i)});Yo({title:O,exploreUrl:c})}else if(o===ke.CANCEL_APPROVE_SUCCESS&&!p){let O=h("swaptrade_transfer_notification_title_ccy_revoked",{ccy:q(i)});$o({title:O,exploreUrl:c})}else if(o===ke.CANCEL_APPROVE_FAILED&&!p){let O=h("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:q(i)});Yo({title:O,exploreUrl:c})}}};this.onSocketError=()=>{this.isPendingNeedCheck().catch(()=>{})};this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore}get computedApprovalStatus(){let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;return this.getApproveTokenConfig(t,e).status}get computedTokenAndTradeModeCode(){let{from:t,computedIsCrossChain:e}=this.fromToStore,o=this.rootStore.quoteStore,r=$;if(e)r=this.getBridgeDefiPlatformId();else{let{aggregateSelectId:i}=o;r=i===Tt?$:i}return{token:t,tradeModeCode:r}}get computedIsCancelApproveStatus(){return[N.CancelApprove,N.CancelApproving].includes(this.computedApprovalStatus)}approveToken(t){return Promise.resolve(t)}},Ia=os;u();d();var Aa=Symbol(),_a=Object.prototype,wc=(a,t,e)=>{if(Ws(a))throw new Error("Target must not be observable");let o=a[Aa];if(o){let r={};for(let i in a)o[i]&&(r[i]=o[i]);o=r}else{o={};let r=a;for(;r&&r!==_a;)Reflect.ownKeys(r).forEach(n=>{n===Gs||n==="constructor"||(o[n]=t&&n in t?t[n]:!0)}),r=Object.getPrototypeOf(r);let i=Object.getPrototypeOf(a);i&&i!==_a&&Object.defineProperty(i,Aa,{value:o})}return xt(a,o,e)},it=wc;var ae=class extends Ia{constructor(e){super(e);s(this,"approveInfo",{});s(this,"setApproveInfo",e=>{this.approveInfo=e});s(this,"setApprove",async(e=ye.APPROVE)=>{let{token:o,tradeModeCode:r}=this.computedTokenAndTradeModeCode,{chainId:i}=o;this.updateApproveTokenConfig(o,r,{status:this.isCancelApprove(e)?N.CancelApproving:N.Approving});try{let{id:n,transactionPayload:c}=await this.fetchApproveData(e);this.setApproveInfo({chainId:i,id:n,transactionPayload:c,token:o,tradeModeCode:r,cancelApproveTag:e}),P.history?.push({pathname:Eo})}catch{this.fetchApproveDataErrorTips(o,e)}});s(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),P.history?.goBack?.(),this.updateCurrentApproveTokenConfig({status:this.isCancelApprove(e)?N.CancelApprove:N.UnApproved})});s(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{id:r,chainId:i,cancelApproveTag:n}=this.approveInfo;await this.saveApprove({id:r,chainId:i,transactionHash:e,cancelApproveTag:n}),P.history?.goBack?.(),this.setApproveInfo({})});it(this)}};u();d();L();j();u();d();var Et=()=>{let{fromToStore:a,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:r,accountStore:i,liquidityChooseStore:n}=D(),{from:c,to:l}=a,{receiveAddrObj:m}=e,{computedForbiddenBridge:p,address:g}=i,S=T.BigNumber(a.computedTypedValue).toString(10),v={...{chainId:c.chainId,toChainId:l.chainId,toTokenAddress:l.tokenContractAddress,fromTokenAddress:c.tokenContractAddress,amount:S,userWalletAddress:g},...r.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:Hr(p),dexIds:Hr(n?.computedIds),receiveWalletAddress:m?.specifiedAddress};return o.extendFeeConfig(v)},Ea=()=>{let{quoteStore:a}=D();return{...Et(),sort:a.bridgeSortType}},ya=()=>{let{quoteStore:a}=D(),{quote:t}=a,e=t?.bestRoute?.bridge?.bridgeId,{slippage:o,toChainId:r,receiveWalletAddress:i,userWalletAddress:n,chainId:c,fromTokenAddress:l,toTokenAddress:m,amount:p}=Et();return{slippage:o,toChainId:r,receiveWalletAddress:i,userWalletAddress:n,chainId:c,fromTokenAddress:l,toTokenAddress:m,amount:p,bridgeId:e}};u();d();u();d();u();d();var W=class{constructor({orderData:t,extParams:e},o){s(this,"walletNoNeedExtParams",!1);s(this,"differentiatedEnvironment",t=>rt()&&t.length>1&&!this.walletNoNeedExtParams&&!t[0].params?[{...t[0],extParams:t[1]}]:t);this.orderData=t,this.calldataType=t.calldataType,this.extParams=e||{},this.swapStore=o}get isTransferType(){return this.calldataType===ei.TRANSFER}};var ce=class extends W{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this;return{...JSON.parse(e?.callData?.data)}});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>{let e=this.formatContractPayload();return this.differentiatedEnvironment([{...e,extParams:this.extParams}])});s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(ce,"chainId",V.APTOS_MAINNET);u();d();var ue=class extends W{constructor(e,o,r){super(e,o);s(this,"makeSendBtcCallParams",async e=>{let{preDataForSendBtc:o}=this.swapStore.rootStore.walletContractStore;if(!o)throw Error("preDataForSendBtc is not ready");let{satBytes:r,coinAmount:i,dustSize:n,fetchUtxoList:c,serviceCharge:l}=o,m=await c();return{...e,utxoList:m,satBytes:r,dustSize:n,coinAmount:i,serviceCharge:l}});s(this,"formatContractPayload",()=>{});s(this,"formatTransferPayload",async()=>{let{orderData:e}=this;return this.swapStore.transferBtcPayload(e.callData)});s(this,"extendExtParams",e=>({...e,extParams:this.extParams}));s(this,"getSendTransactionParams",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let e;if(this.isTransferType){let o=await this.formatTransferPayload();e=this.extendExtParams(o),rt()&&(e=await this.makeSendBtcCallParams(e))}else throw Error("Not support contract call");return this.differentiatedEnvironment([e])});s(this,"preExecution",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let e;if(this.isTransferType)e=await this.formatTransferPayload();else throw Error("Not support contract call");return{payload:e}});this.token=r}};s(ue,"chainId",V.BTC_MAINNET);u();d();var ir=class extends W{constructor(){super(...arguments);s(this,"valueToHex",e=>T.BigNumber(e).toString(16));s(this,"formatContractPayload",()=>{let{orderData:e}=this,{priorityFee:o,maxFeePerGas:r,maxPriorityFeePerGas:i,gasPrice:n,gas:c,...l}=e?.callData||{};return l});s(this,"formatTransferPayload",()=>{let{orderData:e}=this;return e.callData});s(this,"getSendTransactionParams",async()=>{let{payload:e}=await this.preExecution();return Ho&&e.value&&(e.value=this.valueToHex(e.value)),this.differentiatedEnvironment([e])});s(this,"preExecution",async()=>{let e;this.isTransferType?e=this.formatTransferPayload():e=this.formatContractPayload();let{extendEvmParams:o,extendsGas:r}=this.swapStore;return e.extParams=this.extParams,r&&(e=r(e)),e=o(e),{payload:e}})}};s(ir,"chainId",V.ETHEREUM_MAINNET);var nr=ir;u();d();var de=class extends W{constructor(...e){super(...e);s(this,"formatContractPayload",async()=>{let{orderData:e}=this;return this.txData(e.unsignedTx)});s(this,"formatTransferPayload",async()=>{let{orderData:e}=this,{unsignedTx:o}=e;return this.txData(o)});s(this,"getSendTransactionParams",async()=>{let{payload:e}=await this.preExecution();return this.differentiatedEnvironment([e,this.extParams])});s(this,"preExecution",async()=>{let e;return this.isTransferType?e=await this.formatTransferPayload():e=await this.formatContractPayload(),e});s(this,"getTxData",()=>{let{jitoData:e,jitoEnable:o=!1,unsignedTx:r}=this.orderData||{};try{if(o){let{jitoUnsignedTx:i}=e;return JSON.parse(i).array}return[JSON.parse(r)]}catch(i){throw new Error(i)}});s(this,"jitoTransaction",async()=>{let e=this.getTxData();try{return Promise.all(e.map(this.txData))}catch(o){throw new Error(o)}});let o=new Nn;Object.assign(this,{...o})}};s(de,"chainId",V.SOLANA_MAINNET);u();d();var le=class extends W{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{data:o,from:r}=e.callData,i=JSON.parse(o);return{...i,functionArgs:i.functionArgsEncode,txType:"contract_call",stxAddress:r}});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(le,"chainId",V.STACKS_MAINNET);u();d();var me=class extends W{constructor(){super(...arguments);s(this,"walletNoNeedExtParams",!0);s(this,"formatContractPayload",()=>{let{orderData:e}=this,o=JSON.parse(e.unsignedTx),{executionRequest:r}=JSON.parse(o.data);return r.calls});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload()]));s(this,"preExecution",()=>({payload:this.formatContractPayload()}))}};s(me,"chainId",V.STARKNET_MAINNET);u();d();var ar=class extends W{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{txBytes:o}=JSON.parse(e.unsignedTx);return{transactionBlock:o}});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(ar,"chainId",V.SUI_MAINNET);var rs=ar;u();d();var cr=class extends W{constructor(){super(...arguments);s(this,"walletNoNeedExtParams",!1);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{params:o}=JSON.parse(e.unsignedTx);return o});s(this,"formatTransferPayload",()=>{let{orderData:e}=this,{params:o}=JSON.parse(e.unsignedTx);return o});s(this,"getSendTransactionParams",async()=>{let e=this.isTransferType?this.formatTransferPayload():this.formatContractPayload();return this.differentiatedEnvironment([e,this.extParams])});s(this,"preExecution",async()=>({payload:this.isTransferType?this.formatTransferPayload():this.formatContractPayload()}))}};s(cr,"chainId",V.TON_MAINNET);var ss=cr;u();d();var pe=class extends W{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this;return JSON.parse(e.unsignedTx)});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>{let e=this.formatContractPayload();return this.differentiatedEnvironment([{...e,extParams:this.extParams}])});s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(pe,"chainId",V.TRON_MAINNET);var Oc={[ue.chainId]:ue,[nr.chainId]:nr,[de.chainId]:de,[ce.chainId]:ce,[rs.chainId]:rs,[pe.chainId]:pe,[le.chainId]:le,[me.chainId]:me,[ss.chainId]:ss},Nc=a=>Oc[a]||nr,Dc=(a,t,e)=>{let{chainId:o}=a,r=Nc(o);return new r(t,e,a)},no=Dc;u();d();function Fc({selector:a}){let t=document.querySelector(a);t&&t.scrollTo({top:0,behavior:"smooth"})}var ur=Fc;var ka=20,yt={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update",CANCEL:"cancel",DEFAULT:"default"},is=class{constructor(t){s(this,"quoteData",null);s(this,"preDataForSendBtc",null);s(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});s(this,"setQuoteData",t=>{this.quoteData=t});s(this,"quoteParams",()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,i={...Et(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(i.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),i});s(this,"updating",!1);s(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t},swapStore:e}=this.rootStore,o=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let i={...Et(),bridgeId:t?.bestRoute?.bridge?.bridgeId,...o&&{defiPlatformId:o}},n=await e.extendSignParams(i),[c,l]=await y(E.post(`${bi}`,n));if(this.updating=!1,ur({selector:"#wallet_scroll"}),c){b.error({title:c?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let{callDataResult:m,quoteResult:p}=l?.data||{};if(this.rootStore.quoteStore.handleUpdateQuote({data:p}),m){let g=await this.getPreExecutionPayload(m);ut(()=>{this.transactionPayload=g})}this.initCountDown(),this.startCountdown()});s(this,"updateBridgeGetIntentQuoteCallData",async()=>{let t=ya();this.updating=!0;let[e,o]=await y(E.get(Di,{params:{...t}}));if(this.updating=!1,ur({selector:"#wallet_scroll"}),e){b.error({title:e?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});s(this,"updateSnapQuoteData",async()=>{let t=Et(),e=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let[o,r]=await y(E.get(Oi,{params:{defiPlatformId:e,...t}}));if(this.updating=!1,ur({selector:"#wallet_scroll"}),o){b.error({title:o?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:i}=r?.data||{};i&&this.rootStore.quoteStore.handleUpdateQuote({data:i}),this.initCountDown(),this.startCountdown()});s(this,"timer",null);s(this,"countdown",ka);s(this,"initCountDown",()=>{this.countdown=ka});s(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});s(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});s(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));s(this,"gasInfo",this.initGasInfo());s(this,"setGasInfo",t=>{this.gasInfo=t});s(this,"gasFee",0);s(this,"setGasFee",t=>{this.gasFee=t});s(this,"orderInfo",{});s(this,"transactionPayload",null);s(this,"solonaRent","");s(this,"getPreExecutionPayload",async(t,e)=>{let{swapStore:o,quoteStore:r}=this.rootStore,i=r?.quote?.bestRoute||{},{fromToken:n}=i,c=no(n,{orderData:t},o);if(e){let p=await c.jitoTransaction();return this.solonaRent=Fn(p),p}let{payload:l,rent:m}=await c.preExecution();return n.chainId===V.SOLANA_MAINNET&&m&&(this.solonaRent=m),l});s(this,"setTransactionPayload",t=>{this.transactionPayload=t});s(this,"fetchCallData",async()=>{let{swapStore:t}=this.rootStore||{};t.setCalldataSign(null);let e=t.saveOrderParams(),o=await t.extendSignParams(e);if(!o)return!1;let r=t.isSwapSolana(o.chainId),i,n;if(r){let l=t.extendSolanaCalldata(o);[i,n]=await t.getSolanaCalldata(l)}else[i,n]=await y(E.post(qo,o));if(i){let l=[90002,10009,50028].includes(Number(i?.code))?i?.error_message:i?.data?.msg;return b.error({title:l||h("swaptrade_top_notif_data_failed")}),!0}let c=await this.getPreExecutionPayload(n?.data||{},r);return this.transactionPayload=c,!1});s(this,"preExecutionResult",{});s(this,"setPreExecutionResult",t=>{this.preExecutionResult=t});s(this,"nativeCoin",null);s(this,"setNativeCoin",t=>{this.nativeCoin={...t}});s(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:r}=this.rootStore.fromToStore;return T.BigNumber(r?o.availableBalance:we(t,e))});s(this,"calcNativeCoinAmountChange",()=>{let t;if(this.type===gt.SWAP){let{fromToStore:o}=this.rootStore;t=o.from}else{let{fromToken:o,fromTokenAmount:r}=this.rootStore.facetStore.facetOrderDetail;t={...o,amount:r}}let e=T.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return t.isNativeToken?T.BigNumber(t.amount).plus(e):T.BigNumber(e)});s(this,"gasFeeLoading",!0);s(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});s(this,"gasLimitError",null);s(this,"setGasLimitError",t=>{this.gasLimitError=t});s(this,"activityId",null);s(this,"setActivityId",t=>{this.activityId=t});s(this,"type",gt.SWAP);s(this,"setSwapType",t=>{this.type=t});s(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(gt.SWAP),this.clearTimer(),this.solonaRent=""});s(this,"starknetRegisterStatus","");s(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});s(this,"visibleStarknetRegister",!1);s(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});s(this,"onSwap",()=>{Oe({...st(),button_name:"confirm"}),this.rootStore.swapStore.onSwap()});s(this,"onRedeem",()=>{this.rootStore.facetStore.walletSendRedeem()});s(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});s(this,"confirmSwapMap",{[gt.SWAP]:this.onSwap,[gt.REDEEM]:this.onRedeem,[gt.INTENT_SWAP]:this.onIntentSwap});s(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});s(this,"getBtnProps",t=>{let{fromToStore:e}=this.rootStore,{symbol:o,coinId:r,chainId:i}=this.nativeCoin||{};return{[yt.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:c=>{this.onConfirm(c)},btnText:h("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[yt.UPDATE]:{onClick:()=>{Oe({...st(),button_name:"update"}),this.updateQuoteData().catch(kt)},btnText:h("swaptrade_confirmswap_btn_update_price")},[yt.SNAP_UPDATE]:{onClick:()=>{Oe({...st(),button_name:"update"}),e.computedIsCrossChain?this.updateBridgeGetIntentQuoteCallData().catch(kt):this.updateSnapQuoteData().catch(kt)},btnText:h("swaptrade_confirmswap_btn_update_price")},[yt.FILL_UP]:{onClick:()=>{Kr({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:r,chainId:i,receiveOnly:!1})},btnText:h("swaptrade_dialog_btn_supplement",{token:o})},[yt.CANCEL]:{onClick:()=>{Kr({wallet_address:this.rootStore.accountStore.address,button_name:"cancel"});let{history:c}=P;c?.goBack()},btnText:h("swaptrade_top_btn_cancel")},default:{}}[t]});B(this),this.rootStore=t}get computedFormatTime(){return Qi(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==V.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let r=this.calcNativeCoinAmount(),i=this.calcNativeCoinAmountChange();return r.gte(i.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=P;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.rootStore?.quoteStore?.computedIsOfflineType}get compuletedGetNativeCoinLoading(){return this.nativeCoin?this.nativeCoin?.isBalanceLoading:!0}get compuletedGetNativeCoinError(){return this.nativeCoin?this.nativeCoin.isBalanceLoadError:!0}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=P.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:r}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return this.computedPriceUpdate;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let i=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError||this.compuletedGetNativeCoinError||this.compuletedGetNativeCoinLoading||this.updating;return o||!r?i:i||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedConfirmBtnProps(){return this.getBtnProps(yt.CONFIRM)}get computedCancelBtnProps(){return this.getBtnProps(yt.CANCEL)}get computedTipsBtnProps(){let t=yt.DEFAULT;return(!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent)&&!this.compuletedGetNativeCoinError&&!this.compuletedGetNativeCoinLoading?t=yt.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?yt.SNAP_UPDATE:yt.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},dr=is;u();d();L();u();d();L();L();j();u();d();L();L();var ba=(a,t)=>a.filter(({networks:e})=>e.findIndex(r=>r.name===t)>-1),va=(a,t)=>a.filter(({account:e})=>e[t]),La=({recentAddrData:a,addressBookData:t,walletListData:e,chainName:o})=>{let r=[];if(a.length>0){let i=a.map(({specifiedAddress:n,...c})=>({specifiedAddress:n,...c}));r.push({group:h("swaptrade_extension_wallet_address_recent_address"),list:i})}if(t.length>0){let i=t.map(n=>({...n,specifiedAddress:n.address}));r.push({group:h("swaptrade_extension_wallet_address_connected_wallets"),list:i})}if(e.length){let i=e.map(c=>({specifiedAddress:c.account[o],group:c.keyringName,name:c.walletName,walletId:c.walletId}));Object.entries(vs(i,"group")).forEach(([c,l])=>{r.push({group:c,list:l})})}return r},Ra=a=>String(I(a,"isLeveraged"))==="1",Pa=(a,t)=>{let e=[null,null];return Ra(a)&&(e[0]=a),Ra(t)&&(e[1]=t),e};var{BigNumber:Q}=T,ao=class{constructor(t){s(this,"defaultToken",{amount:"",prevAmount:"",balance:"",logoURI:"",coinId:"",decimals:"",usdPrice:"",tokenName:"",baseCoinId:"",tokenSymbol:"",tokenLogoUrl:"",isNativeToken:0,tokenContractAddress:"",isSafeMoonToken:"",isHoneypot:"",buyTaxes:"0",sellTaxes:"0",reverseReceiveAmount:"",chainId:""});s(this,"from",{...this.defaultToken,amount:"1"});s(this,"to",this.defaultToken);s(this,"fromBalanceState",et.BALANCE_NOT_SHOW);s(this,"toBalanceState",et.BALANCE_NOT_SHOW);s(this,"fromBalanceRequestError",!1);s(this,"toBalanceRequestError",!1);s(this,"isBalanceLoading",!1);s(this,"visibleAddFunds",!1);s(this,"setFrom",t=>{this.from=t});s(this,"setTo",t=>{this.to=t});s(this,"maxDialogType",ze.enough);s(this,"setMaxDialogType",t=>{this.maxDialogType=t});s(this,"checkMaxDialogTypeIsEnough",t=>ze.enough===t);s(this,"typedValue","");s(this,"fromMax",!1);s(this,"independentField",C.FROM);s(this,"singleTypedValue","");s(this,"singleFromMax",!1);s(this,"advanceSetTypedValue",(t="",e=!1,o="")=>{(o||this.commonStore.currentTab)===w.SWAP?(this.singleTypedValue=t,this.singleFromMax=e):this.setTypeInput(t,e)});s(this,"needCrossChainDoubleConfirm",!1);s(this,"setNeedCrossChainDoubleConfirm",t=>{this.needCrossChainDoubleConfirm=t});s(this,"updateBtcFromBalance",async()=>this.computedIsFromBtcCoin?(await this.getTokenBalanceByAccount(C.FROM,M(this.from)),!this.fromBalanceRequestError):!this.fromBalanceRequestError);s(this,"onClickMax",async()=>{Yi({button_name:"max"});let{isNativeToken:t}=this.from;this.setField(C.FROM);let e="",o="";if(t===1){let[r,i]=await Promise.all([this.rootStore.quoteStore.fetchGasTokenFee(),this.updateBtcFromBalance()]);if(!i)return;let{balance:n,availableBalance:c}=this.from,l=(this.computedIsFromBtcCoin?c:n)||"0";if(r===-1)return;o=Q(l).minus(r);let m=o.isNegative();this.setMaxDialogType(m?ze.insufficient:ze.enough),m&&this.setShowAddFund(!0),this.showMaxDialog(),this.setShowMaxIcon(!0),e=m?"":o.toString()}else e=this.from.balance;this.advanceSetTypedValue(e,!0)});s(this,"setTypeInput",(t,e)=>{this.typedValue=t,this.fromMax=!!e});s(this,"setField",t=>{this.independentField=t});s(this,"quoteUpdateFromTo",t=>{let{receiveAmount:e="",fromTokenPrice:o="",toTokenPrice:r="",payAmount:i="",inputToTokenPrice:n=""}=t||{};!this.computedIsExactIn&&e?(this.from.amount=i,this.to.amount=this.computedTypedValue,this.to.prevAmount=this.computedTypedValue,this.from.currentTime=new Date().getTime(),this.to.usdPrice=n):this.computedIsExactIn&&(this.from.amount=this.computedTypedValue,this.to.amount=e,this.from.prevAmount=this.computedTypedValue,this.to.currentTime=new Date().getTime(),this.to.usdPrice=r),this.to.reverseReceiveAmount=e,this.from.usdPrice=o});s(this,"checkAndGetTokenInfo",async({chainId:t,tokenContractAddress:e})=>{let[o,r]=await this.getTokenInfoAndBalance(t,e);return o?null:r.data});s(this,"getDexMultiDefaultTokenInfo",t=>{let{chainList:e}=this.commonStore,o=M(e).find(r=>Number(r.chainId)===Number(t??Ze))||{};return{fromDexMultiTokenInfoVO:{...o.dexDefaultFromToTokenShowVO?.fromDexMultiTokenInfoVO,reserveGas:o.reserveGas},toDexMultiTokenInfoVO:o.dexDefaultFromToTokenShowVO?.toDexMultiTokenInfoVO||{}}});s(this,"addressReplaceSymbol",t=>{let{fromDexMultiTokenInfoVO:e}=this.getDexMultiDefaultTokenInfo(t.chainId),{tokenSymbol:o,isNativeToken:r}=e;return r&&this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(e)?o:t?.tokenContractAddress});s(this,"symbolReplaceAddress",t=>this.tokenReplaceMainToken(t).tokenContractAddress);s(this,"validTokens",{});s(this,"fetchTokenInfo",async t=>{if(t.tokenContractAddress){let e=await this.checkAndGetTokenInfo(t);if(e?.tokenContractAddress){let r={...e,balance:e.amountNum,amount:t.amount||""},i=`${e.chainId}_${this.commonStore.getTokenAddress(e)}`;return this.validTokens[i]=!0,r}let o=`${t.chainId}_${this.commonStore.getTokenAddress(t)}`;return this.validTokens[o]=t.tokenContractAddress==ci,null}return null});s(this,"checkQueryToken",async(t,e=!0)=>{if(!tt(t.chainId))return null;let o=t;if(rn(this.commonStore.chainList,Number(t.chainId))){let{from:i}=this.getInitializedValue(t.chainId);if(this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(i)&&e){let c=`${i?.chainId}_${this.commonStore.getTokenAddress(i)}`;return this.validTokens[c]=!0,i}let n=await this.fetchTokenInfo({chainId:Number(t.chainId),tokenContractAddress:t.tokenContractAddress});e?o=n||i:o=n}else o=null;return o});s(this,"updateFrom",t=>{(!this.commonStore.equalsToken(t,this.from)||this.from.balance!==t.balance)&&(this.setShowMaxIcon(!1),this.setShowAddFund(!1)),this.from={...M(this.from),...t}});s(this,"updateFromAmount",t=>{this.from.amount=t,t||(this.from.usdPrice="0"),this.from.prevAmount||(this.from.prevAmount=t)});s(this,"updateFromUsdPriceFromWs",(t={})=>{!Xr(t,this.from)||(this.from.wsPriceData=t,this.from.usdPrice=Jr({realTimeTokenPrice:t.price,amount:this.from.amount,nonRealTimeTokenValue:this.from.usdPrice}))});s(this,"updateToUsdPriceFromWs",(t={})=>{!Xr(t,this.to)||(this.to.wsPriceData=t,this.to.usdPrice=Jr({realTimeTokenPrice:t.price,amount:this.to.amount,nonRealTimeTokenValue:this.to.usdPrice}))});s(this,"updateTo",t=>{this.to={...M(this.to),...t}});s(this,"hideMaxDialog",!!R.get(Vr));s(this,"hideMaxDialogLessGas",!!R.get(Gr));s(this,"setStorageShowMaxDialog",t=>{if(t){let e=this.checkMaxDialogTypeIsEnough(this.maxDialogType);R.set(e?Vr:Gr,"1"),e?this.hideMaxDialog=!0:this.hideMaxDialogLessGas=!0}this.visibleMaxDialog=!1});s(this,"visibleMaxDialog",!1);s(this,"showMaxDialog",()=>{let t=this.checkMaxDialogTypeIsEnough(this.maxDialogType);t&&this.hideMaxDialog||!t&&this.hideMaxDialogLessGas||(this.visibleMaxDialog=!0)});s(this,"showMaxIcon",!1);s(this,"setShowMaxIcon",t=>{this.showMaxIcon=t});s(this,"showAddFund",!1);s(this,"setShowAddFund",t=>{this.showAddFund=t});s(this,"setFromBalanceRequestError",t=>{this.fromBalanceRequestError=t});s(this,"setToBalanceRequestError",t=>{this.toBalanceRequestError=t});s(this,"resetBalanceState",()=>{this.setShowMaxIcon(!1),this.setShowAddFund(!1),[this.fromBalanceRequestError,this.toBalanceRequestError]=[this.toBalanceRequestError,this.fromBalanceRequestError]});s(this,"onSwitchFromTo",async()=>{if(!this.isBalanceLoading){this.rootStore.quoteStore.quoteScope=null;let[t,e]=[M(this.from),M(this.to)];this.resetBalanceState();let o={amount:this.computedTypedValue??"",prevAmount:this.computedTypedValue??"",usdPrice:""},r={amount:"",prevAmount:"",usdPrice:""};this.setNeedCrossChainDoubleConfirm(!0),this.setField(C.FROM),this.computedIsSingleChain?(this.setCacheTokenInfo({chainId:e.chainId,tokenContractAddress:e.tokenContractAddress,amountNum:e.balance},"switchFromTo"),this.setFrom({...e,...o})):(this.rootStore.quoteStore.setQuoteNumber(this.computedTypedValue?0:2),this.setCacheTokenInfo({chainId:e.chainId,tokenContractAddress:e.tokenContractAddress,amountNum:e.balance},"switchFromTo"),this.setFrom({...e,amount:e.amount||"",prevAmount:e.amount||"",usdPrice:""})),this.setTo({...t,...r}),this.advanceSetTypedValue(e.amount),this.rootStore.receiveAddressStore.clearReceiveAddressValue()}});s(this,"getChainInfo",t=>{let{chainList:e}=this.commonStore;return M(e).find(r=>Number(r.chainId)===Number(t))||{}});s(this,"getInitializedValue",(t=Ze)=>{let e=this.getChainInfo(t),{fromDexMultiTokenInfoVO:o,toDexMultiTokenInfoVO:r}=e?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}},i={...M(o),balance:"",reserveGas:e?.reserveGas},n={...M(r),balance:""};return{from:i,to:n}});s(this,"resetFromTo",async t=>{let{chainList:e,currentTab:o}=this.commonStore,r=o===w.BRIDGE;if(Number(t)!==Number(this.from.chainId)){let i=M(e).find(p=>Number(p.chainId)===Number(t)),{fromDexMultiTokenInfoVO:n,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:l}=i?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}};this.from={...M(n),balance:"",reserveGas:i?.reserveGas};let m=r&&l||c;this.to={...M(m),balance:""}}});s(this,"clearFromTo",()=>{this.from={},this.to={}});s(this,"updateBalanceIfNativeToken",(t,e)=>{e.isNativeToken?this.getTokenBalanceByAccount(t,e,!1).catch(kt):(this.setFromBalanceRequestError(!1),this.setBalance(t,e.amountNum))});s(this,"getSwapTokenBalance",(t=!1)=>{this.getTokenBalanceByAccount(C.FROM,M(this.from),t).catch(()=>{}),this.getTokenBalanceByAccount(C.TO,M(this.to),t).catch(()=>{})});s(this,"getTokenInfoAndBalance",async(t,e)=>{let o=this.accountStore.getAddressByChainId(t),r={chainId:t,tokenAddress:e,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:o,businessType:this.commonStore.computedCurrentTabIsLimit?qr.LIMIT_ORDER:qr.SWAP_ORDER};return y(E.get(Ai,{params:r}))});s(this,"needBalanceLoading",!0);s(this,"setNeedBalanceLoading",t=>{this.needBalanceLoading=t});s(this,"getTokenBalanceByAccount",async(t,e,o=!1)=>{let r=t===C.FROM,{chainId:i,tokenContractAddress:n}=e;if(tt(i)&&n&&this.accountStore.computedAccountId){this.needBalanceLoading&&(this.isBalanceLoading=!0);let c=await this.getTokenInfoAndBalance(i,n);if(this.isBalanceLoading=!1,this.setNeedBalanceLoading(!0),!this.commonStore.equalsToken(e,r?this.from:this.to))return;if(c[0]){if(o){this.fromBalanceRequestError=!1,this.toBalanceRequestError=!1;return}r?(this.fromBalanceRequestError=!0,this.fromBalanceState=et.BALANCE_REQUEST_FAILED):(this.toBalanceRequestError=!0,this.toBalanceState=et.BALANCE_REQUEST_FAILED),this.setBalance(t,"0","0","0");return}r?this.fromBalanceRequestError=!1:this.toBalanceRequestError=!1;let{amountNum:l,availableAmountNum:m,currencyAmount:p}=c[1]?.data||{};r&&this.setCacheTokenInfo({chainId:i,tokenContractAddress:n,amountNum:l},"api"),this.setBalance(t,l,m,p)}});s(this,"cacheTokenInfo",{});s(this,"setCacheTokenInfo",(t,e)=>{this.cacheTokenInfo=t,_.info(k.GET_BALANCE,{...t,tokenContractAddress:De(t.tokenContractAddress),type:e})});s(this,"setBalance",(t,e="",o="",r="")=>{let i=t===C.TO,n={balance:e,availableBalance:o,currencyAmount:r};i?this.updateTo({...this.to,...n}):this.updateFrom({...this.from,...n})});s(this,"setBalanceState",t=>{let{amount:e,address:o,from:r,to:i}=t;Boolean(o)&&Boolean(r.tokenContractAddress)?this.fromBalanceRequestError===!0?this.fromBalanceState=et.BALANCE_REQUEST_FAILED:Q(r.balance||"0").lt(e||"0")?this.fromBalanceState=et.BALANCE_INSUFFICIENT:this.fromBalanceState=et.COMMON:this.fromBalanceState=et.BALANCE_NOT_SHOW,!(Boolean(o)&&Boolean(i.tokenContractAddress))||!this.computedIsToAddressEqualsCurrentToAddress&&this.computedDiffCrossChain?this.toBalanceState=et.BALANCE_NOT_SHOW:this.toBalanceRequestError===!0?this.toBalanceState=et.BALANCE_REQUEST_FAILED:this.toBalanceState=et.COMMON});s(this,"updateFromBalancePush",t=>{let{coinAmountOriginalDec:e,availableAmountNum:o,currencyAmount:r}=t;this.commonStore.equalsToken(this.from,t)?(this.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:e},"ws"),this.setBalance(C.FROM,e,o,r)):this.commonStore.equalsToken(this.to,t)&&this.setBalance(C.TO,e,o,r)});s(this,"tokenReplaceMainToken",t=>{let e=t,{fromDexMultiTokenInfoVO:o}=this.getDexMultiDefaultTokenInfo(t?.chainId),{tokenSymbol:r,chainId:i}=o;return tt(t?.chainId)&&t?.tokenContractAddress&&(this.commonStore.getTokenAddress(t)===(this.commonStore.isSensitiveChain(i)?r:$t(r))||this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(o))&&(e={...o,amount:t.amount}),e});s(this,"onClickAddFunds",()=>{let{tokenSymbol:t,chainName:e}=this.from,{address:o}=this.accountStore,r={currency:t,network:e,address:o};this.getDeposit(r)});s(this,"calOrderUpdateFromTo",t=>{let{fromTokenUsd:e,toTokenUsd:o,fromAmount:r,toAmount:i}=t||{};We(r)||(this.from.amount=r),We(e)||(this.from.usdPrice=e),We(i)||(this.to.amount=i),We(o)||(this.to.usdPrice=o)});s(this,"isEvmChain",t=>tt(t)?this.commonStore.getChainByID(t)?.chainType!==Xs.NO_EVM_CHAIN:!0);s(this,"isTronChain",t=>t===V.TRON_MAINNET);s(this,"getFormatFromToToken",async({from:t,to:e},o)=>{let[r,i]=await Promise.all([this.checkQueryToken(t,o),this.checkQueryToken(e,o)]),n=r,c=i,l=m=>`${m?.chainId}-${m?.tokenContractAddress}`;if(r){let m=this.getInitializedValue(r?.chainId),p=Ge(Lr([r,i,m.from,m.to],l));n=p[0],c=p[1]}else if(i){let m=this.getInitializedValue(i.chainId),p=Ge(Lr([i,m.from,m.to],l));n=p[1],c=p[0]}return{token1:n,token2:c}});s(this,"orderContinueStatus",z.DEFAULT);s(this,"setOrderContinueStatus",t=>{this.orderContinueStatus=t});s(this,"fillSwapFromTo",async({apiRequestParams:t,locationParams:e})=>{let{closeModal:o}=this.rootStore.recentTransactionStore;!await this.beforeCheckAndGetTokenInfo(t,e)||(o(),this.setSwapAndLimitTypeValue(e.inputAmount))});s(this,"beforeCheckAndGetTokenInfo",async(t,e)=>{let{orderCheckContinue:o}=this.rootStore.oneMoreOrderStore;if(this.setOrderContinueStatus(z.LOADING),t&&!await o(t))return this.setOrderContinueStatus(z.ERROR),!1;let{token1:r,token2:i}=await this.getFormatFromToToken(e,!1);return!r||!i?(b.error({title:h("swaptrade_history_toast_setup_error"),duration:_t}),this.setOrderContinueStatus(z.ERROR),!1):(this.setOrderContinueStatus(z.READY),this.updateFromAndToInfo(r,i),!0)});s(this,"beforeCheckUrl",async t=>{this.setOrderContinueStatus(z.LOADING);let{orderCheckContinue:e}=this.rootStore.oneMoreOrderStore;return await e(t)?(this.setOrderContinueStatus(z.READY),!0):(this.setOrderContinueStatus(z.ERROR),!1)});s(this,"updateFromAndToInfo",(t,e)=>{this.updateFrom(t),this.updateTo(e)});this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore}get computedTypedValue(){return this.commonStore.currentTab===w.SWAP?this.singleTypedValue:this.typedValue}get computedFromMax(){return this.commonStore.currentTab===w.SWAP?this.singleFromMax:this.fromMax}get computedNeedCrossChainDoubleConfirm(){return this.computedIsSingleChain?!1:!this.needCrossChainDoubleConfirm}get dependentField(){return this.independentField===C.FROM?C.TO:C.FROM}get computedIsExactIn(){return this.independentField===C.FROM}get computedIsSingleChain(){return tt(this.from.chainId)&&tt(this.to.chainId)&&Number(this.from.chainId)===Number(this.to?.chainId)}get computedSwapAmount(){return{[this.independentField]:this.computedFromMax?Pe(this.computedTypedValue,{noNeedThousandth:!0}):this.computedTypedValue,[this.dependentField]:this.computedCalAmount[this.dependentField]}}get computedCalAmount(){return{[C.FROM]:Pe(this.from?.amount,{noNeedThousandth:!0})??"",[C.TO]:Pe(this.to?.amount,{noNeedThousandth:!0})??""}}get computedIfQuote(){return!!(this.computedTypedValueIsValid&&this.from&&this.to)}get computedTypedValueIsValid(){return!Q(this.computedTypedValue).isZero()&&!Q(this.computedTypedValue).isNaN()}get computedFromAmountIsValid(){let{amount:t}=this.from;return Ot(t)}get computedFromLocalCostByUsd(){let{usdPrice:t}=this.from;if(!this.computedFromAmountIsValid)return"";let{nowCurrencyUnit:e}=this.commonStore,{symbol:o,usdToThisRate:r}=e,i=Q(t);if(o&&t&&r&&!i.isNaN()){let c=i.multipliedBy(r).toString();return ht(c,o,{needBillionMillionUnit:!1})}return""}get computedToLocalCostByUsd(){let{usdPrice:t}=this.to,{nowCurrencyUnit:e}=this.commonStore,{symbol:o,usdToThisRate:r}=e,i=Q(t);if(o&&t&&r&&this.to.amount&&!i.isNaN()&&Ot(this.from.amount)){let c=i.multipliedBy(r).toString();return ht(c,o,{needBillionMillionUnit:!1})}return""}get computedRate(){let{from:t,to:e,computedIsExactIn:o}=this,{quoteStore:r,gasDropStore:i}=this.rootStore,n=I(r,"quote.bestRoute.gasDropFromAmount",""),c=n&&i?.gasDropConfig?.gasDrop?Q(t?.amount).minus(n):Q(t?.amount),l=e?.reverseReceiveAmount&&o||!o&&t?.amount;return c&&l?J(Q(e?.reverseReceiveAmount).div(c).toString(10),{needBillionMillionUnit:!1}):""}get computedToFromRate(){let{from:t,to:e,computedIsExactIn:o}=this,{quoteStore:r,gasDropStore:i}=this.rootStore,n=I(r,"quote.bestRoute.gasDropFromAmount",""),c=n&&i?.gasDropConfig?.gasDrop?Q(t?.amount).minus(n):Q(t?.amount),l=e?.reverseReceiveAmount&&o||!o&&t?.amount;return c&&l?J(Q(c).div(e?.reverseReceiveAmount).toString(10),{needBillionMillionUnit:!1}):""}get computedIsToAddressEqualsCurrentToAddress(){let t=this.accountStore.getAddressByChainId(this.to.chainId);return t&&this.rootStore.receiveAddressStore.computedReceiveAddr===t}get computedValueDifference(){let{quoteStore:t}=this.rootStore,{usdPrice:e}=this.from,{usdPrice:o,currentTime:r}=this.to,i=I(t,"quote.bestRoute.gasDropFromAmount",""),n=I(t,"quote.bestRoute.fromTokenAmount",""),c=Bt(e),l=Qr(e),m=Bt(o),p=Qr(o);if(c||l||m||p)return{isUp:!1,diff:"",isOver:!1,nowTime:new Date().getTime()};let g=i?Q(e).div(Q(n))*Q(i):"";e=i?e-g:e;let S=Q(o).minus(e).div(e).multipliedBy(100),A=Q(S.toFixed(2,1));if(A.gt(-.1)&&A.lt(.1))return null;let F=S.isNegative()?"":"+",O="";return S.gt(100)?O=`>${F}${vt(100,{needZero:!1})}`:S.lt(-100)?O=`<${F}${vt(100,{needZero:!1})}`:O=`${F}${vt(A.toString(10),{needZero:!1})}`,{isUp:S.gte(0),diff:O,isOver:S.lte(-10),currentTime:r,specialValueRangePrompt:S.gt(-10)&&S.lt(10),value:`${Q(S.toFixed(2,1)).toString(10).replace(/\+|-/,"")}`}}get computedIsCrossChain(){return tt(this.from.chainId)&&tt(this.to.chainId)&&Number(this.from.chainId)!==Number(this.to?.chainId)}get computedIsBridge(){let{from:t,to:e}=this;return this.computedIsCrossChain&&t.tokenSymbol===e.tokenSymbol}getDeposit(){}get computedDiffCrossChain(){let t=!!this.accountStore.address,e=this.commonStore.getChainByID(this.from.chainId),o=this.commonStore.getChainByID(this.to.chainId),r=String(this.from.isHoneypot),i=String(this.to.isHoneypot),{computedNonsupportChain:n}=this.accountStore,c=e?.crossChainType||"",l=o?.crossChainType||"";return t&&!n&&r!=="1"&&i!=="1"&&c&&l&&c!==l}get computedMaxTipsText(){let{from:t,maxDialogType:e}=this,{cacheNativeGasFee:o}=this.rootStore.quoteStore;if(!t.isNativeToken||!o||!t.tokenSymbol)return h("wallet_swap_toast_reserve_mainnet_token");let r={value:J(o),tokenSymbol:t.tokenSymbol};if(this.checkMaxDialogTypeIsEnough(e)){if(this.computedIsFromBtcCoin&&T.gt(this.computedUnavailableBalance,0)){let i=J(this.computedUnavailableBalance);return h("swaptrade_dialog_pay_card_reserved_from_wallet",{symbol:r.tokenSymbol,value:r.value,unablevalue:i})}return h("swaptrade_dialog_desc_reserved_netfee",r)}return h("swaptrade_dialog_desc_please_reserve",r)}get computedShowAddFund(){let{accountStore:t,swapBtnStore:e}=this.rootStore,{from:o}=this;return!t.computedNonsupportChain&&(this.independentField===C.FROM&&Q(this.computedTypedValue||0).gt(Q(o.balance||0))||e.computedTooBalance)||this.showAddFund&&!this.checkMaxDialogTypeIsEnough(this.maxDialogType)}get computedIsEvmChain(){return this.isEvmChain(this.from.chainId)}get computedDefaultAutoSlippageInfo(){let t=this.commonStore.getChainByID(this.from.chainId);return{autoSlippage:t?.toleranceSlippage?.selectItem,autoTotalSlippage:t?.crossToleranceSlippage?.selectItem}}get computedIsSolanaChain(){return Zo(this.from.chainId)}get computedIsAptosChain(){return Ln(this.from.chainId)}get computedIsTronChain(){return Jo(this.from.chainId)}get computedIsSuiChain(){return Rn(this.from.chainId)}get computedIsStacksChain(){return bn(this.from.chainId)}get computedIsStarknetChain(){return vn(this.from.chainId)}get computedHasToSwap(){let t=I(this.rootStore.quoteStore,"quote.bestRoute.toSwapFeeUsd");return this.computedIsCrossChain&&t>0}setSwapAndLimitTypeValue(t){let{computedCurrentTabIsLimit:e}=this.commonStore,{clearSellAndReceive:o}=this.rootStore?.limitOrderControlStore||{};e?o?.():Ot(t)?(this.setField(C.FROM),this.advanceSetTypedValue(t)):this.advanceSetTypedValue("")}get computedLeverageTokenPair(){return Pa(this.from,this.to)}get computedFormToTokenIsLeverageToken(){let[t,e]=this.computedLeverageTokenPair;return!!t||!!e}get computedIsFromBtcChain(){return kn(this.from.chainId)}get computedIsFromBtcCoin(){return this.computedIsFromBtcChain&&this.from.isNativeToken}get computedUnavailableBalance(){return Q(this.from.balance).minus(this.from.availableBalance).toString()}get computedIsFacetToken(){let{from:t,to:e}=this;return Number(t.tokenType)===be.FACET||Number(e.tokenType)===be.FACET}get computedNonsupportFacetToken(){let{address:t,walletConfig:{OKXWalletType:e,walletType:o}}=this.accountStore;if(!t)return!1;let r=[Dr.MNEMONIC,Dr.PRIVATE_KEY].includes(e),i=o===Do.METAMASK;return this.computedIsFacetToken&&!(r||i)}};var he=class extends ao{constructor(e){super(e);s(this,"getDeposit",()=>()=>{});s(this,"addFundsParams",{});s(this,"closeAddFunds",()=>{this.visibleAddFunds=!1});s(this,"onClickAddFunds",()=>{let{tokenSymbol:e,chainName:o,tokenLogoUrl:r,chainId:i,isNativeToken:n,tokenContractAddress:c}=this.from;this.visibleAddFunds=!0;let l={currency:e,network:o,iconUrl:r,chainId:i,isNativeToken:n,tokenContractAddress:n?"":c,receiveOnly:!0};this.baseAddFunds(l)});s(this,"baseAddFunds",e=>{this.visibleAddFunds=!0,this.addFundsParams={...e}});s(this,"tokenReplaceMainToken",(e,o)=>{let r=e,i=!jo(e),{fromDexMultiTokenInfoVO:n}=this.getDexMultiDefaultTokenInfo(i?o:e.chainId),{tokenSymbol:c,chainId:l}=n;return!i&&(this.commonStore.getTokenAddress(e)===(this.commonStore.isSensitiveChain(l)?c:$t(c))||this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(n))&&(r={...n,amount:e.amount}),r});it(this),St(()=>{let{computedDiffCrossChain:o,to:r}=this;return{computedDiffCrossChain:o,toChainId:r?.chainId}},({computedDiffCrossChain:o,toChainId:r})=>{this.cacheToChainId!==r&&this.rootStore.receiveAddressStore.saveReceiveAddressValue({}),this.rootStore.receiveAddressStore.setCacheToChainId(o&&r?r:-1)},{equals:Dt.shallow})}};u();d();L();u();d();j();var ns=class{constructor(t){s(this,"signIntentSwap",async()=>[]);s(this,"createIntentOrder",async t=>{let e={intentCode:t.offlineType,signature:t.signature,quote:t?.quote,userWalletAddress:this.rootStore?.accountStore?.address,defiPlatformId:t.defiPlatformId},[o,r]=await y(E.post(Ni,{...e}));return o&&(_.error(k.INTENT_ORDER_CREATE_ERROR,{error:o}),b.error({title:o?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),Ne({...st(),order_id:r?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[o,r]});s(this,"bridgeSumbitIntentOrder",async t=>{let{slippageStore:e,quoteStore:o,receiveAddressStore:r,fromToStore:i,accountStore:n}=this.rootStore,{quote:c,computedQuoteAmount:l}=o,{from:m,to:p}=i,{computedMinimumReceived:g,computedRealSlippageValue:S}=e,A=r?.receiveAddrObj?.specifiedAddress,v=S,F=c?.bestRoute?.bridge?.bridgeId,O=n?.address,mt={signature:t.signature,quote:t?.quote,defiPlatformId:t.defiPlatformId,receiveWalletAddress:A,fromChainId:m?.chainId,fromTokenAddress:m?.tokenContractAddress,fromAmount:l,toChainId:p.chainId,toTokenAddress:p.tokenContractAddress,toAmount:p.reverseReceiveAmount,walletAddress:O,bridgeId:F,minimumReceived:g,slippage:v},[ct,It]=await y(E.post(Fi,{...mt}));return ct&&(_.error(k.INTENT_ORDER_CREATE_ERROR,{error:ct}),b.error({title:ct?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),Ne({...st(),order_id:It?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[ct,It]});this.rootStore=t}},wa=ns;u();d();var Oa=Fe(["isConfirmLoading"],[]);var as=class extends wa{constructor(e){super(e);s(this,"isConfirmLoading",!1);s(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});s(this,"signIntentSwap",async(e,o)=>{let{signTransaction:r}=this.rootStore.sendTransactionStore,[i,n]=await r(o,e);return i&&(_.error(k.INTENT_SWAP_SIGN_ERROR,{error:i,msg:{chainId:e,unsignedTx:o}}),b.error({title:h("swaptrade_trading_mode_alert_order_fail")})),[i,n]});s(this,"onIntentSwap",async()=>{let{fromToStore:e}=this.rootStore;if(e?.computedIsCrossChain){await this.onIntentBridgeOrder();return}await this.onIntentSwapOrder()});s(this,"onIntentSwapOrder",async()=>{this.setIsConfirmLoading(!0),_.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=I(o,"quote.bestRoute.fromToken.chainId");try{let{offlineType:i,calldata:n,defiPlatformId:c}=o?.quote.bestRoute,{quote:l,unsignedTx:m}=n||{};if(!l||!m)return;let[p,g]=await this.signIntentSwap(r,m);if(p)return;let[S,A]=await this.createIntentOrder({quote:l,offlineType:i,signature:g,defiPlatformId:c});if(S)return;e.afterTransaction(A.data?.orderId)}catch(i){_.error(k.INTENT_SWAP_PROCESS_ERROR,{error:i})}finally{this.setIsConfirmLoading(!1),_.removeKeep()}});s(this,"onIntentBridgeOrder",async()=>{this.setIsConfirmLoading(!0),_.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=I(o,"quote.bestRoute.fromToken.chainId");try{let{bridge:i}=o?.quote.bestRoute,{calldata:n,defiPlatformId:c}=i,{quote:l,unsignedTx:m}=n||{};if(!l||!m)return;let[p,g]=await this.signIntentSwap(r,m);if(p)return;let[S,A]=await this.bridgeSumbitIntentOrder({quote:l,signature:g,defiPlatformId:c});if(S)return;e.afterTransaction(A.data?.orderId)}catch(i){_.error(k.INTENT_SWAP_PROCESS_ERROR,{error:i})}finally{this.setIsConfirmLoading(!1),_.removeKeep()}});xt(this,Oa)}},lr=as;u();d();u();d();j();var cs=class{constructor(t){s(this,"receiveAddrStatus",Re.NORMAL);s(this,"receiveAddrObj",{});s(this,"saveReceiveAddressValue",t=>{this.receiveAddrObj=this.filterReceiveWalletInfo(t),t?.specifiedAddress||this.initCheckAddrStatus()});s(this,"clearReceiveAddressValue",()=>{this.receiveAddrObj={},this.initCheckAddrStatus(),this.walletAddrInWeb3=[],this.getLinkedWalletAddrInWeb3().catch(()=>{})});s(this,"checkReceiveAddressLoading",!1);s(this,"filterReceiveAddress",(t,e,o=!0)=>{let r=e?.specifiedAddress||this.receiveAddrObj?.specifiedAddress||"";return r?t.filter(({specifiedAddress:i})=>o?i.includes(r):i===r):t});s(this,"filterReceiveWalletInfo",t=>{if(!t.specifiedAddress||t.walletId)return t;let e=this.filterReceiveAddress(this.initWalletAddrListFromChain,t,!1);return e.length?e[0]:t});s(this,"initCheckAddrStatus",()=>{this.checkReceiveAddressLoading=!1,this.receiveAddrStatus=Re.NORMAL});s(this,"checkReceiveAddr",async t=>{if(t||this.receiveAddrObj.specifiedAddress){this.checkReceiveAddressLoading=!0;let{to:e}=this.rootStore.fromToStore;try{let o=await Sn(e?.chainId,t||this.computedReceiveAddr),r=Symbol("requestId");if(this.currentRequestId=r,o){let{data:i}=await E.get(ki,{params:{address:t||this.receiveAddrObj.specifiedAddress,chainId:e?.chainId}});this.currentRequestId===r&&ut(()=>{this.receiveAddrStatus=i.status})}else ut(()=>{this.receiveAddrStatus=Re.ILLEGALITY})}catch(o){_.stuff(o),this.receiveAddrStatus=Re.ILLEGALITY}finally{this.checkReceiveAddressLoading=!1}}else this.initCheckAddrStatus()});s(this,"getSpecifiedChainWalletList",async t=>{let e=await this.getSpecifiedChainWalletListByWeb3(t),o={};return e?.forEach(r=>{let{specifiedAddress:i,walletType:n,createTime:c}=r,l=n===Do.OKEXCHAIN;o[i]&&o[i]?.has&&l?o[i].walletInfo.createTime<c&&(o[i].walletInfo=r):(!o[i]?.has||l)&&(o[i]={walletInfo:r,has:l})}),Object.keys(o).map(r=>o[r].walletInfo)});s(this,"walletAddrInWeb3",[]);s(this,"getLinkedWalletAddrInWeb3",async()=>{let{computedDiffCrossChain:t,to:e}=this.rootStore.fromToStore,{computedAccountId:o}=this.rootStore.accountStore;if(!t)return;let[r,i]=await y(this.getSpecifiedChainWalletList({chainId:e.chainId,walletIds:[o]}));r||ut(()=>{this.walletAddrInWeb3=i})});s(this,"initWalletAddrListFromChain",[]);s(this,"initWalletAddrListInStorage",[]);s(this,"filterWalletAddrListFromChain",[]);s(this,"filterWalletAddrListInStorage",[]);s(this,"getWalletList",async()=>{let{to:t}=this.rootStore.fromToStore,e=await this.getSpecifiedChainWalletList({chainId:t.chainId});ut(()=>{this.initWalletAddrListFromChain=e,this.filterWalletAddrListFromChain=e;let o=R.get(Je);if(o){let r=o[t.chainId]||[];this.initWalletAddrListInStorage=r,this.filterWalletAddrListInStorage=r}})});s(this,"getFilteredAddrList",t=>{this.filterWalletAddrListFromChain=this.filterReceiveAddress(this.initWalletAddrListFromChain,t),this.filterWalletAddrListInStorage=this.filterReceiveAddress(this.initWalletAddrListInStorage,t)});s(this,"saveWalletAddressToStorage",t=>{this.receiveAddrObj?.specifiedAddress&&R.set(Je,{[t.chainId]:[this.receiveAddrObj]})});s(this,"formatInputValue",t=>{let{specifiedAddress:e,deriveName:o,label:r}=t;if(e.length<=9)return e;let i=Qo(t.specifiedAddress);return o&&(i=`(${i})`,r?i=`${o} - ${r} ${i}`:i=`${o} ${i}`),i});this.rootStore=t}get computedSwapHighLight(){return this.receiveAddrStatus===Re.NORMAL&&!!this.receiveAddrObj?.specifiedAddress}get computedFormatReceiveAddr(){return this.receiveAddrObj?.specifiedAddress?this.formatInputValue(this.receiveAddrObj):""}get computedReceiveAddr(){return this.receiveAddrObj?.specifiedAddress||""}setReceiveAddress(t){this.receiveAddress=t}getReceiveAddress(){return this.receiveAddress}async getSpecifiedChainWalletListByWeb3(){return[]}get computedWalletAddrInWeb3(){return this.walletAddrInWeb3.length?this.walletAddrInWeb3[0]:null}get isFromFilterAddress(){let t=this.filterReceiveAddress(this.initWalletAddrListFromChain,this.receiveAddrObj?.specifiedAddress,!1),e=this.filterReceiveAddress(this.initWalletAddrListInStorage,this.receiveAddrObj?.specifiedAddress,!1);return!!(t.length+e.length)&&!!this.receiveAddrObj?.specifiedAddress}},Na=cs;var us=class extends Na{constructor(e){super(e);s(this,"formatInputValueEx",(e,o)=>{let{keyringName:r,walletName:i}=e;if(o.length<=9)return o;let n=Qo(o);return r&&(n=`(${n})`,i?n=`${r} - ${i} ${n}`:n=`${r} ${n}`),n});s(this,"cacheToChainId",-1);s(this,"setCacheToChainId",e=>{this.cacheToChainId=e});s(this,"addressListEx",[]);s(this,"getWalletListEx",()=>{let{accountStore:e,fromToStore:o}=this.rootStore,r=P.getNetWorkName(o.to.chainId),{walletList:i,addressBookList:n,keyringIdentityTypeEnum:c}=e,m=(R.get(Je)||{})[o.to.chainId]||[],p=ba(n,r),g=va(i,r);this.addressListEx=La({recentAddrData:m,addressBookData:p,walletListData:g,chainName:r,keyringIdentityTypeEnum:c})});it(this)}get computedFormatReceiveAddrEx(){let{accountStore:e,fromToStore:o}=this.rootStore,{walletConfig:r}=e;if(this.receiveAddrObj.specifiedAddress)return this.formatInputValueEx(this.receiveAddrObj,this.receiveAddrObj.specifiedAddress);let i=P.getNetWorkName(o.to.chainId),n=r?.account[i];return n?(this.receiveAddrObj={...r,specifiedAddress:n},this.formatInputValueEx(r,n)):""}},mr=us;u();d();L();u();d();j();u();d();L();L();var ds=class{constructor(t){s(this,"rootStore");this.rootStore=t}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote.bestRoute,{fromTokenPrice:r,toTokenPrice:i,fromToken:n,toToken:c}=o;return!Number(r)&&!Number(i)?t=n.tokenSymbol===c.tokenSymbol?U.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:U.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(i)||(t=U.TO_TOKEN_PRICE_UNKNOWN):t=U.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e}=this.rootStore,{computedValueDifference:o,computedIsCrossChain:r}=e;return o?.isOver&&(t=r?U.VALUE_DIFFERENCE_TOO_MUCH_CROSS:U.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1}}checkMinReceive(){let t=null,e=this.rootStore.quoteStore,o=this.rootStore.slippageStore;return e?null:(o?.computedMinimumReceivedIsOrange&&(t=U.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===Nr.ENOUGH&&(t=U.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===Jt.BTC_REPEAT?t=U.REPEAT_ORDER_BTC:o.repeatFlag===Jt.FACET_REPEAT?t=U.REPEAT_ORDER_FACET:o.enoughFlag!==Nr.ENOUGH&&(t=U.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkFacetTokenCrossChainDetail(){let{fromToStore:t}=this.rootStore,{from:e,to:o,computedNonsupportFacetToken:r}=t;if(r||R.get(ni))return null;let i=null;return e.tokenType!==o.tokenType&&(Number(e.tokenType)===be.FACET||Number(o.tokenType)===be.FACET)&&(i=U.FACET_SWAP_TIPS),{errorType:i,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!R.get(Zs)&&(t=U.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:r}=e,i=o.quote.bestRoute,{toTokenPrice:n,quoteNetWorkFeeOfMoney:c,fromSwapFeeUsd:l}=i,{BigNumber:m}=T;return(r?new m(l):new m(c)).gte(new m(n))&&(t=U.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:r}=e,i=Number(e.to.chainId)===1;if(r&&i){let n=I(o,"quote.bestRoute.toSwapFeeUsd"),c=I(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),l=I(o,"quote.bestRoute.bridge.toRiskLimit");T.BigNumber(n).dividedBy(c).gte(l)&&(t=U.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:r,updateBtcFromBalance:i}=t;if(o){if(!await i())throw Error("btc balance update failed");let c=e.computedInputVal,l=r.availableBalance;if(T.BigNumber(c).gt(l))return{errorType:U.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return ws(e)&&e!==0?e===4&&R.get(`${Lo}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||R.get(`${Lo}_${e}`)?null:{errorType:U.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}async checkThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedIsOkxProvider:e}=t,o=R.get(`${Lo}_${Js}`);return!e&&!o?{errorType:U.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkBridgeThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedBridgeIsOkxProvider:e,computedIsOfflineType:o}=t;return!e&&o?{errorType:U.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkDisclaimerVisible(){return fn()?{errorType:U.DISCLAIMER_VISIBLE,continueToNextInterceptor:!0}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkDisclaimerVisible,this.checkBridgeThirdPartyProvider,this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]:[this.checkDisclaimerVisible,this.checkThirdPartyProvider,this.checkVolatilitySlippage,this.checkBlockedRepeatOrder,this.checkFacetTokenCrossChainDetail,this.checkZeroValue,this.checkRepeatOrderWithEnoughBalance,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let r=e[o],{errorType:i,continueToNextInterceptor:n}=await r.call(this)||{};if(i&&(t.push(i),!n))return t}return t}},Da=ds;u();d();L();u();d();var xc=()=>{let{quoteStore:a}=D(),t=a.enableQuoteAggregates?I(a,"quote.bestRoute"):null;return I(t,"defiPlatformId")===$?h("swaptrade_trade_placeholder_okxdex"):I(t,"name")},ls=({disabled:a})=>{let{commonStore:t,fromToStore:e,buySellStore:o,quoteStore:r}=D();if(t.portal===Fo.MARKET)return o.tradeMode==="buy"?h("swaptrade_market_placeorder_btn_buy_symbol",{symbol:e.to.tokenSymbol}):h("swaptrade_market_placeorder_btn_sell_symbol",{symbol:e.from.tokenSymbol});let c=(r.enableQuoteAggregates?I(r,"quote.bestRoute"):null)?$s:a?nt:Ee;if(e.computedIsSingleChain){let l=xc();return h(c,{provider:l})}return h(Ys)},Fa=()=>{let{commonStore:a,buySellStore:t}=D();return a.portal===Fo.MARKET?t.tradeMode==="buy"?Yt.TYPE.green:Yt.TYPE.red:null},xa=()=>{let{commonStore:a,swapBtnStore:t,swapStore:e}=D();return a.portal===Fo.MARKET?e.isConfirmLoading:t.swapBtnLoading};var co=class{constructor(t){s(this,"swapBtnErrorTipsDialog",null);s(this,"swapInterceptor");s(this,"isInterceptionProcessing",!1);s(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));s(this,"notShowAgainCrossChainConfirm",!1);s(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});s(this,"tipsDialogInfo",this.defaultTipsDialogInfo());s(this,"swapBtnLoading",!1);s(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});s(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});s(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o}=this,{receiveAddressStore:r}=this.rootStore;r.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0)});s(this,"connectWallet",()=>{});s(this,"approve",()=>{});s(this,"cancelApprove",()=>{});s(this,"swap",()=>{});s(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{computedNotThirdBiz:r}=this.commonStore;Go({business_type:o?"swap":"bridge",trade_dialog:r?"no":"yes",from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.fetchDappList()});s(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?Xe:null});s(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:r,bestRoute:i,quoteError:n,quoteNull:c}=e.quote,{from:l,to:m,computedTypedValue:p}=t,{tokenContractAddress:g}=l,{computedRealSlippageValue:S}=o;return c||!i&&n&&!r||!p||!m.tokenContractAddress||!g||S>50||S<0?nt:null});s(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?nt:null);s(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?nt:null});s(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?nt:null);s(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:nt});s(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t}}=this;return t?null:Ke});s(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?nt:null});s(this,"nonsupportFacetToken",()=>{let{fromToStore:{computedNonsupportFacetToken:t}}=this;return t?nt:null});s(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?nt:null});s(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===et.BALANCE_REQUEST_FAILED?nt:null});s(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?$e:null);s(this,"approveStatus",()=>{let{approveStore:{computedApprovalStatus:t}}=this;return ti[t]||null});s(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?Ee:null});s(this,"getBtnStatus",()=>{let t=[this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.nonsupportFacetToken,this.isHoneypot,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let r=o();if(r){e=r;break}}return e||(e=nt),e});s(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||b.warn({title:h("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:r,commonStore:i,quoteStore:n,approveStore:c}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=r,this.commonStore=i,this.quoteStore=n,this.approveStore=c,this.swapInterceptor=new Da(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await y(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){_.error(k.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let r=-1,i=()=>{r++;let n=r===o.length-1;this.showErrorTips(o[r],n?t:i)};i()}getBtnAllStatus({from:t}){return{[Ke]:{statusType:Ke,disabled:!1,toLocaleText:()=>h(Ke),onClick:this.connectWallet},[$e]:{statusType:$e,disabled:!0,toLocaleText:()=>h($e,{tokenSymbol:q(t.tokenSymbol)}),symbol:t.tokenSymbol},[bo]:{statusType:bo,disabled:!1,toLocaleText:()=>h(bo,{tokenSymbol:q(t.tokenSymbol)}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.approve()},icon:"okx-defi-dex-authorization",iconType:Yt.ICON_POSITION.leading},[Ye]:{statusType:Ye,loading:!0,disabled:!0,toLocaleText:()=>h(Ye)},[Or]:{statusType:Ye,disabled:!1,toLocaleText:()=>h(Or,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:Yt.ICON_POSITION.leading},[vo]:{statusType:vo,loading:!0,disabled:!0,toLocaleText:()=>h(vo)},[nt]:{statusType:nt,disabled:!0,toLocaleText:()=>ls({disabled:!0})},[Ee]:{statusType:Ee,disabled:!1,loading:xa(),toLocaleText:()=>ls({disabled:!1}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.swap()},type:Fa()},[Xe]:{statusType:Xe,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>h(Xe),icon:"okds-open-link",iconType:Yt.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:r}=o,i=e.from.balance,n=t.safeMoonStore.computedInputVal;return r?T.BigNumber(i||0).isLessThan(n):!1}get computedBtnStatus(){let{fromToStore:t}=this,{from:e}=t,o=this.getBtnStatus();return this.getBtnAllStatus({from:e,swapLoading:this.swapBtnLoading})[o]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:r}=t,{quote:i,getGasTokenFeeLoading:n}=e,{fromTokenAmount:c="",inputToTokenAmount:l=""}=i?.bestRoute||{},m=!!r,p=m&&o&&T.BigNumber(r).isEqualTo(c),g=m&&!o&&T.BigNumber(r).isEqualTo(l);return!n&&(p||g)}};u();d();var Ma=Fe(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);u();d();var ps=()=>{let{accountStore:a}=D();zi({wallet_address:a.address,...ln()})};var fe=class extends co{constructor(e){super(e);s(this,"handleSwap",async()=>{let{quote:e,computedIsOfflineType:o}=this.quoteStore,{receiveAddressStore:r,swapStore:i}=this.rootStore,{from:n,cacheTokenInfo:c}=this.fromToStore;if(this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(e.bestRoute),_.info(k.CLICK_WALLET_SWAP_BUTTON,{chainId:n.chainId,tokenContractAddress:De(n.tokenContractAddress),amountNum:n.balance}),T.eq(n.balance,c.amountNum)||_.info(k.BALANCE_IS_ERROR,{chainId:n.chainId,tokenContractAddress:De(n.tokenContractAddress),amountNum:n.balance,cacheTokenInfo:{...c,tokenContractAddress:De(c.tokenContractAddress)}}),!o){let p=await this.walletContractStore.fetchCallData();if(this.swapBtnLoading=!1,p)return}this.swapBtnLoading=!1;let l=o?gt.INTENT_SWAP:gt.SWAP;r.saveWalletAddressToStorage(this.fromToStore?.to);let{fromToken:m}=He.get(e,"bestRoute",{});if(i.isSwapSolana(m.chainId)){P.history?.push({pathname:yo});return}P.history?.push({pathname:Mt,search:`needUpdate=${Oo.on}&type=${l}`})});s(this,"swap",async()=>{let e=this.checkIsCurrentQuote();Go({wallet_address:this.accountStore.address,button_name:"confirm",...st()}),e&&(this.swapBtnLoading=!0,this.runSwapInterceptor(this.handleSwap))});s(this,"approve",async()=>{this.approveStore.updateCurrentApproveTokenConfig({status:N.Approving});let e=await P.checkMpcAccountIfNecessary();if(ps(),!e){this.approveStore.updateCurrentApproveTokenConfig({status:N.UnApproved});return}this.approveStore.setApprove()});s(this,"cancelApprove",async()=>{this.approveStore.updateCurrentApproveTokenConfig({status:N.CancelApproving});let e=await P.checkMpcAccountIfNecessary();if(ps(),!e){this.approveStore.updateCurrentApproveTokenConfig({status:N.CancelApprove});return}this.approveStore.setApprove(ye.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,xt(this,Ma)}};u();d();u();d();L();j();u();d();L();var Mc=/\s/,Ba=a=>!(!Ls(a)||Mc.test(a)||a.length<10);u();d();L();var Vc=T.mul(.5,100),Gc=T.mul(.1,100),hs=a=>{let t=I(a,"quoteStore.quote.bestRoute.autoSlippageInfo",{}),{computedDefaultAutoSlippageInfo:e}=a.fromToStore;return{...e,...t}},uo=({isSingleChain:a,autoSlippageInfo:t})=>{let{autoSlippage:e,autoTotalSlippage:o}=t||{};return a?e||.01:o||.03},hr=a=>{let t=a.fromToStore.computedIsSingleChain,e=hs(a),o=uo({isSingleChain:t,autoSlippageInfo:e});return T.mul(T.ceilTruncate(o,3,!1),100)},Wc=a=>{let t=Nt(a);if(t.indexOf(".")>-1){let e=t.split("."),o=e[0],r=e[1];r&&r.length>1&&(r=r.slice(0,1)),t=`${o}.${r}`}return X(t)},fr=({inputSlippageParams:a,computedSafeMoonTips:t,minSlippageShow:e,maxSlippageShow:o=Vc,autoSlippageValue:r=0,isSingleChain:i=!0})=>{let{safeMoonSlippage:n=0,overLimit:c,equalLimit:l}=t||{};if(a===""&&!t)return{slippage:0,inputValue:"",notice:"",isError:!1};let m=Wc(a),p="",g=!1,S=!1;return t?.safeMoonSlippage?c||l||T.BigNumber(m).isZero()?p="":e>m?(p=h("swaptrade_settings_errortip_minimum_slippage",{cross:vt(e,{needZero:!1})}),g=!0,m=n):n>m?(p=h("swaptrade_settings_errortip_lowslippage_failed",{auto:vt(n,{needZero:!1})}),S=!0):m>o&&(p=h("swaptrade_card_swap_advance_options_exceeding_desc",{num:vt(o,{needZero:!1})}),g=!0,m=n):jt(m)?(m="",g=!0):m<e?(p=h(i?"swaptrade_dialog_modal_singlechain_limit":"swaptrade_dialog_modal_crosschain_limit",{value:T.thousandFormat(e)}),g=!0):m<r?(p=h("swaptrade_dialog_modal_transaction_failure"),g=!1):m>=Gc&&m<=o?(p=h("swaptrade_adjustslip_modalhint_actual_amount_less",{value:vt(m,{needZero:!1})}),g=!1):m>o&&(m=o,p=h("swaptrade_card_swap_advance_options_exceeding_desc",{num:vt(o,{needZero:!1})}),g=!0),{slippage:m,inputValue:a!==""?Nt(m):"",notice:p,isError:g,isWarning:S}},qa=({slippageInfo:a,isSingleChain:t})=>{let{autoSlippageInfo:e,customSlippage:o}=a,r={};return t?o||(r=Kt(e,["autoSlippage"])):r=Kt(e,["autoFromSlippage","autoToSlippage","autoTotalSlippage"]),Object.keys(r).forEach(n=>{let c=r[n],l=T.ceilTruncate(c,3,!1);r[n]=T.toPlainString(Number(l))}),{customSlippage:o,autoSlippageInfo:r}};var lo=class{constructor(t){s(this,"defaultGasFee","--");s(this,"isWalletConfirm",!1);s(this,"setWalletConfirm",t=>{this.isWalletConfirm=t});s(this,"isConfirmLoading",!1);s(this,"txInfo",{});s(this,"resetTxInfo",()=>{this.txInfo={}});s(this,"showRecentTransactionModal",t=>{this.confirmSwapVisible=!1,this.rootStore.recentTransactionStore.showModal(t)});s(this,"saveOrderParamsExtendSlippageAndGasPrice",t=>{let e={...t},{computedQuote:o,fromToStore:r}=this,{computedIsSingleChain:i,computedDefaultAutoSlippageInfo:n}=r,{autoSlippageInfo:c}=o.bestRoute||{},l=uo({isSingleChain:i,autoSlippageInfo:n}),m={autoSlippageInfo:c||{}},p=I(this,"rootStore.slippageStore");return p&&(l=p.computedRealSlippageValue,m=p.getOrderSlippageInfo()),Object.assign(e,{slippage:String(l),...qa({slippageInfo:m,isSingleChain:i})})});s(this,"saveOrderSingleChainParams",t=>{let{computedQuote:e}=this,{originDexRouterList:o,dexRouterList:r,serviceFeeInfo:i}=e.bestRoute||{};return{...t,dexRouterList:r,originDexRouterList:o,serviceFeeInfo:i}});s(this,"saveOrderCrossChainParams",t=>{let{computedQuote:e,fromToStore:o}=this,{receiveAddressStore:r}=this.rootStore,{to:i,computedDiffCrossChain:n}=o,{receiveAddrObj:c}=r,{fromDexRouterList:l,bridge:m,toDexRouterToList:p,originFromDexRouterList:g}=e.bestRoute||{};return{...t,toChainId:i.chainId,crossChainDexRouter:{fromDexRouterList:l,toDexRouterToList:p,bridge:m,originFromDexRouterList:g},...n?{receiveWalletAddress:c?.specifiedAddress}:{}}});s(this,"saveOrderParams",()=>{let{fromToStore:t}=this,{computedIsSingleChain:e}=t,o=this.baseSaveOrderParams();return e?this.saveOrderSingleChainParams(o):this.saveOrderCrossChainParams(o)});s(this,"calldataSign",null);s(this,"setCalldataSign",t=>{this.calldataSign=t});s(this,"extendSignParams",async t=>{let e={...t},o=I(this.quoteStore,"quote.bestRoute.permit2Data");if(o&&!this.calldataSign){let[r,i]=await this.checkPermit2();if(r)return null;this.setCalldataSign(i),e={...e,unsignedTx:o?.unsignedTx,signature:i}}else o&&this.calldataSign&&(e={...e,unsignedTx:o?.unsignedTx,signature:this.calldataSign});return e});s(this,"checkPermit2",async()=>{let t=I(this.quoteStore,"quote.bestRoute.permit2Data"),e=I(this.quoteStore,"quote.bestRoute.fromToken.chainId"),{signTransaction:o}=this.rootStore.sendTransactionStore,r=t?.unsignedTx,[i,n]=await o(r,e);return i&&(_.error(k.SIGN_PERMIT2_DATA,{error:i,unsignedTx:r}),oo(i)||Xt.error({title:h("swaptrade_trading_mode_alert_order_fail")})),[i,n]});s(this,"resetFromToAmount",()=>{this.fromToStore.updateFrom({amount:"",currentTime:"",prevAmount:"",usdPrice:""}),this.fromToStore.updateTo({amount:"",prevAmount:"",usdPrice:"",currentTime:""}),this.fromToStore.advanceSetTypedValue("")});s(this,"transferBtcPayload",t=>{let e={...t},{from:o}=this.fromToStore;return e.value=we(e.value,o.decimals),e});s(this,"getExtParams",t=>{let{computedIsSingleChain:e,to:o,from:r,computedDiffCrossChain:i}=this.fromToStore,{receiveAddrObj:n}=this.rootStore.receiveAddressStore,c=i?n?.specifiedAddress:o.tokenContractAddress;return{txSource:3,orderId:t,toTokenAddress:c,crossChain:e?0:1,chainId:r.chainId,tokenAddress:r.tokenContractAddress,amount:r.amount,toChainId:o.chainId}});s(this,"autoShowDialog",!0);s(this,"setAutoShowDialog",t=>{this.autoShowDialog=t});s(this,"confirmSwapVisible",!1);s(this,"setConfirmSwapVisible",t=>{this.confirmSwapVisible=t});s(this,"isSwapSolana",t=>!!(Zo(t)&&this.rootStore.solanaPriorityFeeStore?.jitoData));s(this,"extendSolanaCalldata",t=>{let{feeType:e,customFee:o,computedPriorityFeeList:r}=this.rootStore.solanaPriorityFeeStore||{},i=r.find(c=>c.type===e),n=o||i.fee;return{...t,tradeMode:2,priorityFee:n,customPriorityFee:!!o}});s(this,"solanaSwapParams",null);s(this,"setSolanaSwapParams",t=>{this.solanaSwapParams=t});s(this,"getSolanaCalldata",t=>(this.setSolanaSwapParams(t),y(E.post(qo,t))));s(this,"solanaTransaction",async(t,e)=>{let{from:o}=this.fromToStore,{computedAccountId:r}=this.accountStore,n=await no(o,{orderData:t,extParams:{}},this).jitoTransaction(),c=n.map(p=>p.payload.transaction),[l,m]=await y(this.rootStore.sendTransactionStore.signAllTransactions(c));if(l){this.onWalletFail(l,t?.orderId),this.isConfirmLoading=!1,_.removeKeep();return}await this.sendSolanaTransaction({signedTransactions:m,txArray:n,swapParams:e,walletId:r,enableJito:t.jitoEnable})});s(this,"sendSolanaTransaction",async({signedTransactions:t,txArray:e,swapParams:o,walletId:r,enableJito:i})=>{let[n,c]=await y(xn({signedTransactions:t,txArray:e,swapParams:o,walletId:r,enableJito:i}));if(this.isConfirmLoading=!1,_.removeKeep(),!n){let l=I(c,"data.broadcastResult.data.orderId");this.afterTransaction(l)}});this.rootStore=t,this.commonStore=t.commonStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore,this.tokenModalStore=t.tokenModalStore,this.quoteStore=t.quoteStore,this.gasDropStore=t.gasDropStore}get computedEstimateGasFee(){let t=this.defaultGasFee,e=this.commonStore.nowCurrencyUnit,o=I(this.computedQuote.bestRoute,"quoteNetWorkFeeOfMoney");if(this.isSwapSolana(this.fromToStore.from.chainId)&&this.quoteStore.enableQuoteAggregates){let i=I(this.rootStore.solanaPriorityFeeStore,"computedPriorityFeeOfUsd",0);o=T.add(i,o,{returnString:!0})}let r=T.BigNumber(o).multipliedBy(I(e,"usdToThisRate"));return!H(e)&&!r.isNaN()&&(t=ht(r.toJSON(),e?.symbol)),t}get computedCrossChainFromFee(){let t=I(this.computedQuote.bestRoute,"fromSwapFeeUsd");if(!t||jt(Number(t)))return"--";let{computedNowCurrencySymbol:e,currencyConversion:o}=this.commonStore,r=o(t).toString();return`${ht(r,e)}`}updateTxHash(t){this.rootStore.sendTransactionStore.updateTxHash(t)}cancelOrder(t){t&&this.rootStore.sendTransactionStore.cancelOrder(t)}baseSaveOrderParams(){let{accountStore:t,computedQuote:e,fromToStore:o,quoteStore:r,gasDropStore:i}=this,{from:n,to:c}=o,{estimateGasFee:l,minimumReceived:m,gasDropAmount:p,defiPlatformId:g,traceData:S}=e.bestRoute||{},{computedIsMevOpen:A}=this.rootStore.mevStore,v={chainId:n.chainId,fromAmount:T.BigNumber(r?.computedQuoteAmount).toString(10),fromTokenAddress:n.tokenContractAddress,fromTokenDecimal:String(n.decimals),toAmount:c.reverseReceiveAmount,toTokenAddress:c.tokenContractAddress,toTokenDecimal:String(c.decimals),userWalletAddress:t.address,estimateGasFee:l,pmm:"1",gasDropType:i?.computedGasDropSelected?1:0,gasDropAmount:p,minimumReceived:m,openMev:A,toChainId:c.chainId,traceData:S};g&&(v.defiPlatformId=g);let F=this.rootStore.outerStore.extendFeeConfig(v);return this.saveOrderParamsExtendSlippageAndGasPrice(F)}saveOrderUrl(){return Mo}onSaveOrder(t){let e={...t,...Dn()};return _.info(k.SAVE_ORDER_PARAMS,{data:e}),E.post(this.saveOrderUrl(),e)}saveOrderErr(t){let{error_code:e,error_message:o=""}=t,r=t?.data?.code||e||"";return _.error(k.SAVE_ORDER_ERROR,{error:t,tags:{errorCode:e||r,error_msg:`${k.SAVE_ORDER_ERROR}_${r}`}}),e==="10014"?Xt.error({title:h("swaptrade_toast_trade_not_available")}):Xt.error({title:o||h("swaptrade_toast_save_order_fail")})}saveOrderError(t){this.saveOrderErr(t),this.isConfirmLoading=!1,_.removeKeep()}async onSwap(t){this.isConfirmLoading=!0,_.keepLive(),this.setCalldataSign(null);let e=this.saveOrderParams(),o=await this.extendSignParams(e);if(!o){this.isConfirmLoading=!1;return}if(this.isSwapSolana(o.chainId)){await this.onSolanaSwap(o);return}let[r,i]=await y(this.onSaveOrder(o));if(r){this.saveOrderError(r);return}_.info(k.SAVE_ORDER,{data:i?.data,tags:{orderId:i?.data.orderId}}),Ne({...st(),order_id:i?.data.orderId,wallet_type:this.accountStore.walletConfig?.walletType});let[n]=await y(this.onChainTransaction({...i?.data,swapParams:o},t));n&&this.onWalletFail(n,i?.data?.orderId),this.isConfirmLoading=!1,_.removeKeep()}walletErrorMessage(t){let e=null;try{e=JSON.parse(t?.message)}catch{e={}}return e}walletErrToast(t,e){let o,r=this.walletErrorMessage(t);return _.error(k.SEND_ERROR,{error:t,tags:{orderId:e}}),r?.code===Wr.SLIPPAGE_LOW?o=h("swaptrade_home_toast_slippage_too_low"):r?.code===Wr.SEND_TX_ERROR_CODE&&(o=r?.message),Xt.error({title:o||h("swaptrade_home_toast_broadcast_failed")})}onWalletFail(t,e){oo(t)?this.cancelOrder(e):t?.code!==ui.RECEIPT_ERROR&&(eo.emit(to.FAIL,{data:{orderId:e},status:-2,message:wr("transaction fail")}),this.walletErrToast(t,e)),_.error(k.ON_WALLET_FAIL,{error:t,tags:{orderId:e}})}extendEvmParams(t){return t}isOkxWallet(){}async getTransactionPayload({orderData:t,orderId:e}){let{from:o}=this.fromToStore;return no(o,{orderData:t,extParams:this.getExtParams(e)},this).getSendTransactionParams()}sendTransactionEnhance(...t){return this.rootStore.sendTransactionStore.sendTransaction(...t)}getTransaction(){}logChainId(){return!0}async doubleCheckChainId(){return!0}async onChainTransaction(t,e){let{callData:o,orderId:r,swapParams:i}=t,n=await this.getTransactionPayload({orderData:t,orderId:r}),{computedIsEvmChain:c,from:l}=this.fromToStore;if(_.info(k.PAYLOAD,{payload:n,tags:{orderId:r}}),e)try{await e(...n)}catch(p){return _.error(k.BEFORE_SEND_TRANSACTION_ERROR,{error:p}),!1}return this.logChainId({message:k.CHECK_CHAIN_ID_BEFORE_SEND_TRANSACTION,fromChainId:l.chainId,saveOrderChainId:i.chainId,orderId:r}),await this.doubleCheckChainId({saveOrderChainId:i.chainId,orderId:r})?this.sendTransactionEnhance(...n).then(({result:p,nonce:g})=>{if(!Ba(p))throw new Error(`hash format is invalid: ${p}`);return this.txInfo={...o,txHash:p},T.BigNumber(g).isNaN()?(this.updateTxHash({orderId:r,transactionHash:p}),c&&this.getTransaction(p,this.fromToStore.from.chainId).then(S=>{_.info(k.UPDATE_NONCE,{nonce:S.nonce,tags:{orderId:r}}),this.updateTxHash({orderId:r,transactionHash:p,nonce:S.nonce})}).catch(S=>{_.error(k.UPDATE_NONCE_FAIL,{error:S})})):this.updateTxHash({orderId:r,transactionHash:p,nonce:g}),this.afterTransaction(r),this.logChainId({message:k.CHECK_CHAIN_ID_AFTER_SEND_TRANSACTION,fromChainId:l.chainId,saveOrderChainId:i.chainId,orderId:r}),!0}):!1}afterTransaction(t){this.setWalletConfirm(!0),this.autoShowDialog&&this.showRecentTransactionModal(t),eo.emit(to.TXHASH,{status:0,data:M(this.txInfo),message:wr("Transaction hash has been generated")})}get computedQuote(){return this.quoteStore.quote}checkRepeatOrderDetail(t){t&&this.rootStore.recentTransactionStore.showModal(t)}async onSolanaSwap(t){let e=this.extendSolanaCalldata(t),[o,r]=await this.getSolanaCalldata(e);if(o){this.saveOrderError(o);return}_.info(k.SAVE_ORDER,{data:r?.data,tags:{orderId:r?.data.orderId}}),Ne({...st(),order_id:r?.data.orderId,wallet_type:this.accountStore.walletConfig?.walletType}),await this.solanaTransaction(r.data,e)}};u();d();var Ua=Fe(["isWalletConfirm","isConfirmLoading","txInfo","confirmSwapVisible"],["computedEstimateGasFee","computedCrossChainFromFee","computedQuote"]);var Se=class extends lo{constructor(e){super(e);s(this,"sendTransactionEnhance",e=>{let{computedIsSolanaChain:o,computedIsTronChain:r,computedIsAptosChain:i,computedIsSuiChain:n,computedIsStacksChain:c,computedIsStarknetChain:l,computedIsFromBtcCoin:m}=this.rootStore?.fromToStore,{from:p}=this.rootStore?.fromToStore,{walletSendParams:g}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(p.chainId,e,g).then(S=>{let A,v;if(o)A=S.signature;else if(r){let{transaction:F}=S;A=F?.txID}else if(i)A=S;else if(n)A=S;else if(c)A=S.txHash;else if(l)A=S.transaction_hash;else if(m)A=S;else if(Pn(p.chainId))A=S.txHash;else{let{hash:F,nonce:O}=S;A=F,v=O}return{result:A,nonce:v}})});s(this,"showRecentTransactionModal",e=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,P.history.replace(`${je}/${e}`)});s(this,"baseSaveOrderParams",()=>{let e=super.baseSaveOrderParams(),{walletMevControl:o}=this.rootStore.mevStore;return{...e,openMev:e.openMev||o}});s(this,"extendsGas",e=>{let o={...e},{gasInfo:r}=this.rootStore.walletContractStore,{gasLimitInfo:i,isGasLimitLoading:n,gasType:c,...l}=r;return o.extParams.gasType=c,{...o,gasInfo:l}});s(this,"extendEvmParams",e=>{let o=super.extendEvmParams(e),{activityId:r}=this.rootStore.walletContractStore,i=this.rootStore.quoteStore.quote?.bestRoute?.isEnableMev;r&&(o.extParams.activityId=r);let{computedIsMevOpen:n,mevInfo:c,walletMevControl:l}=this.rootStore.mevStore;return o.extParams.isMev=n||l,o.extParams.mevInfo=c,!n&&Number(i)===oi.ON&&(o.extParams.isShowBlockSwapMevTooltip=!0),o});s(this,"onWalletFail",(e,o)=>{this.isConfirmLoading=!1,!e?.message?.includes(P.global?.HARDWALLETERROR)&&super.onWalletFail(e,o)});s(this,"checkRepeatOrderDetail",e=>{e&&P.history.push(`${je}/${e}`)});s(this,"checkUtxoBeforePublish",async e=>{let{utxoList:o}=e,{preDataForSendBtc:r}=this.rootStore.walletContractStore,{checkUtxoBeforePublish:i}=r;await i(o)});s(this,"onSwap",async()=>{this.isConfirmLoading=!0;let e=await P.checkMpcAccountIfNecessary();if(this.isConfirmLoading=!1,!e)return;let{computedIsOfflineType:o}=this.rootStore.quoteStore,{computedIsFromBtcCoin:r}=this.rootStore?.fromToStore;o?await this.rootStore.intentSwapStore?.onIntentSwap():await super.onSwap(r?this.checkUtxoBeforePublish:null)});s(this,"getSaveOrderMonitorData",()=>({...st(),...this.rootStore.walletContractStore.computedMonitorGasType}));xt(this,Ua)}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(e){return e}};u();d();L();L();u();d();L();L();j();u();d();u();d();var Va=function(){return new Promise(function(t){setTimeout(t,1)})};u();d();var Be=x(G());u();d();var Qc={[w.SWAP]:"swap_used_chain_cache",[w.LIMIT_ORDER]:"limit_used_chain_cache",[w.BRIDGE]:"bridge_used_chain_cache"},Ga=(a,t,e)=>{let o=Qc[e],r=R.get(o)||[];if(r.length===0&&(r=t.slice(0,4).map(n=>n.chainId)),a.forEach(i=>{r.includes(i)||r.unshift(i)}),r=r.filter(i=>t.find(n=>n.chainId===i)),r.length<4)for(let i=0;i<t.length&&r.length<4;i++)r.includes(t[i].chainId)||r.push(t[i].chainId);return r.length>4&&(r=r.slice(0,4)),R.set(o,r),r};u();d();var mo=class{constructor(t){s(this,"id",1);s(this,"tokenSymbol","--");s(this,"tokenName","--");s(this,"decimals",6);s(this,"tokenContractAddress","");s(this,"tokenLogoUrl","");s(this,"type","");s(this,"amountNum",0);s(this,"currencyAmount",0);B(this),Object.assign(this,t),this.tokenModalStore=D().tokenModalStore}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,r=T.BigNumber(this.currencyAmount);return r.isNaN()||r.isZero()?`${e||""}0.00`:e&&o&&!r.isNaN()&&!r.isZero()?ht(r.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===C.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===C.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return M(this)}};u();d();var po=(a={})=>({...dt,logoUrl:dt.logoUrl(),chainName:h(dt.localKey),...a}),Sr=(a={})=>{let t=Vs();return{...pt,get logoUrl(){return t===Us.dark?pt.darkLogoUrl():pt.logoUrl()},chainName:h(pt.localKey),...a}};var Wa="hide_collect_cancel_dialog",Qa="hideTokenGuide",ge=class{constructor(t){s(this,"searchValue","");s(this,"setSearchValue",t=>{this.searchValue=t});s(this,"fromTokenList",new Map);s(this,"toTokenList",new Map);s(this,"searchTokenList",{});s(this,"error",!1);s(this,"tokenModalVisible",!1);s(this,"tokenModalFromState",C.FROM);s(this,"setTokenModalFromState",t=>{this.tokenModalFromState=t});s(this,"loading",{[C.FROM]:{},[C.TO]:{}});s(this,"initLoading",()=>{this.loading={[C.FROM]:{},[C.TO]:{}}});s(this,"importTokenInfo",{});s(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});s(this,"toSelectedChainId","");s(this,"fromSelectedChainId","");s(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});s(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});s(this,"extendTokens",(t,e)=>t.filter(o=>this.commonStore.getChainByID(X(o.chainId))).map(o=>{let r=new mo(o,this);return{...o,balance:r.computedAmountNum,selected:r.computedIsSelect,selectedOrigin:e?r.computedIsSelectOrigin:!1,price:r.computedPrice}}));s(this,"extendTokenList",(t=[],e=!0)=>H(t)?t:this.extendTokens(t,e));s(this,"importUserToken",Ft(function*(e,o=!0){let r=e.map(c=>{let{chainId:l,tokenContractAddress:m,tokenSymbol:p,decimals:g}=c;return{chainId:l,contractAddress:m,tokenSymbol:p,precision:g}}),i={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:r},n=[];try{n=(yield E.post(di,i)).data}catch(c){throw b.error(h("swaptrade_pricechart_no_connection_desc")),c}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),n}));s(this,"sortTokens",t=>Fs(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));s(this,"orderTokenList",t=>this.computedIsCollectChain?t:this.commonStore.currentTab===w.BRIDGE?t.map(e=>({...e,tokenList:this.sortTokens(e.tokenList)})):this.sortTokens(t));s(this,"formatTokenList",(t,e)=>{let o=t;t.length>100&&e!==dt.chainId&&(o=t.slice(0,100));let r=this.extendTokenList(o,!0);return this.orderTokenList(r)});s(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});s(this,"clearCacheTokenList",()=>{});s(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===C.FROM,e={};if(this.clearCacheTokenList(),this.tokenModalFromState===C.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===C.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===pt.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===pt.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===dt.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===dt.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(C.FROM,e.fromChainId):this.getTokenList(C.TO,e.toChainId,e.fromChainId)});s(this,"setTokenList",(t,e,o)=>{let r=this.formatTokenList(e,t);this[`${o}TokenList`].set(t,r)});s(this,"cancelGetTokenListRef",null);s(this,"handleTokenList",Ft(function*(e,o,r,i){this.setError(!1),this.cancelGetTokenListRef&&this.cancelGetTokenListRef.abort(),this[`${e}TokenList`].get(o)||this.setLoading(e,o,!0),this.cancelGetTokenListRef=Ct();try{let{data:n}=yield E.get(r,{params:i,signal:this.cancelGetTokenListRef?.signal}),c=this.toLowerCaseContractAddress(n);return this.setTokenList(o,c,e),this.setLoading(e,o,!1),{data:c}}catch(n){return this.isCancel(n)?null:(this.setTokenList(o,[],e),this.setLoading(e,o,!1),this.setError(!0),n)}}).bind(this));s(this,"getCrossChainParams",(t,e,o)=>{switch(t){case w.BRIDGE:return{fromChainId:e.fromChainId??e?.chainId,userUniqueId:e.userUniqueId,accountId:e.accountId,userWalletAddress:e.userWalletAddress,...o,toChainId:o.toChainId===-1?"":o?.toChainId};case w.SWAP:default:return e}});s(this,"getTokenList",Ft(function*(e,o,r){let i={fromChainId:r,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(i={...i,businessLine:Le.LIMIT_ORDER});let n=this.getCrossChainParams(this.commonStore.currentTab,i,{selectChainType:this.getCrossChainSelectChainType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),c=X(o);if(this.computedIsNotSupportToChain)return this.setTokenList(c,[],e),{data:[]};let l=ie(se.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList(e,c,l,n)}));s(this,"getFromCollectedTokens",Ft(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:Le.LIMIT_ORDER});let o=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:re.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""}),r=ie(se.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(C.FROM,dt.chainId,r,o)}));s(this,"getToCollectedTokens",Ft(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:Le.LIMIT_ORDER});let r=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:re.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress}),i=ie(se.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(C.TO,dt.chainId,i,r)}));s(this,"getFromAllNetworksTokens",Ft(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:Le.LIMIT_ORDER});let o=ie(se.ALL_NETWORK,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:re.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""});return yield this.handleTokenList(C.FROM,pt.chainId,o,r)}));s(this,"getToAllNetworksTokens",Ft(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:Le.LIMIT_ORDER});let r=ie(se.ALL_NETWORK,this.commonStore.currentTab),i=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:re.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress});return yield this.handleTokenList(C.TO,pt.chainId,r,i)}));s(this,"cancelSearchRef",null);s(this,"needRemoveChainId",t=>[pt.chainId,dt.chainId].includes(X(t)));s(this,"getSearchChainType",()=>{let t=Po.SINGLE;return this.computedCurrentChainId===pt.chainId&&(t=Po.ALL_NETWORK),this.computedCurrentChainId===dt.chainId&&(t=Po.COLLECT),t});s(this,"getCrossChainSearchType",()=>this.computedCurrentChainId===dt.chainId?Zr.COLLECTION:Zr.COMMON);s(this,"getCrossChainSelectChainType",()=>this.tokenModalFromState===C.FROM?re.FROM:re.TO);s(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress},r={},i={};return this.tokenModalFromState===C.FROM?(r={inputContent:t,fromChainId:this.fromSelectedChainId,chainId:this.fromSelectedChainId,toChainId:this.fromSelectedChainId},this.needRemoveChainId(this.fromSelectedChainId)&&(delete r.fromChainId,delete r.toChainId,delete r.chainId)):this.tokenModalFromState===C.TO&&(i={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainId)&&(delete i.toChainId,delete r.chainId)),{...o,...r,...i}});s(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=Ct(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=vr(this.searchValue),e=this.getSearchParams(t);Xi({keyword:t});let o=ie(se.SEARCH,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{inputContent:e?.inputContent,selectChainType:this.getCrossChainSelectChainType(),searchType:this.getCrossChainSearchType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),[i,n]=await y(E.get(o,{params:{...r},signal:this.cancelSearchRef?.signal}));if(i&&!this.isCancel(i)){this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}if(n){let{data:c}=n;if(this.commonStore.currentTab===w.BRIDGE)this.setSearchTokenList({list:c});else{let{systemList:l,thirdPartyList:m}=n.data;this.setSearchTokenList({systemList:l,thirdPartyList:m})}this.setError(!1),this.setLoading(this.tokenModalFromState,"search",!1)}});s(this,"resetTokenModal",()=>{this.resetTokenData()});s(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});s(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:r,coinAmountOriginalDec:i}=e;for(let n=0;n<o.length;n++)if(this.commonStore.equalsToken(o[n],e)){o[n].amountNum=i,o[n].currencyAmount=r;break}return o});s(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=X(e),r=this.fromTokenList.get(o);r&&this.setTokenList(o,this.balancePushSort(M(r),t),C.FROM);let i=this.toTokenList.get(o);i&&this.setTokenList(o,this.balancePushSort(M(i),t),C.TO)});s(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,r={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(g=>g.chainId===e.chainId&&!g.disabled))return r;let{dexDefaultFromToTokenShowVO:i}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:n,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:l}=i,m=o===w.BRIDGE,p;return m&&l?p=l:this.commonStore.equalsToken(t,c)?p=n:p=c,{toToken:p,isChanged:!0}}return r});s(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return M(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});s(this,"updateTokenCollected",async(t,e=!1)=>{let{isConnectedWallet:o}=this.accountStore;if(!o){b.error(h("swaptrade_selecttoken_toast_connect_wallet"));return}let r=At({},{tokenContractAddress:t?.tokenContractAddress||this.rootStore.klineStore.chooseTokenContractAddress,chainId:Number(t?.chainId),symbol:t?.tokenSymbol,decimal:t?.decimals,isCustomToken:t?.isCustomToken||t?.isSubscribe,walletAddress:this.accountStore.address||this.accountStore.computedAccountWalletAddressesArray[0],userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId}),[i,n]=await y(E.post(Bo,r));this.updateTokenCollectedLocal(t),i?(b.error(h("swaptrade_pricechart_no_connection_desc")),this.updateTokenCollectedLocal(At({},t,{isCollectToken:t?.tokenInfo?0:1}))):n?.data===-1?e?b.error({title:h("swaptrade_selecttoken_modal_favorite_limitreached"),duration:.5}):this.setShowCollectOverLimitDialog(!0):n?.data===0?(b.success({title:h("swaptrade_selecttoken_toast_removed_from_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!1)):n?.data===1&&(Wo(),b.success({title:h("swaptrade_selecttoken_toast_added_to_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!0))});s(this,"hideCollectCancelConfirm",R.get(Wa));s(this,"showCollectOverLimitDialog",!1);s(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});s(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:r,currentTab:i}=this.commonStore,n=t&&t.length>0?t:[e.chainId,o.chainId];return Ga(n,r,i)});s(this,"tokenPageChainList",[]);s(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t});s(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>X(e.chainId)===X(this.toSelectedChainId)));s(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>X(o.chainId)===X(t))===-1){let o=this.commonStore.chainList.find(i=>X(i.chainId)===X(t)),r=[...this.tokenPageChainList];r.unshift(o),r.length>4&&r.pop(),this.setTokenPageChainList(r)}this.tokenModalFromState===C.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});s(this,"searchChainKeywords","");s(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});s(this,"filterChains",t=>Ge(t,e=>{let o=$t(vr(this.searchChainKeywords));return $t(e.chainName).includes(o)}));s(this,"dialogIndex",Br.TOKEN_LIST);s(this,"setDialogIndex",t=>{this.dialogIndex=t});s(this,"hideTokenGuide",!!R.get(Qa));s(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,R.set(Qa,"1")});s(this,"importToken",async(t,e)=>{let r=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(r),jo(r)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,r),this.setImportTokenInfo({}),this.setDialogIndex(Br.TOKEN_LIST)});s(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});s(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await Va(),!e)return;let{quoteStore:o}=this.rootStore,{from:r,updateFrom:i,updateTo:n,setBalance:c,setFromBalanceRequestError:l,setToBalanceRequestError:m,to:p,computedIsExactIn:g,needCrossChainDoubleConfirm:S,setNeedCrossChainDoubleConfirm:A}=this.fromToStore,{clearReceiveAddressValue:v}=this.rootStore.receiveAddressStore;this.setCommonlyUsedChain([t?.chainId]);let F=this.tokenModalFromState===C.FROM,O=()=>{this.rootStore.fromToStore.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:t.balance},"tokenList"),l(!1),c(C.FROM,t.balance)},mt=()=>{m(!1),c(C.TO,t.balance)};if(t.selected){F?mt():O(),this.fromToStore.onSwitchFromTo();return}F?O():mt();let ct=()=>{S||A(!0)};if(F){if(ji(t.chainId,p.chainId)&&this.commonStore.currentTab===w.BRIDGE){let It=new Ut(this.commonStore.currentTab,{}),[Ht,Lt]=await It.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:ks}=r,Co={...t},Ve;Ht?(i({...Co,amount:ks}),Ve=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,n({...Ve})):(Co=Lt.data.fromTokenInfo,Ve=Lt.data.toTokenInfo,i({...Co,amount:ks}),n(Ve),ct(),this.fromToStore.getTokenBalanceByAccount("from",Co)),this.fromToStore.getTokenBalanceByAccount("to",Ve)}else if(!this.commonStore.equalsToken(t,r)){let{amount:It}=r;o.setQuoteNumber(2),i({...t,amount:It});let{toToken:Ht,isChanged:Lt}=this.checkFromToLegal(t,p);n(Ht),Lt&&(ct(),this.fromToStore.getTokenBalanceByAccount("to",M(Ht))),g&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,p)||(ct(),o.setQuoteNumber(0),n({...t,amount:""}),g||this.fromToStore.advanceSetTypedValue(""));v()});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===C.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return H(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return qt(t)}getSearchParams(){throw new Error("getSearchParams method must be implemented by subclass")}get computedFromChain(){let t=po(),e=Sr({});return[t,e,...M(this.tokenPageChainList)]}get computedToChain(){let t=po();if(tt(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId||tt(this.toSelectedChainId)?this.toSelectedChainId:tt(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?pt.chainId:Ze}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let r=e?.isCollectToken;return At({},e,{isCollectToken:r?0:1,collectTime:r?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],r=!1)=>o.map(i=>this.reassignTokenInfo(i,t,r)).filter(i=>this.filterCollectToken(i));if(this.searchValue){let{systemList:o,thirdPartyList:r}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(r,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===C.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===C.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return X(this.tokenModalFromState===C.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedIsCollectChain(){return this.computedCurrentChainId===dt.chainId}setShowCollectCancelConfirm(t){R.set(Wa,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===C.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===C.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===C.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===C.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===C.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=Ao(M(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}};var gr=class extends ge{constructor(e){super(e);s(this,"showChainTab",!0);s(this,"clearCacheTokenList",()=>{this.fromTokenList.clear(),this.toTokenList.clear()});s(this,"extendTokenList",(e=[],o=!0)=>H(e)?e:e?.map(r=>({...r,tokenList:this.extendTokens(r.tokenList,o)})));s(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,r=Ao(M(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return Os([...r],"chainId")});it(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===C.TO&&!o}get computedSearchTokenList(){return this.extendTokenList(this.searchTokenList?.list,!1)}get computedToChainList(){let e=this.commonStore.chainList,o=[],r=[],i=this.generateToChainMap();return e.forEach(n=>{let c={...n};c.disabled=!i[n.chainId],c.disabled||o.push(c)}),{supported:o,unsupported:r}}updateTokenCollectedLocal(e){let o=(r=[],i=!1)=>{let n=[];return r?.forEach(c=>{let l=c?.tokenList.map(m=>this.reassignTokenInfo(m,e,i)).filter(m=>this.filterCollectToken(m));n.push({tokenList:l})}),n};if(this.searchValue){let{list:r}=this.searchTokenList;this.setSearchTokenList({list:o(r)})}else this.updateTokenList(o)}get computedToChain(){let e=po(),o=Sr({});if(tt(this.fromToStore.from.chainId)){let r=this.generateToChainMap(),i=[];return M(this.tokenPageChainList).forEach(n=>{n.chainId!==Number(this.fromToStore.from.chainId)&&i.push({...n,disabled:!r[n.chainId]})}),[e,o,...i]}return[e]}getSearchParams(e){let o=this.getSearchChainType(),r={inputContent:e,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:o,userWalletAddress:this.accountStore.computedSpecialWalletAddress};return this.tokenModalFromState===C.FROM&&(r={...r,fromChainId:this.fromSelectedChainId},this.needRemoveChainId(this.fromSelectedChainId)&&delete r.fromChainId),this.tokenModalFromState===C.TO&&(r={...r,fromChainId:this.fromToStore.from.chainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||"",toChainId:this.toSelectedChainId},this.needRemoveChainId(this.toSelectedChainId)&&delete r.toChainId),r}};u();d();j();var fs=class{constructor(t){s(this,"sendTransactionParams",{});s(this,"waitingHandleOrderList",[]);s(this,"needIntercept",!1);s(this,"updateHistoryOrderList",t=>{let e=rt(),o=[],r=[],i=this.rootStore.recentTransactionStore;i.pendingOrders.forEach(n=>{let c=n;n.orderId===t&&(c={...n,status:Xo.PendingRedeeming}),o.push(c)}),!e&&i.history?.list?.forEach(n=>{let c=n;n.orderId===t&&(c={...n,status:Xo.PendingRedeeming}),r.push(c)}),i.setPendingOrders(o),!e&&i.setHistory({...i.history,list:r})});s(this,"sendTransactionEnhance",async({callData:t,chainId:e,redeemOrderIdPre:o,redeemOrderId:r,bizType:i},n=()=>{})=>{let c=rt(),l=`${o}:${r}`;if(!c&&this.setWaitingHandleList(l),this.needIntercept)return;let m;if(rt()){let p=this.rootStore.swapStore.extendsGas(t);m=this.sendTransactionStore.sendTransactionEnhance(e,p,this.rootStore?.walletContractStore?.walletSendParams)}else{if(!await this.rootStore.commonStore.connectAndSwitchNetwork(e))return;m=this.sendTransactionStore.sendTransactionEnhance(t)}m.then(({result:p,hash:g,nonce:S})=>{!c&&this.setWaitingHandleList(l,!0),this.sendTransactionStore.updateTxHash({orderId:r,transactionHash:c?g:p,bizType:i,nonce:S}),Hi(n),this.updateHistoryOrderList(o),c||this.sendTransactionStore.getTransaction(p,e).then(A=>{_.info(k.UPDATE_NONCE,{nonce:A.nonce,tags:{orderId:r}}),this.sendTransactionStore.updateTxHash({orderId:r,transactionHash:p,nonce:A.nonce,bizType:i})}).catch(A=>{_.error(k.UPDATE_NONCE_FAIL,{error:A,transactionHash:p,tags:{orderId:r}})})}).catch(p=>{!c&&this.setWaitingHandleList(l,!0),_.error(k.REDEEM_ORDER_ERROR,{error:p,tags:{orderId:r}})})});s(this,"walletSendRedeem",()=>{this.sendTransactionEnhance(this.sendTransactionParams,()=>{P.history?.goBack()})});s(this,"facetOrderDetail",{});this.rootStore=t,this.sendTransactionStore=t.sendTransactionStore,B(this,{},{autoBind:!0})}setSendTransactionParams(t){this.sendTransactionParams=t}async launchFacetSwap(t){let e=rt(),{data:o}=this.rootStore.recentTransactionStore.detail,r=t?t.orderId:o?.orderId,i=t?t.chainId:o?.fromChainId,n=t?t.toTokenAddress:o?.toTokenAddress,c=t?t.fromTokenAddress:o?.fromTokenAddress,l={orderId:r,chainId:i,userWalletAddress:this.rootStore.accountStore.getAddressByChainId(i)};if(e&&t?.goOrderDetail){P.history?.push(`${je}/${r}`);return}let[m,p]=await y(E.post(vi,l));if(m){_.error(k.REDEEM_ORDER_CALL_DATA_ERROR,{error:m,tags:{orderId:r}}),Number(m?.code)===100002&&this.rootStore.recentTransactionStore.removePendingOrder(r),b.error({title:m?.msg||h("swaptrade_top_notif_data_failed")});return}let{redeemSignatureVo:g,redeemDetailInfo:S,redeemOrderId:A,bizType:v}=p?.data||{},{unsignedTx:F,...O}=g||{},mt={...O,extParams:{toTokenAddress:n,crossChain:0,tokenAddress:c,amount:S.fromTokenAmount,toChainId:i,...l}},ct={callData:mt,chainId:i,redeemOrderIdPre:r,redeemOrderId:A,bizType:v};if(this.setSendTransactionParams(ct),_.info(k.REDEEM_ORDER,{callData:mt,tags:{orderId:A}}),e){this.setFacetOrderDetail({...S}),this.rootStore.walletContractStore.setTransactionPayload(mt),P.history?.push({pathname:Mt,search:`needUpdate=${Oo.off}&type=${gt.REDEEM}`});return}await this.sendTransactionEnhance(ct)}setWaitingHandleList(t,e=!1){this.waitingHandleOrderList.find(r=>r===t)?e?(this.waitingHandleOrderList=this.waitingHandleOrderList.filter(r=>r!==t),this.needIntercept=!1):(b.warn({title:h("swaptrade_history_notification_desc_wallet_confirm")}),this.needIntercept=!0):(this.waitingHandleOrderList=[...this.waitingHandleOrderList,t],this.needIntercept=!1)}getFacetExploreUrl(t){let{data:e}=this.rootStore.recentTransactionStore.detail,o=[e?.fromChildOrderDetailVo?.exploreUrl,e?.relativeTransaction?.exploreUrl];return this.computedIsFacetTradeType&&o?.[t]||""}get computedIsFacetTradeType(){let{data:{specialOrderType:t}}=this.rootStore.recentTransactionStore.detail;return t===yn.FromIsEthChainFacetCoin}get computedShowFacetTip(){return this.rootStore.recentTransactionStore.detail.data.status===Xo.PendingCanRedeem}setFacetOrderDetail(t){this.facetOrderDetail=t}get computedFacetOrderToFromRate(){let{price:t}=this.facetOrderDetail;return t&&!Bt(t)&&t!=="-1"?J(t):""}get computedFacetOrderFromToRate(){let{price:t}=this.facetOrderDetail;return t&&!Bt(t)&&t!=="-1"?J(T.BigNumber("1").div(t).toString(10),{needBillionMillionUnit:!1}):""}get computedFacetOrderTokens(){let{fromToken:t,toToken:e,fromTokenAmount:o,toTokenAmount:r}=this.facetOrderDetail;return{fromToken:{...t,amount:o},toToken:{...e,amount:r}}}get computedFacetOrderMinimumReceived(){return this.facetOrderDetail.minimumReceived}get computedFacetTipParams(){let t=this.rootStore.recentTransactionStore.detail?.data;return{amount:J(t?.fromChildOrderDetailVo?.toAmountOut,{needBillionMillionUnit:!1}),token:t?.fromChildOrderDetailVo?.toTokenSymbol}}},Tr=fs;u();d();L();L();j();var Te=class{constructor(t){s(this,"liquidityModelVisible",!1);s(this,"dataStatus",z.DEFAULT);s(this,"setDataStatus",t=>{this.dataStatus=t});s(this,"rawData",[]);s(this,"LiquidityCancelRef",null);s(this,"fetchLiquidityData",async()=>{this.resetAllLiquidityData(),this.setDataStatus(z.LOADING);let{from:t}=this.fromToStore;this.LiquidityCancelRef&&this.LiquidityCancelRef.abort(),this.LiquidityCancelRef=Ct();let[e,o]=await y(E.get(Li,{params:{chainId:t.chainId},signal:this.LiquidityCancelRef?.signal,isolate:!0}));if(e)this.setDataStatus(z.ERROR);else{let r=I(o,"data");H(r)?this.setDataStatus(z.NULL):(this.initAllLiquidityData(r),this.setDataStatus(z.READY))}});s(this,"selectedListIds",[]);s(this,"setSelectedListIds",t=>{this.selectedListIds=t});s(this,"confirmIds",null);s(this,"setConfirmIds",t=>{this.confirmIds=t});s(this,"filterSelectedListIds",(t,e)=>{let o;e?o=Pr(this.selectedListIds,t):o=Rs(this.selectedListIds,t),this.setSelectedListIds(Qe(o))});s(this,"searchLiquidityValue","");s(this,"setLiquiditySearchValue",t=>{this.searchLiquidityValue=t});this.rootStore=t,this.fromToStore=this.rootStore.fromToStore,B(this,{},{autoBind:!0})}setLiquidityModelVisible(t){this.liquidityModelVisible=t}setData(t){this.rawData=t}resetAllLiquidityData(){this.setData([]),this.setSelectedListIds([]),this.setConfirmIds(null)}initAllLiquidityData(t){this.setData(t);let e=_o(t,"id");this.setSelectedListIds(e);let o=this.fromToStore.from.chainId;tt(o)&&this.setConfirmIds(xs({},o,e))}get computedListCheckedAll(){return this.computedSearchStatus?this.computedSearchIfAllChecked:this.selectedListIds.length===this.rawData.length}get computedCheckedAllDisabled(){return this.computedSearchStatus&&H(this.computedSearchData)}get computedLiquidityNum(){let{from:t}=this.rootStore.fromToStore,e="--",{dataStatus:o,rawData:r,confirmIds:i}=this;if(o===z.NULL)e="0 / 0";else if(o===z.READY){let n=I(i,t.chainId);e=`${!n||n&&n.length===0?r.length:n.length} / ${r.length}`}return e}get computedClearAll(){return H(this.selectedListIds)}checkAllBtn(){let t="",e=this.computedSearchStatus?this.computedSearchData:this.rawData,o=_o(e,"id");this.computedListCheckedAll?t=Pr(this.selectedListIds,...o):t=Ms(this.selectedListIds,o),this.setSelectedListIds(Qe(t))}get computedCheckedData(){return _o(this.rawData,e=>({...e,isChecked:!!Ps(this.selectedListIds,e.id)}))}get computedSortListData(){return en(this.computedCheckedData)}get computedSearchStatus(){return!!this.searchLiquidityValue}get computedSearchDataIsNull(){return this.computedSearchStatus&&H(this.computedSearchData)}get computedSearchData(){return on(this.computedCheckedData,this.searchLiquidityValue)}get computedSearchIfAllChecked(){let t=bs(this.computedSearchData,e=>e?.isChecked);return!H(this.computedSearchData)&&t}get computedShowData(){return this.searchLiquidityValue?this.computedSearchData:this.computedSortListData}get computedIds(){return I(this.rootStore.liquidityChooseStore?.confirmIds,this.rootStore.fromToStore?.from.chainId)}get computedIsCustomLiquidity(){return(this.computedIds||[]).length<this.rawData.length}get computedMonitorLiquidSelectType(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length?"all":t.length>1?"custom_>1":t.length===1?"custom_=1":""}get computedIsSelectedAllDex(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length}};u();d();L();j();var Ss=class{constructor(t){s(this,"orderCheckContinue",async t=>{let[e,o]=await y(E.get(Pi,{params:t}));if(e)return b.error({title:h("swaptrade_history_toast_setup_error"),duration:_t}),!1;let r=I(o,"data"),i=String(r?.checkCode);return i===ve.SUCCESS?!0:(i===ve.SINGLE_ERROR||i===ve.LIMIT_SINGLE_ERROR?b.error({title:h("swaptrade_history_toast_chain_unsupported",{chain:r?.fromChainName}),duration:_t}):i===ve.CROSS_ERRORL||i===ve.LIMIT_CROSS_ERRORL?b.error({title:h("swaptrade_history_toast_both_unsupported",{fromChain:r?.fromChainName,toChain:r?.toChainName}),duration:_t}):b.error({title:h("swaptrade_history_toast_setup_error"),duration:_t}),!1)});this.rootStore=t,B(this,{},{autoBind:!0})}},Cr=Ss;u();d();L();var{BigNumber:Ha}=T,gs="safemoon_slippage",Ts="safemoon_is_changed",ja=50,Cs={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},Ce=class{constructor(t){s(this,"isChanged",!1);s(this,"getSafemoonIsChangedLocal",()=>!!R.get(`${Ts}_${this.computedSlippageTokenPair}`));s(this,"cacheSlippage",0);B(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,St(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(R.get(`${Ts}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(R.get(`${gs}_${this.computedSlippageTokenPair}`))}),St(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(R.get(`${gs}_${this.computedSlippageTokenPair}`))}),St(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t,R.set(`${Ts}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new Ha(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),R.set(`${gs}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new Ha(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return hr(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=I(this,"rootStore.quoteStore.quote.bestRoute"),e=Number(this.computedAutoSlippage),{tokenSymbol:o}=this.computedSafeMoonToken||{};return t?.isSafeMoonToken!=="1"||t?.isHoneypot==="1"?null:e===ja?{type:Cs.AdviseGivenSlip,safeMoonSlippage:e,equalLimit:!0,tip:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:o,slippageTolerance:e}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:q(o),slippageTolerance:e}),inputWarning:h("swaptrade_adjustslip_modal_advise_givenslip")}:e>ja?{type:Cs.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:e,tip:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:o}),tipEquation:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:q(o)})}:{type:Cs.AdviseSlip,safeMoonSlippage:e,tip:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:o}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:q(o)}),inputWarning:h("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:e})}}checkIsSafeMoon(t){return I(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return I(t,"isHoneypot")===1}get computedInputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e[C.FROM]}get computedInputFiatVal(){let{computedIsExactIn:t,computedFromLocalCostByUsd:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e}get computedOutputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return t&&this.computedHoneypot?"":e[C.TO]}get computedOutputFiatVal(){let{computedIsExactIn:t,computedToLocalCostByUsd:e}=this.fromToStore;return t&&this.computedHoneypot?"":e}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return this.computedHoneypot?"":Pe(t[C.TO])}};u();d();var Ir=class{constructor(){s(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:R.get(Fr)===zs.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});s(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});s(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),R.set(Fr,`${Number(t)}`)});s(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});B(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};u();d();var Is=class{constructor(t){s(this,"isShowMev",!1);s(this,"setShowMev",t=>{this.isShowMev=t});s(this,"mevSwitchOpenStatue",No.AUTO_OFF);s(this,"setMevUserSwitchOpen",t=>{this.mevSwitchOpenStatue=t});s(this,"mevInfo",{});s(this,"setMevInfo",t=>{this.mevInfo=t});s(this,"walletMevControl",!1);s(this,"setWalletMevControl",t=>{this.walletMevControl=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,B(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isShowMev&&(this.mevSwitchOpenStatue===No.AUTO_ON||this.mevSwitchOpenStatue===No.USER_ON)}},Ar=Is;u();d();L();var As=class{constructor(t){s(this,"feeConfig",{});s(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!H(t)){this.feeConfig=t,Zt.set("feeConfig",t);return}let e=Zt.get("feeConfig"),o=Kt(e,["referrerAddress","feePercent"]);H(o)?(this.feeConfig={},Zt.remove("feeConfig")):this.feeConfig=o});s(this,"widgetFeeConfig",{});s(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});s(this,"receiveQuoteUrl",()=>this.isIframe?mi:hi);s(this,"aggregatorQuoteUrl",()=>Si);s(this,"saveOrderUrl",()=>this.isIframe?Ti:Mo);s(this,"illegalFeePercent",t=>{let{BigNumber:e}=T,o=e(t);return!!(o.isNaN()||o.gt(ii)||o.lte(0))});s(this,"extendFeeConfig",t=>{if(this.isWidget){let o=I(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let r=I(o,["referrerAddress",t.fromTokenAddress]),i=I(r,"account"),c=I(r,"feePercent")||o.feePercent;return i?{...t,referrerAddress:i,feePercent:c}:t}if(!this.computedHasFeeConfig)return t;let e=H(this.feeConfig)?Zt.get("feeConfig"):this.feeConfig;return{...t,...e}});B(this),this.rootStore=t,this.isIframe=!rt()&&Ki()&&!Ho,this.isWidget=!rt()&&$i()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},_r=As;u();d();j();u();d();L();j();u();d();var Ka=()=>{let{swapStore:a,intentSwapStore:t,swapDappStore:e,approveStore:o,fromToStore:r}=D(),{from:i,to:n}=r;return!(!n?.tokenContractAddress||!i?.tokenContractAddress||o.visibleApprove||a.isConfirmLoading||t.isConfirmLoading||e.computedSupportDappTradeByChain)};u();d();u();d();var $a=a=>{let{fromToStore:t,quoteStore:e}=D(),{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:i}=a,{computedIsSingleChain:n}=t,c=Number(o?.code)===bt.CROSS_CHAIN_INTERVAL,l=c?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(l),{isAutoError:c||(n?!i:!r?.length)}};var Hc=({quoteStore:a,fromToStore:t})=>{a.setQuoteNumber(a.quoteNumber+1),a.quoteNumber===1&&a.checkQuoteScopeLtMin(a.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},jc=(a,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:i,swapType:n,intentCode:c,isSupportDappTrade:l,offlineType:m,traceData:p,serviceFeeInfo:g}=a,S={intentCode:c,offlineType:m,swapType:n,traceData:p},A=r?.map(F=>({...o,...F,...S,isSupportDappTrade:l}));return{bestRoute:t.computedIsSingleChain?{...o,...i,...S,serviceFeeInfo:g,intentInfo:a?.intentInfo||{},isSupportDappTrade:l}:e.pickBestRouterAccordingBridgeId(A)||{...o,...S,isSupportDappTrade:l},combineSelectionRouterList:A}},Kc=({bestRoute:a,combineSelectionRouterList:t,isAutoError:e},{fromToStore:o,quoteStore:r})=>{r.updateSlippageInfoFetched(a),r.setQuote({...r.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1}),o.quoteUpdateFromTo(a),o.computedIsSingleChain||r.setPathSelectionRouterList(t||[])},ho=({isAutoError:a},{approveStore:t})=>{a||t.isPendingNotCheck().catch(()=>{})},fo=({isAutoError:a},{quoteStore:t})=>{a&&(t.handleReverseQuoteErrorAndNull(),ut(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},$c=a=>{let{solanaPriorityFeeStore:t}=D();t&&t.setJitoData(a?.priorityFeeInfo)},Ya=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=D(),{isAutoError:r}=$a(a);Hc({quoteStore:e,fromToStore:t});let{bestRoute:i,combineSelectionRouterList:n}=jc(a,{fromToStore:t,quoteStore:e});Kc({bestRoute:i,combineSelectionRouterList:n,isAutoError:r},{fromToStore:t,quoteStore:e,approveStore:o}),$c(a),ho({isAutoError:r},{approveStore:o}),fo({isAutoError:r},{quoteStore:e})};u();d();var So=class{constructor(t){s(this,"allTimerAndQuoteState",{[ot.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[ot.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>h(ko)},[ot.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>h(ko)},[ot.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>h(Ro)},[ot.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>h(Ro)},[ot.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>h(ko)},[ot.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>h(Ro)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:r}=T;return r(e.amount).lt(o[0])||r(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:r}=this.quote,i=this.fromToStore?.computedIfQuote,n=o!==null;return i?n?this.allTimerAndQuoteState[ot.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[ot.QUOTE_IS_HONEYPOT]:t?r?.msg&&(e||this.isValidRange(r.msg))?this.allTimerAndQuoteState[ot.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[ot.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[ot.QUOTING]:this.allTimerAndQuoteState[ot.DEFAULT]:this.allTimerAndQuoteState[ot.TIMER]:this.allTimerAndQuoteState[ot.DEFAULT]}};var{FACET_TOKEN_ERROR_ONE:Xc,FACET_TOKEN_ERROR_TWO:zc,FACET_TOKEN_ERROR_THREE:Jc}=bt,Ie=class{constructor(){s(this,"dialogCloseFlag",!1);s(this,"slippageInfoFetched",!1);s(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});s(this,"enableQuoteAggregates",!1);s(this,"dialogShowQuotationComparison",!1);s(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});s(this,"quoteNumber",0);s(this,"setQuoteNumber",t=>{this.quoteNumber=t});s(this,"aggregateSelectId",Tt);s(this,"isDialog",!1);s(this,"setIsDialog",t=>{this.isDialog=t});s(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});s(this,"isPickRouterFromWallet",!1);s(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});s(this,"quoteScope",null);s(this,"setQuoteScope",t=>{this.quoteScope=t});s(this,"fetchQuoteStatus",0);s(this,"quote",{...this.initQuote});s(this,"setQuote",t=>{this.quote=t});s(this,"pathSelectionRouterList",[]);s(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});s(this,"pickRouter",{});s(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});s(this,"showChainListModel",!1);s(this,"setShowChainListModel",t=>{this.showChainListModel=t});s(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});s(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});s(this,"currentBridgeId","");s(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});s(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});s(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(r=>r?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==xo.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});s(this,"quoteTimer",null);s(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1;let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;t?(this.setBridgeQuoteSelectStatus(0),this.setBridgeFetchStatus(e?1:0)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(e?1:0))});s(this,"cancelRef",null);s(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});s(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:r,computedIsSingleChain:i,computedIsExactIn:n}=this.fromToStore;return t===w.LIMIT_ORDER||!Ot(e)||!r?.tokenContractAddress||!o?.tokenContractAddress||!n&&!i});s(this,"getQuoteData",t=>{let e=Et();return y(xe(()=>E.get(this.getQuoteStoreUrl(),{params:e,signal:t,isolate:!0}),Pt.NUM,Pt.TIMER))});s(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;Ya(e)}});s(this,"fetchQuote",async({source:t}={})=>{if(!Ka())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},xr),Promise.resolve(!1);if(t===0){let{computedIsCrossChain:r}=this.fromToStore;r?(this.setBridgeQuoteSelectStatus(0),this.setBridgeFetchStatus(1),this.setBridgeSelectId(Tt)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1),this.setAggregateSelectId(Tt))}if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(null),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=Ct();let[e,o]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!qt(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),!qt(e)&&!this.dialogCloseFlag&&ut(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},xr)}),Promise.resolve(!0)});s(this,"quotePending",!1);s(this,"debounceQuote",Io(this.fetchQuote,si));s(this,"fetchQuoteDebounce",async({source:t}={})=>{let{computedIsCrossChain:e,computedIfQuote:o}=this.fromToStore;this.quotePending=!0,o&&e?await this.debounceQuote({source:t}):o&&!e?this.debounceQuote({source:t}):this.clearQuote()});s(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});s(this,"getGasTokenFeeLoading",!1);s(this,"getGasTokenFeeCancelRef",null);s(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});s(this,"cacheNativeGasFee","");s(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});s(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:r}=t||{},i=Ns(Et(),["dexIds"]);this.getGasTokenFeeCancelRef=Ct();let n=this.rootStore.fromToStore?.computedIsExactIn?li:pi;this.getGasTokenFeeLoading=!0;let c=this.getGasTokenFeeCancelRef.signal,l=e,[m,p]=await y(E.get(n,{params:{...i,amount:Gi(r,o)},signal:c}));if(this.getGasTokenFeeLoading=!1,!qt(m)&&m)return-1;if(!m){let{data:g}=p||{},{commonDexInfo:S}=g||{};Number(S?.code)===0&&S?.estimateReserveGasTokenFee!==""&&(l=S.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(l),l})}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,r=uo({isSingleChain:t,autoSlippageInfo:e}),i=ee.AUTO;return o&&(r=o.computedRealSlippageValue,i=o.getSlippageType()),!this.slippageInfoFetched&&i===ee.AUTO&&(i=ee.DEFAULT),{slippage:r,slippageType:i}}getQuoteStoreUrl(){return this.outerStore.receiveQuoteUrl()}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:r}=t,{computedIsSingleChain:i}=this.fromToStore,n=Number(e?.code)===bt.CROSS_CHAIN_INTERVAL,c=n?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(c),{isAutoError:n||(i?!r:!o?.length)}}updateSlippageInfoFetched(t){let{autoSlippage:e,autoTotalSlippage:o}=t?.autoSlippageInfo||{};(e||o)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!T.BigNumber(e).lt(T.BigNumber(o))}get computedCurrentTimerQuoteState(){return new So(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.fromToStore?.computedIsSingleChain?this.quote?.bestRoute:this.pickRouter}get computedMediaForChangeSmartRouterData(){return gn()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===K.EMPTY}get computedQuoteInterval(){let{safeMoonStore:t,fromToStore:e,approveStore:o,swapBtnStore:r,swapDappStore:i}=this.rootStore;if(t.computedHoneypot||e.computedFormToTokenIsLeverageToken)return{type:K.EMPTY};let n=Tn.handleQuoteErrorState({quote:this.quote,honeypotToken:I(this,"rootStore.safeMoonStore.computedHoneypot",!1)})||this.accountStore.computedNonsupportChain,{from:c,computedNonsupportFacetToken:l}=this.fromToStore;if(n||l)return{type:K.EMPTY};if(i.checkShouldJumpToDapp())return{type:K.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:K.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if(this.computedIsNoOkxLiquidity)return{type:K.NOT_OKX_LIQUIDITY};if((!this.quoteScope||!e.computedIfQuote)&&this.fetchQuoteStatus!==3&&!o.computedIsCancelApproveStatus&&!this.computedPriceWarn.show&&!this.quote?.bestRoute?.errorMsg)return{type:K.EMPTY};if(this.computedCrossAccuracyLimit)return{type:K.CROSS_CHAIN_ACCURACY,text:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:c.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:q(c.tokenSymbol),value:this.computedCrossAccuracyLimit})};if(this.computedFacetTokenTips)return{type:K.FACET_TOKEN_SWAP_ERROR,text:this.computedFacetTokenTips};let{crossMiniAmount:p,crossMaxAmount:g}=this.quoteScope||{};if(T.BigNumber(c.amount).lt(T.BigNumber(p))){let S=J(p,{cutPriceText:!0,isFloor:!1});return{type:K.CROSS_CHAIN_MIN,text:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:S,symbol:c.tokenSymbol}),equation:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:S,symbol:q(c.tokenSymbol)})}}if(T.BigNumber(c.amount).gt(T.BigNumber(g))){let S=J(g,{cutPriceText:!0});return{type:K.CROSS_CHAIN_MAX,text:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:S,symbol:c.tokenSymbol}),equation:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:S,symbol:q(c.tokenSymbol)})}}return this.quote?.bestRoute?.errorMsg?{type:K.CROSS_CHAIN_MORE_TIPS,text:this.quote?.bestRoute?.errorMsg}:this.computedIsNoLiquidity?{type:K.NOT_LIQUIDITY}:this.computedCrossChainIntervalOutOfRange?{type:K.NOT_LIQUIDITY}:o.computedIsCancelApproveStatus&&!r.computedTooBalance?{type:K.CANCEL_APPROVE_TIPS}:this.computedPriceWarn.show?{type:K.PROVIDER_PRICE_WARN}:{type:K.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===bt.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===bt.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedCrossChainIntervalOutOfRange(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return T.BigNumber(t.amount).lte(o)&&T.BigNumber(t.amount).gte(e)}get computedIsNoLiquidity(){return this.fetchQuoteStatus===3&&this.quote.quoteNull}get computedIsNoOkxLiquidity(){let t=this.quote?.bestRoute?.defiPlatformInfoList;return this.enableQuoteAggregates&&t&&this.aggregateFetchStatus===3?!t.some(o=>o?.defiPlatformId===$):!1}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===bt.CROSS_CHAIN_ACCURACY?t:""}get computedFacetTokenTips(){let{errorMsg:t,code:e}=this.quote.bestRoute||{};return[Xc,zc,Jc].includes(Number(e))&&t?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:r,computedIsCrossChain:i}=this.rootStore.fromToStore,{quoteError:n,quoteNull:c,bestRoute:l}=this.quote;if(!r||n||c||!l?.youSaveDTO||i)return{visible:!1};let{youSaveDTO:m,fromToken:p,toToken:g}=l,{topTenDexInfoList:S,youSaveMoney:A}=m,v=Number(A)>=.1&&S?.length>0&&!p.isHoneypot&&!g.isHoneypot,F=e(A).toString(),O=v?ht(F,t,{isFloor:!1}):"",mt=v?S?.[1]?.dexName:"";return o&&(!i&&this.computedTopTenDexInfoList.length>0?v=!0:v=!1),{visible:v,youSaveStr:O,dexName:mt}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:r,comparePercent:i,price:n,dexAmountOut:c,amountOutOfMoney:l,gasOfMoney:m,isOkxDex:p})=>{let g=e(l)?.toString(),S=e(m)?.toString();return{logoUrl:o,dexName:r,comparePercent:i,price:n,isOkxDex:p,formatPrice:J(n),dexAmountOut:T.BigNumber(c).toString(),formatDexAmountOut:J(c),amountOutOfMoney:g,formatAmountOutOfMoney:ht(g,t,{needBillionMillionUnit:!1}),gasOfMoney:ht(S,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:r,currencyConversion:i}=this.commonStore,{from:n}=this.fromToStore;return h("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${J(o)} ${n.tokenSymbol}`,fee:`${ht(i(e).toString(),r)}`})}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.rootStore.safeMoonStore?.computedHoneypot||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}setAggregateFetchStatus(t){return t}setAggregateSelectStatus(t){return t}setAggregateSelectId(t){return t}get computedIsOfflineType(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?Number(this?.quote?.bestRoute?.bridge?.bridgeType)===En.INTENT_BRIDGE:this?.quote?.bestRoute?.offlineType===An.YES}get computedIsFreeNetworkFee(){return this?.quote?.bestRoute?.bridge?.isFreeNetworkFee===_n.FREE_NETWORK_FEE}get computedIsOkxProvider(){return!this?.quote?.bestRoute?.defiPlatformId||this?.quote?.bestRoute?.defiPlatformId===$}get computedBridgeIsOkxProvider(){let{defiPlatformId:t}=this?.quote?.bestRoute?.bridge||{};return!t||t===$}get computedPriceWarn(){let t=T.BigNumber(this?.quote?.bestRoute?.reducePercent),e=T.BigNumber(this?.quote?.bestRoute?.warnPercent);return{show:t&&t.isGreaterThan(e)}}get computedreducePercent(){return Wi(this?.quote?.bestRoute?.reducePercent)}};u();d();L();var Zc=a=>{let{quoteStore:t,swapStore:e}=D();!a&&t.bridgeQuoteSelectStatus!==0&&(t.setBridgeNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setBridgeQuoteSelectStatus(0))},Ja=a=>Number(a.commonDexInfo?.code)===bt.CROSS_CHAIN_INTERVAL,tu=a=>!a.pathSelectionRouterList?.length,eu=a=>Ja(a)||tu(a),ou=a=>{let{quoteStore:t}=D(),e=Ja(a)?{crossMaxAmount:a.commonDexInfo?.crossMaxAmount,crossMiniAmount:a.commonDexInfo?.crossMiniAmount}:null;t.setQuoteScope(e)},ru=a=>{let{quoteStore:t}=D(),e=t.bridgeSelectId===Tt?a[0]:a?.find(o=>o.bridge.bridgeId===t.bridgeSelectId);return Zc(e),e||a[0]},su=({data:a})=>{let{commonDexInfo:t,singleChainSwapInfo:e,swapType:o,pathSelectionRouterList:r,intentCode:i,isSupportDappTrade:n,offlineType:c,traceData:l}=a||{},m=r?.map((A,v)=>({commonDexInfo:t,...A,isBest:v===0})),p={intentCode:i,offlineType:c,swapType:o,traceData:l},g={...e,...t,swapType:o,pathSelectionRouterList:m},S=m?.map(A=>({...t,...A,...p,isSupportDappTrade:n}));return{bestRoute:g,combineSelectionRouterList:S}},iu=a=>{let{quoteStore:t,smartRouterStore:e}=D();if(e.showXRouteModal!==xo.XROUTER)return;let o=a.find(r=>r?.bridge?.bridgeId===t.pickRouter?.bridge?.bridgeId);o&&t.setPickRouter(o)},nu=({bestRoute:a,bridgeInfo:t,isAutoError:e,originData:o,combineSelectionRouterList:r},{fromToStore:i,quoteStore:n})=>{let c=At({},a,t);n.updateSlippageInfoFetched(c),n.setBridgeSelectId(c?.bridge?.bridgeId),n.setQuote({...n.quote,bestRoute:c,quoteNull:e,quoteError:null,isFetchQuoting:!1}),ou(o),e&&n.setBridgeFetchStatus(3),i.quoteUpdateFromTo(c),i.computedIsCrossChain&&(n.setPathSelectionRouterList(r||[]),iu(r||[]))},Za=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=D(),{bestRoute:r,combineSelectionRouterList:i}=su({data:a}),n=ru(r.pathSelectionRouterList),c=eu(a);e.setQuoteNumber(e.quoteNumber+1),nu({bestRoute:r,bridgeInfo:n,isAutoError:c,originData:a,combineSelectionRouterList:i},{fromToStore:t,quoteStore:e}),ho({isAutoError:c},{approveStore:o}),fo({isAutoError:c},{quoteStore:e})};var Er=class extends Ie{constructor(e){super();this.isEnableBridgeQuoteSearch=!0;this.bridgeList=[];this.bridgeListPending=!0;this.bridgeQuoteSelectStatus=0;this.bridgeFetchStatus=0;this.bridgeNoRouteTipStatus=0;this.compareVisible=!1;this.dialogGroupVisibleStatus=1;this.bridgeSortType=0;this.setBridgeSelectId=e=>{this.bridgeSelectId=e};this.setBridgeQuoteSelectStatus=e=>{this.bridgeQuoteSelectStatus=e};this.setBridgeFetchStatus=e=>{this.bridgeFetchStatus=e};this.setBridgeNoRouteTipStatus=e=>{this.bridgeNoRouteTipStatus=e};this.setBridgeList=e=>{this.bridgeList=e};this.setBridgeListPending=e=>{this.bridgeListPending=e};this.setBridgeSortType=e=>{this.bridgeSortType=e};this.setCompareVisible=e=>{this.compareVisible=e};this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};this.getQuoteData=e=>{let o=Ea();return this.bridgeFetchStatus===0&&this.setBridgeFetchStatus(1),y(xe(()=>E.get(this.getQuoteStoreUrl(),{params:o,signal:e,isolate:!0}).then(r=>(this.setBridgeFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1,r)).catch(r=>{throw _.stuff(r),r}),Pt.NUM,Pt.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;Za(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setBridgeFetchStatus(4)};it(this),Object.assign(this,e),this.rootStore=e}getQuoteStoreUrl(){return fi}};u();d();L();var lu="1",mu="2",tc={minValue:.01,maxValue:.5},ec={minValue:.03,maxValue:.5},Ae=class{constructor(t){s(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:""});s(this,"configSingle",tc);s(this,"configCross",ec);s(this,"inputValue","");s(this,"inputCache","");s(this,"inputSlippageFocus",!1);s(this,"slippageNotice","");s(this,"hasSlippageError",!1);s(this,"hasSafeMoonWarning",!1);s(this,"isFrozen",!1);s(this,"frozenTooltip","");s(this,"clearNoticeAndError",()=>{this.slippageNotice="",this.hasSlippageError=!1});s(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e,t?this.frozenTooltip=h("swaptrade_dialog_modal_current_notsupport"):e?this.frozenTooltip=h("swaptrade_dialog_modal_crosschain_notsupport"):this.frozenTooltip=""});s(this,"refreshInfo",()=>{let{inputSlippage:t}=this.slippageSetting;if(this.inputValue=t||"",this.computedSafeMoonTips||t!==""&&t!==void 0){let{computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,computedAutoSlippage:i}=this,n=this.rootStore.fromToStore.computedIsSingleChain,{notice:c,isError:l,isWarning:m}=fr({inputSlippageParams:this.computedSlippageValue,computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,autoSlippageValue:i,isSingleChain:n});this.slippageNotice=c,this.hasSlippageError=l,this.hasSafeMoonWarning=m}});s(this,"onFocus",()=>{this.inputSlippageFocus=!0,this.hasSafeMoonWarning=!1,this.inputCache&&(this.onInput(null,this.inputCache),this.inputCache="")});s(this,"onInput",(t,e="")=>{let o=t||e;this.templeAutoSelected=!1;let{computedSafeMoonTips:r,minSlippageShow:i,maxSlippageShow:n,computedAutoSlippage:c}=this,l=this.rootStore.fromToStore.computedIsSingleChain,{notice:m,isError:p,isWarning:g}=fr({inputSlippageParams:o,computedSafeMoonTips:r,minSlippageShow:i,maxSlippageShow:n,autoSlippageValue:c,isSingleChain:l});if(!jt(X(o))){let A=/^0{2,}/gm;o=o.replace(A,"0"),this.inputValue=o}let S=o||this.computedSafeMoonTips;this.slippageNotice=S?m:"",this.hasSlippageError=p,this.hasSafeMoonWarning=g});s(this,"onBlur",()=>{this.inputSlippageFocus=!1});s(this,"onSelectCustom",()=>{let t=this.inputValue,{computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,computedAutoSlippage:i}=this,n=this.rootStore.fromToStore.computedIsSingleChain,{slippage:c,inputValue:l,notice:m,isError:p}=fr({inputSlippageParams:t,computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,autoSlippageValue:i,isSingleChain:n}),g=this.getSafeMoonStore();if(g.checkIsChanged&&g.checkIsChanged(t),e?this.inputValue=Nt(c):this.inputValue&&(this.inputValue=Nt(c),this.slippageNotice=m,this.hasSlippageError=p,this.hasSafeMoonWarning=!!e),(Number(t)===0||jt(t))&&(this.slippageNotice=""),p){this.onSelectAuto(),this.inputSlippageFocus=!1;return}jr({custom_or_auto:l?"custom":"auto"}),this.setSlippageSetting({autoIsSelected:!l,inputSlippage:l}),this.rootStore.quoteStore.fetchQuoteDebounce()});s(this,"onReset",()=>{let{inputSlippage:t}=this.slippageSetting;this.inputValue=t,this.clearNoticeAndError(),this.inputSlippageFocus=!1});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,B(this,{},{autoBind:!0})}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=hs(this.rootStore);return t||this.isFrozen?{autoSlippageInfo:e}:{customSlippage:String(this.computedRealSlippageValue),autoSlippageInfo:e}}get minSlippage(){let t=this.rootStore.fromToStore.computedIsSingleChain,{computedSafeMoonToken:e}=this.getSafeMoonStore();if(e){let o=T.BigNumber.max(this.configCross.minValue,this.configSingle.minValue);return o.isNaN()?.011:o.toString()}return t?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.rootStore.fromToStore.computedIsSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return T.mul(this.minSlippage,100)}get maxSlippageShow(){return T.mul(this.maxSlippage,100)}get computedAutoSlippage(){let{computedHoneypot:t}=this.getSafeMoonStore();if(t){let e=I(this,"rootStore.quoteStore.quote.bestRoute.realSlippage",0);return T.mul(e,100)}return hr(this.rootStore)}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(T.div(t,100))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:r,fromPriceFluctuation:i,toPriceFluctuation:n,rateFluctuationThreshold:c,slippageFluctuationhold:l,rateFluctuation:m}=e,{from:p,to:g}=this.fromToStore,S=g?.tokenSymbol||"",A=p?.tokenSymbol||"",v=T.mul(l,100),F=T.mul(r,100),O=T.mul(c,100),mt=Number(m),ct=Number(c);if(t>v){if(mt<ct)return null;let It=this.slippageSetting.autoIsSelected;return{tip:h("swaptrade_settings_alert_both_exchange_tips",{payToken:A,receiveToken:S,value:O,min:o}),tipEquation:h("swaptrade_settings_alert_both_exchange_tips",{payToken:q(A),receiveToken:q(S),value:O,min:o}),swapInterceptorType:It?U.VOLATILITY_SLIPPAGE:null}}else if(t===v){let It=Math.abs(i),Ht=Math.abs(n),Lt=Number(r);if(It>Lt&&Ht>Lt)return{tip:h("swaptrade_placeorder_alert_both_volatility",{payToken:A,receiveToken:S,value:F,min:o}),tipEquation:h("swaptrade_placeorder_alert_both_volatility",{payToken:q(A),receiveToken:q(S),value:F,min:o})};if(It>Lt)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:A,value:F,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:q(A),value:F,min:o})};if(Ht>Lt)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:S,value:F,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:q(S),value:F,min:o})};if(mt>=ct)return{tip:h("swaptrade_settings_alert_both_exchange",{payToken:A,receiveToken:S,value:O,min:o}),tipEquation:h("swaptrade_settings_alert_both_exchange",{payToken:q(A),receiveToken:q(S),value:O,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,r=Nt(o);e.isChanged&&r&&(t.inputSlippage=r,t.autoIsSelected=!1)}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?ee.AUTO:ee.CUSTOM}getSlippageValue(t=this.slippageSetting){let{autoIsSelected:e,inputSlippage:o}=t;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:r}=o;if(!r){this.slippageSetting=e;return}let i=this.getSlippageValue(e);if(i===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(i)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0;let n=Nt(i);o.isChanged&&n&&(e.inputSlippage=n,e.autoIsSelected=!1),o.setSafeMoonPairSlippage(i),this.slippageSetting=e}}async initSlippageConfigs(){try{let{data:t}=await E.get(Ri),e=t?.find(({configId:r})=>lu===r),o=t?.find(({configId:r})=>mu===r);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=tc,this.configCross=ec}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:""},this.setSlippageSetting(e)}initReactions(){St(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.clearNoticeAndError(),this.initSlippageSetting()):!1,{equals:Dt.shallow}),St(()=>{let t=this.fromToStore.from.chainId,{computedSafeMoonSlippage:e}=this;return{fromId:t,computedSafeMoonSlippage:e}},this.clearNoticeAndError,{equals:Dt.shallow}),St(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:Dt.shallow}),St(()=>{let{quote:t}=this.rootStore.quoteStore,e=He.get(t,"bestRoute.smartRoutingMenuVoList"),o=He.get(e,[0,"smartRoutingMenuType"]),r=e&&e.length===1&&o===In.BRIDGE,{computedSafeMoonNotSupport:i}=this;return{computedSafeMoonNotSupport:i,isCrossBridgeOnly:r}},this.setFrozenInfo,{equals:Dt.shallow}),St(()=>{let{slippageSetting:t,isFrozen:e,computedSafeMoonTip:o}=this;return{slippageSetting:t,isFrozen:e,computedSafeMoonTip:o}},this.refreshInfo,{equals:Dt.shallow})}onSelectAuto(t=!1){jr({custom_or_auto:"auto"}),!this.hasSlippageError&&!this.hasSafeMoonWarning&&this.inputValue?this.inputCache=this.inputValue:this.inputCache="";let e={autoIsSelected:!0,inputSlippage:""};if(this.inputValue="",this.slippageNotice="",this.hasSlippageError=!1,this.hasSafeMoonWarning=!1,!t){let o=this.getSafeMoonStore();o.computedSafeMoonToken&&o.setSafeMoonIsChanged(!1),this.setSlippageSetting(e),this.rootStore.quoteStore.fetchQuoteDebounce()}}get computedMinimumReceived(){let{quote:t,computedIsOfflineType:e}=this.rootStore.quoteStore,{receiveAmount:o,minimumReceived:r}=t?.bestRoute||{},i=this.fromToStore.to?.tokenSymbol;if(this.hasSlippageError||!Ot(o))return"--";let n=this.inputValue?T.div(this.inputValue,100):this.computedRealSlippageValue,c=e?r:T.mul(o,1-(Ot(n)?n:0));return`${J(c,{needBillionMillionUnit:!1})} ${i}`}get computedMinimumReceivedIsOrange(){let{quote:t}=this.rootStore.quoteStore,e=this.computedMinimumReceived,o=t?.bestRoute?.receiveAmount,r=T.BigNumber(o);return!r.isZero()&&!r.isNaN()&&T.div(T.sub(r,e),r)>=.1}};u();d();L();j();var Es=class{constructor(t){s(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,r=this.checkCommonParams(),{receiveAddrObj:i}=e,n=I(o.bestRoute,"quoteNetWorkFeeOfMoney"),c=o?.bestRoute?.bridge?.bridgeId,l=i?.specifiedAddress;return{...r,fromSwapFeeUsd:n,bridgeId:c,receiveWalletAddress:l}});s(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:r,to:i}=e;return{fromChainId:r.chainId,fromTokenAddress:r.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:i.chainId,toTokenAddress:i.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});s(this,"repeatOrder",null);s(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,r=I(o.bestRoute,"fromSwapFeeUsd"),i={...e,chainId:t,fromSwapFeeUsd:r},[n,c]=await y(E.get(Ci,{params:i}));!n&&[Jt.COMMON_REPEAT,Jt.BTC_REPEAT,Jt.FACET_REPEAT].includes(c?.data.repeatFlag)&&ut(()=>{let{orderId:l,enoughFlag:m}=c?.data??{};this.repeatOrder={enoughFlag:m,repeatFlag:c?.data.repeatFlag,id:l}})});s(this,"checkSwapMoreInfo",null);s(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await y(E.post(Ii,{...t}));e||ut(()=>{this.checkSwapMoreInfo=o?.data})});B(this),this.rootStore=t}},yr=Es;u();d();j();var _e=class{constructor(t){s(this,"swapOnDappBtnLoading",!1);s(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});s(this,"refreshing",!1);s(this,"setRefreshing",t=>{this.refreshing=t});s(this,"dappListContainerVisible",!1);s(this,"setDappListContainerVisible",t=>{this.dappListContainerVisible=t});s(this,"fetchDappListError",!1);s(this,"setFetchDappListError",t=>{this.fetchDappListError=t});s(this,"availableNoticeVisible",!1);s(this,"setAvailableNoticeVisible",t=>{this.availableNoticeVisible=t});s(this,"dappList",[]);s(this,"setDappList",t=>{this.dappList=t});s(this,"getFetchParam",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore||{},r={},i="";return o?(i=xi,r={chainId:t?.chainId,tokenAddress:e?.tokenContractAddress}):(i=Mi,r={fromChainId:t?.chainId,fromTokenAddress:t?.tokenContractAddress,toChainId:e?.chainId,toTokenAddress:e?.tokenContractAddress}),{url:i,params:r}});s(this,"fetchDappList",async t=>{t?(this.setFetchDappListError(!1),this.setRefreshing(!0)):this.setSwapOnDappBtnLoading(!0);let{url:e,params:o}=this.getFetchParam(),[r,i]=await y(E.get(e,{params:o}));if(this.setRefreshing(!1),this.setSwapOnDappBtnLoading(!1),r){if(Number(r.code)===40008){this.setAvailableNoticeVisible(!0);return}this.setFetchDappListError(!0),this.setDappListContainerVisible(!0);return}this.setDappList(i.data),this.setDappListContainerVisible(!0)});s(this,"getSupportDetail",(t={},e=!1)=>{let o=this.chainIsSupportMarket(t),r=this.chainIsSupportDappTrade(t),i=!!this.quoteStore?.computedSupportDappTradeByQuote,n=!o&&r,c=o&&r,l=o&&!r;return{chainSupportMarket:o,chainSupportDappTrade:r,quoteSupportDappTrade:i,balance:c||l,kline:c||l,klineJumpMarket:c||l,costValue:e&&c||l,valueDifference:l,liquidity:l,disableInput:n||c,showMax:l,showAddFund:l}});s(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:et.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));s(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),r=this.commonStore.getChainByID(e);return[o,r]});s(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);s(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);s(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);s(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=this.liquidityChooseStore?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});s(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,this.liquidityChooseStore=t.liquidityChooseStore,B(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let r=o?.bridgeSupportChainInfoList,i=Array.isArray(r)&&r.find(n=>Number(n.chainId)===Number(e));return this.bridgeSupportDappTrade(i)}};var qe=class extends ne{constructor(){super();s(this,"reset",()=>{this.receiveAddressStore=new mr(this),this.outerStore=new _r(this),this.fromToStore=new he(this),this.approveStore=new ae(this),this.quoteStore=new Er(this),this.tokenModalStore=new gr(this),this.safeMoonStore=new Ce(this),this.walletContractStore=new dr(this),this.sendTransactionStore=new tr(this),this.intentSwapStore=new lr(this),this.swapCheckStore=new yr(this),this.swapStore=new Se(this),this.swapBtnStore=new fe(this),this.mevStore=new Ar(this),this.recentTransactionStore=new zo(this),this.facetStore=new Tr(this),this.liquidityChooseStore=new Te(this),this.swapDappStore=new _e(this),this.smartRouterStore=new Ko(this),this.slippageStore=new Ae(this),this.oneMoreOrderStore=new Cr(this),this.gasDropStore=new Ir});this.reset()}},go=qe;s(go,"instance",null),s(go,"getInstance",()=>(qe.instance||(qe.instance=new qe),qe.instance));var oc=go;u();d();u();d();var kr=class extends ge{constructor(t){super(t),it(this)}getSearchParams(t){return this.singleSearchParams(t)}};u();d();L();j();u();d();L();var pu=a=>{let{quoteStore:t,swapStore:e}=D();!a&&t.aggregateSelectStatus!==0&&(t.setAggregateNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setAggregateSelectStatus(0))},hu=a=>{let{quoteStore:t}=D(),e=t.aggregateSelectId===Tt?a[0]:a.find(r=>r.defiPlatformId===t.aggregateSelectId),o=I(a.find(r=>r.defiPlatformId===$),"dexRouterList",[]);return pu(e),At({},e||a[0],{dexRouterList:o})},fu=({data:a,isCompareResult:t})=>{let{commonDexInfo:e,singleChainSwapInfo:o,swapType:r,isSupportDappTrade:i,defiPlatformInfoList:n,traceData:c}=a,l=n.map((p,g)=>({...p,isBest:g===0}));return{bestRoute:{...o,...e,isSupportDappTrade:t?i:"0",swapType:r,defiPlatformInfoList:l,traceData:c}}},Su=({bestRoute:a,aggregateInfo:t,isAutoError:e},{fromToStore:o,quoteStore:r})=>{let i=At({},a,t);r.updateSlippageInfoFetched(i),r.setAggregateSelectId(i.defiPlatformId),r.setQuote({...r.quote,bestRoute:i,quoteNull:e,quoteError:null,isFetchQuoting:!1}),e&&r.setAggregateFetchStatus(4),o.quoteUpdateFromTo(i)},gu=a=>{let{solanaPriorityFeeStore:t}=D();t&&a?.jitoData&&t.setJitoData(a?.jitoData)},rc=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=D(),r=e.aggregateFetchStatus===3,{bestRoute:i}=fu({data:a,isCompareResult:r}),n=hu(i.defiPlatformInfoList),c=r&&i.defiPlatformInfoList.length===0;e.setQuoteNumber(e.quoteNumber+1),Su({bestRoute:i,aggregateInfo:n,isAutoError:c},{fromToStore:t,quoteStore:e}),gu(a),ho({isAutoError:c},{approveStore:o}),fo({isAutoError:c},{quoteStore:e})};var Rr=class extends Ie{constructor(e){super();this.enableQuoteAggregates=!0;this.setAggregateSelectId=e=>{this.aggregateSelectId=e};this.aggregateSelectStatus=0;this.setAggregateSelectStatus=e=>{this.aggregateSelectStatus=e};this.aggregateFetchStatus=0;this.setAggregateFetchStatus=e=>{this.aggregateFetchStatus=e};this.fetchOKXQuote=({params:e,signal:o})=>{this.aggregateFetchStatus!==3&&E.get(this.outerStore.aggregatorQuoteUrl(),{params:At({},e,{defiPlatformIds:$}),signal:o}).then(r=>{this.aggregateFetchStatus===1&&(this.setAggregateFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1)}).catch(r=>{_.stuff(r)})};this.getQuoteData=e=>{let o=Et();return this.fetchOKXQuote({params:o,signal:e}),y(xe(()=>this.fetchAggregatesQuote({params:o,signal:e}),Pt.NUM,Pt.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;rc(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.aggregateNoRouteTipStatus=0;this.setAggregateNoRouteTipStatus=e=>{this.aggregateNoRouteTipStatus=e};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setAggregateFetchStatus(5)};this.aggregatorList=[];this.setAggregatorList=e=>{this.aggregatorList=e};this.aggregatorListPending=!0;this.setAggregatorListPending=e=>{this.aggregatorListPending=e};this.fetchAggregatorList=()=>(this.setAggregatorListPending(!0),E.get(gi).then(e=>{this.setAggregatorList(e.data)}).catch(()=>{this.setAggregatorList([])}).finally(()=>{this.setAggregatorListPending(!1)}));this.compareVisible=!1;this.setCompareVisible=e=>{this.compareVisible=e};this.dialogGroupVisibleStatus=1;this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};it(this),Object.assign(this,e),this.rootStore=e}fetchAggregatesQuote({params:e,signal:o}){return E.get(this.outerStore.aggregatorQuoteUrl(),{params:e,signal:o,isolate:!0}).then(r=>(this.aggregateFetchStatus===2&&this.setAggregateSelectId(Tt),this.setAggregateFetchStatus(3),r))}};u();d();u();d();var sc=a=>{if(!a)return[];let{solPrice:t,solTokenSymbol:e,solDecimals:o}=a;return Cn.map(r=>({type:r,fee:a[r],usd:a[`${r}Usd`],solPrice:t,solTokenSymbol:e,solDecimals:o}))};var ys=class{constructor(t){s(this,"visible",!1);s(this,"setVisible",t=>{this.visible=t});s(this,"feeType",zr.MARKET);s(this,"setFeeType",t=>{this.feeType=t});s(this,"customFee",null);s(this,"setCustomFee",t=>{this.customFee=t});s(this,"jitoData",null);s(this,"setJitoData",t=>{this.jitoData=t});this.rootStore=t,it(this)}get computedPriorityFeeList(){return sc(this.jitoData)}get computedPriorityFeeAmount(){return this.jitoData?this.feeType===zr.CUSTOM?this.customFee:this.computedPriorityFeeList.find(e=>e.type===this.feeType)?.fee:null}get computedPriorityFeeOfUsd(){if(!this.jitoData)return null;let{solPrice:t}=this.jitoData;return T.mul(this.computedPriorityFeeAmount,t,{returnString:!0})}},ic=ys;var Ue=class extends ne{constructor(){super();s(this,"reset",()=>{this.receiveAddressStore=new mr(this),this.outerStore=new _r(this),this.fromToStore=new he(this),this.approveStore=new ae(this),this.quoteStore=new Rr(this),this.tokenModalStore=new kr(this),this.safeMoonStore=new Ce(this),this.walletContractStore=new dr(this),this.sendTransactionStore=new tr(this),this.intentSwapStore=new lr(this),this.swapCheckStore=new yr(this),this.swapStore=new Se(this),this.swapBtnStore=new fe(this),this.solanaPriorityFeeStore=new ic(this),this.mevStore=new Ar(this),this.recentTransactionStore=new zo(this),this.facetStore=new Tr(this),this.liquidityChooseStore=new Te(this),this.swapDappStore=new _e(this),this.smartRouterStore=new Ko(this),this.slippageStore=new Ae(this),this.oneMoreOrderStore=new Cr(this)});this.reset()}},To=Ue;s(To,"instance",null),s(To,"getInstance",()=>(Ue.instance||(Ue.instance=new Ue),Ue.instance));var nc=To;var Tu=({localeData:a,...t})=>{Ca();let e=(0,ac.useLocation)(),o;return e.pathname.includes(lt)?o=w.BRIDGE:e.pathname.includes(Vi)?o=w.LIMIT_ORDER:e.pathname===Z&&(o=w.SWAP),br.default.createElement(Ui,{localeData:a,isDev:!0,noRemoteData:!0,customRender:r=>r},br.default.createElement(qn,{swapRootStore:nc,bridgeRootStore:oc,initTab:o},br.default.createElement(ga,{currentTab:o,...t})))},vk=Rt(Tu);export{vk as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Advanced-NPKGS5WN.js.map
