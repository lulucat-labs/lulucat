import{a as pe,b as ge}from"./chunk-O4AUMYZ5.js";import{a as ue,b as de}from"./chunk-WGGUVNMX.js";import{a as me,b as le}from"./chunk-7H73XLDQ.js";import{a as ce}from"./chunk-CUQ3APPN.js";import"./chunk-BAUTUSPJ.js";import"./chunk-JA6DNDTG.js";import"./chunk-ZAFBI5BD.js";import"./chunk-YSW2YY4I.js";import"./chunk-YDKVBWIO.js";import{a as fe}from"./chunk-2QOKJOXY.js";import"./chunk-JSJTP4EG.js";import"./chunk-454I7KWD.js";import{a as ie}from"./chunk-R6UCQXIY.js";import{a as ae}from"./chunk-DIVFRUSZ.js";import"./chunk-JFV2UG4S.js";import"./chunk-VPEGTYK6.js";import"./chunk-MZ62OMSF.js";import"./chunk-VP3JRWXQ.js";import"./chunk-NFPXRZGF.js";import"./chunk-7P3TAB2X.js";import"./chunk-F2DBKTIG.js";import"./chunk-2AZAHALD.js";import"./chunk-UKL67WXA.js";import"./chunk-FGVAAF7J.js";import{a as se}from"./chunk-B2JJAXTZ.js";import{m as ne,p as W}from"./chunk-APUK5GYS.js";import"./chunk-55XCE2ZH.js";import"./chunk-TZ4DRGVV.js";import"./chunk-WVLQP46O.js";import"./chunk-EADI45MC.js";import"./chunk-KLQLZF6P.js";import"./chunk-XZD4GKLJ.js";import"./chunk-QHPYMFK2.js";import{d as O}from"./chunk-F4XZWNG2.js";import"./chunk-G6PPKZHQ.js";import"./chunk-2P7I7CKT.js";import{a as D}from"./chunk-FOZHYRP7.js";import"./chunk-S3KOFL77.js";import"./chunk-HVQTUZKT.js";import"./chunk-Z6KV2BLE.js";import"./chunk-DXXZWR4J.js";import"./chunk-5HXUZG4A.js";import"./chunk-SBQTMPJM.js";import"./chunk-7YQLUBDN.js";import"./chunk-O43TNQSD.js";import"./chunk-LUYLQDIU.js";import"./chunk-QZXD2Q4G.js";import"./chunk-MIHA7WB3.js";import"./chunk-UEHNGOG4.js";import"./chunk-2NGLDVXQ.js";import"./chunk-RQNRRXKS.js";import{f as oe}from"./chunk-2LNDMD6C.js";import"./chunk-OAAPCU3J.js";import"./chunk-MFSPDO3X.js";import"./chunk-FUXD4L32.js";import"./chunk-WRZIZFIL.js";import"./chunk-6Y4AAIZN.js";import"./chunk-SIAVCB4G.js";import"./chunk-MNWYB2XY.js";import"./chunk-KX7CSB3G.js";import"./chunk-AOBCHKFQ.js";import"./chunk-DPRLOZH7.js";import"./chunk-DEQWBIFF.js";import"./chunk-ELJOB4BQ.js";import"./chunk-ELHNWADN.js";import"./chunk-4X3SKD2N.js";import"./chunk-GCAD5G3O.js";import"./chunk-PS6ETN2V.js";import"./chunk-AZYPLE5D.js";import"./chunk-SULFXTUN.js";import"./chunk-OGS4HURJ.js";import"./chunk-T6GLUO36.js";import"./chunk-KOPPPKVA.js";import"./chunk-GRXKA7HE.js";import"./chunk-SNFTVDFG.js";import"./chunk-ZV6IBWDM.js";import"./chunk-F5ELBQNP.js";import"./chunk-HZPID3WW.js";import"./chunk-HZNY4MK4.js";import"./chunk-6CI55CTV.js";import"./chunk-ZZLPMRQY.js";import"./chunk-4HGOSSS7.js";import"./chunk-OIXVONQI.js";import"./chunk-REMRMZNH.js";import"./chunk-74FNJDB7.js";import"./chunk-E75DNWM4.js";import"./chunk-GOMM7VSE.js";import"./chunk-LTMEFQRN.js";import"./chunk-MSUJSPID.js";import"./chunk-TU5XNYNZ.js";import"./chunk-MZFOYMI4.js";import"./chunk-EQ275TZX.js";import"./chunk-WSXZYUQ4.js";import"./chunk-JRZXGORL.js";import"./chunk-IRNZUYU4.js";import"./chunk-SFTZ55EP.js";import"./chunk-DZHQUYHS.js";import{o as ve}from"./chunk-AUURQ3HI.js";import{La as te,Ma as re,cc as De}from"./chunk-B32MCU7F.js";import"./chunk-QCINCBGO.js";import"./chunk-VOLYN562.js";import"./chunk-VLKJDIZ5.js";import{Ja as ee,Na as Re}from"./chunk-N4B7HQY5.js";import{d as $,f as he}from"./chunk-TKFT6XV3.js";import"./chunk-MBLN6WQR.js";import"./chunk-XRF6BZHR.js";import"./chunk-OWU5GWTN.js";import{da as G}from"./chunk-2BGRD7AD.js";import"./chunk-TCJNKUJ2.js";import"./chunk-2UKLMOTV.js";import"./chunk-ZWQEMYA4.js";import"./chunk-ELX2GHLL.js";import"./chunk-AIPMH74P.js";import"./chunk-DJDG7W5Q.js";import{Pa as h,Qb as Q,_a as z,hc as Me}from"./chunk-Q23SA7M6.js";import"./chunk-XXICVAVV.js";import{H as j}from"./chunk-E44TZGUB.js";import{K,oa as ke}from"./chunk-KBQXBPIW.js";import{O as Y,w as u}from"./chunk-364XNTHB.js";import"./chunk-NBWNTERD.js";import"./chunk-GBTEQNFM.js";import"./chunk-QBHNZ2BL.js";import"./chunk-J6E3F25X.js";import"./chunk-W7JONHX2.js";import"./chunk-O3LHCDGR.js";import{a as v}from"./chunk-PDSGFBX4.js";import"./chunk-GAMT4PKF.js";import"./chunk-R4QAJG6J.js";import"./chunk-LI7MZD2P.js";import"./chunk-WTNDHHRR.js";import"./chunk-CGP26AOO.js";import"./chunk-2RHSM47Y.js";import"./chunk-ZSUO3ILU.js";import"./chunk-ATMUHCXK.js";import"./chunk-3MCJH4Z7.js";import"./chunk-AGN4QMRN.js";import"./chunk-FV56V3FL.js";import"./chunk-7MZSFBF4.js";import"./chunk-3SRT54EN.js";import"./chunk-J5P7OMUC.js";import"./chunk-KHHBU7RQ.js";import"./chunk-3CPUV3E7.js";import"./chunk-SHMKQUVK.js";import{f as M,o as f,q as l}from"./chunk-FJHLV356.js";f();l();var Fe=M(v());f();l();var y=M(v()),Se=M(De());Y();he();Re();z();f();l();var I=M(v());ke();Y();Me();var Ge=({code:e,data:n,error_message:s,error:a})=>{if(e!==0||!n||n.queryGasLimitErrorUseDefault||a)return{fee:0,feeError:!0,feeErrorMsg:s};let{gasLimit:r="0"}=n;return{...n,fee:r,feeError:!1,feeErrorMsg:""}},Ne=e=>e?.feeError&&e?.feeErrorMsg?u("wallet_extension_alert_estimate_unavailable_error",{errorMsg:e.feeErrorMsg}):"",Le=(e,n)=>{let s=K(e)||Q(e,n),a=K(e)||Q(e,0);return{isSufficientGas:s,isSufficientBalance:a}},Be=({coinId:e,unapproved:n,paramsInfo:s})=>{let{coin:a,toAdr:r,fromAddr:t,walletId:i,messages:o,network:c,validUntil:d}=s,{chainId:E,localType:p}=a||{},g=ie(e,n.walletId)||{},{coinAmountInt:T}=g,P=W(),S=(0,I.useRef)(null),[C,_]=(0,I.useState)(!0),[m,k]=(0,I.useState)({}),[x,J]=(0,I.useState)({});(0,I.useEffect)(()=>{p&&e&&t&&i&&o&&(async()=>{try{_(!0);let w=await P({coinId:e,address:t,toAddr:r,fromAddr:t}),A=await pe({nonce:w?.nonce,localType:p,fromAddr:t,walletId:i,messages:o,network:c,validUntil:d});J({signInfo:w,sequence:w?.nonce,inputData:JSON.stringify(A?.stringInputParams),transactionParams:A?.transactionParams})}catch(w){_(!1),k({feeError:!0,feeErrorMsg:w?.message||u("wallet_extension_alert_estimate_unavailable_error")})}})()},[p,e,t,i,o]),(0,I.useEffect)(()=>((()=>{let{inputData:w}=x;if(_(!0),w){let A=async()=>{let V=await ge({fromAddr:t,chainId:E,coinId:e,inputData:w}),q=Ge(V);_(!1),k(q)};(()=>{clearInterval(S.current),A(),S.current=setInterval(A,7e3)})()}})(),()=>{clearInterval(S.current)}),[x.inputData,E,t,e]);let{isSufficientGas:L,isSufficientBalance:U}=Le(T,m?.fee),R=Ne(m);return{networkFeeProps:{coinId:e,loading:C,estimateFailed:m?.feeError,estimateFailedMsg:R,networkFee:m?.fee},isSufficientGas:L,isSufficientBalance:U,estimateFailed:m?.feeError,estimateFailedMsg:R,extParams:{coinId:e,coinAmount:0,inputData:x?.inputData,fromAdr:t,toAdr:r,serviceCharge:m?.fee,extJson:JSON.stringify({nonce:x?.sequence}),txSource:2,accountId:n?.walletId,walletType:2,transactionParams:x?.transactionParams},coinWithBalance:g}},_e=Be;f();l();z();function be(e){let n=O(h)||{},{address:s,walletId:a}=D(e),r=e?.params?.transaction||{},t=r?.messages||[],i=r?.network,o=r?.valid_until,{address:c}=t[0]||{};return{toAdr:c,coin:n,fromAddr:s,walletId:a,messages:t,validUntil:o,network:i}}var we=be;f();l();var F=M(v());var Oe=({origin:e,walletId:n,localType:s})=>{let a=ne(),[r,t]=(0,F.useState)(!0),{host:i}=fe({origin:e}),o=D({walletId:n,localType:s}),[c,d]=(0,F.useState)({}),E=(0,F.useCallback)(async(T,P,S)=>{let C="";try{C=JSON.stringify(S)}catch{}let{coinId:_,chainId:m}=T,k=await a({coinId:_,checkTypes:[G.KYS,G.VERIFY_GAS_LIMIT],amount:0,from:o.address,to:"",txType:3,domain:i,tokenAddress:"",inputData:P,chainId:m,additionalData:{tonSignData:C}});d(k),t(!1)},[i,a,o.address]),p=(0,F.useMemo)(()=>({loading:r,...c[G.KYS]||{}}),[r,c]),g=(0,F.useMemo)(()=>c[G.VERIFY_GAS_LIMIT]||{},[c]);return{kysRet:p,loading:r,preExecute:E,preExecuteRet:c,verifyGasLimitRet:g}},Ee=Oe;f();l();var xe=M(v()),Ie=M(ve());Y();z();function We({transaction:e,fromAddress:n}){let{valid_until:s,network:a,from:r,messages:t}=e,[i,o]=(0,xe.useState)("");return(0,Ie.useAsyncEffect)(async()=>{if(a!==te.MAINNET)o(u("wallet_extension_error_incorrect_destination_network"));else if(s<Math.floor(Date.now()/1e3))o(u("wallet_extension_error_expired_transaction"));else if(!t||t.length===0)o(u("wallet_extension_error_invalid_transaction_parameter"));else{let{TonWallet:c}=await oe(),d=new c;for(let g=0;g<t.length;g++){let T=t[g]?.address;if(!await se(T,h)){o(u("wallet_extension_error_incorrect_destination_network"));return}}let E=await d.convertAddress({address:n}),p=await d.convertAddress({address:r});E?.raw!==p?.raw&&o(u("wallet_extension_error_incorrect_receiving_address"))}},[s,a,r,n]),{checkParamsTipMessage:i?{message:i}:null,code:i?re.BAD_REQUEST_ERROR:null}}var Te=We;var Je=(0,y.memo)(({unapproved:e})=>{let n=(0,Se.useDispatch)(),s=O(h)||{},a=s?.coinId||h,{walletId:r,address:t}=D(e),i=ae(r),o=we(e),c=W(),{networkFeeProps:d,isSufficientGas:E,estimateFailed:p,estimateFailedMsg:g,isSufficientBalance:T,extParams:P,coinWithBalance:S}=_e({coinId:a,unapproved:e,paramsInfo:o}),{id:C,origin:_,localType:m}=e,k=Ee({origin:_,walletId:r,localType:m}),{inputData:x,transactionParams:J}=P,L=(0,y.useRef)(),{preExecute:U,kysRet:R,verifyGasLimitRet:H}=k,B=e?.params?.transaction||{};(0,y.useEffect)(()=>{s?.coinId&&!d?.loading&&!L.current&&(L.current=!0,U(s,x,B))},[s?.coinId,d?.loading,x]);let w=me({kysRet:R,baseCoin:s,estimateFailed:p,estimateFailedMsg:g,isSufficientGas:E,isSufficientBalance:T,verifyGasLimitRet:H,coinWithBalance:S}),{checkParamsTipMessage:A,code:X}=Te({transaction:B,fromAddress:t}),V=ue({id:C,walletId:r,origin:_,localType:m,extraParams:{code:X}}),q=A||w,ye=async()=>{i({trade:"contract_interaction",all_confirmation:"confirm",network:m,dapp_url:_});try{let b=await c({coinId:a,address:o?.fromAddr,toAddr:o?.toAdr,fromAddr:o?.fromAddr}),Z=await $().approveDappRequest(C,{...P,transactionParams:{...J,seqno:b?.nonce},extJson:JSON.stringify({nonce:b?.nonce})});if(Z.code===10009){j.error(Z?.msg||u("wallet_extension_failure_subtitle_fail_resend"));return}await ee(n)}catch(b){j.error(b?.msg||u("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:Pe,handleCancel:Ce}=de({coinId:a,unapproved:e,preExecuteRet:k,feeLoading:d?.loading,estimateFailed:p,isSufficientGas:E,isSufficientBalance:T,disabledConfirmBtn:!!A,onConfirm:ye,onCancel:V,coinWithBalance:S});return ce({kysRet:R,handleCancel:Ce}),y.default.createElement(le,{kysRet:R,unapproved:e,tipMessage:q,buttonGroup:Pe,networkFee:d})}),Ae=Je;var Jt=({unapproved:e})=>Fe.default.createElement(Ae,{unapproved:e});export{Jt as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Ton-44ZTLLZ2.js.map
