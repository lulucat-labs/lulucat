var xn=M=>{throw TypeError(M)};var bn=(M,D,Z)=>D.has(M)||xn("Cannot "+Z);var nt=(M,D,Z)=>(bn(M,D,"read from private field"),Z?Z.call(M):D.get(M)),Pt=(M,D,Z)=>D.has(M)?xn("Cannot add the same private member more than once"):D instanceof WeakSet?D.add(M):D.set(M,Z),tt=(M,D,Z,zt)=>(bn(M,D,"write to private field"),zt?zt.call(M,Z):D.set(M,Z),Z);(function(){"use strict";var Nt,_t,Ot,At,st;var M=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function D(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Z={exports:{}};(function(e,t){(function(n,r){r(e)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:M,function(n){var r,s;if(!((s=(r=globalThis.chrome)==null?void 0:r.runtime)!=null&&s.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const i="The message port closed before a response was received.",o=c=>{const a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class l extends WeakMap{constructor(w,x=void 0){super(x),this.createItem=w}get(w){return this.has(w)||this.set(w,this.createItem(w)),super.get(w)}}const d=h=>h&&typeof h=="object"&&typeof h.then=="function",u=(h,w)=>(...x)=>{c.runtime.lastError?h.reject(new Error(c.runtime.lastError.message)):w.singleCallbackArg||x.length<=1&&w.singleCallbackArg!==!1?h.resolve(x[0]):h.resolve(x)},E=h=>h==1?"argument":"arguments",T=(h,w)=>function(y,...C){if(C.length<w.minArgs)throw new Error(`Expected at least ${w.minArgs} ${E(w.minArgs)} for ${h}(), got ${C.length}`);if(C.length>w.maxArgs)throw new Error(`Expected at most ${w.maxArgs} ${E(w.maxArgs)} for ${h}(), got ${C.length}`);return new Promise((P,H)=>{if(w.fallbackToNoCallback)try{y[h](...C,u({resolve:P,reject:H},w))}catch(f){console.warn(`${h} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,f),y[h](...C),w.fallbackToNoCallback=!1,w.noCallback=!0,P()}else w.noCallback?(y[h](...C),P()):y[h](...C,u({resolve:P,reject:H},w))})},B=(h,w,x)=>new Proxy(w,{apply(y,C,P){return x.call(C,h,...P)}});let g=Function.call.bind(Object.prototype.hasOwnProperty);const A=(h,w={},x={})=>{let y=Object.create(null),C={has(H,f){return f in h||f in y},get(H,f,m){if(f in y)return y[f];if(!(f in h))return;let b=h[f];if(typeof b=="function")if(typeof w[f]=="function")b=B(h,h[f],w[f]);else if(g(x,f)){let U=T(f,x[f]);b=B(h,h[f],U)}else b=b.bind(h);else if(typeof b=="object"&&b!==null&&(g(w,f)||g(x,f)))b=A(b,w[f],x[f]);else if(g(x,"*"))b=A(b,w[f],x["*"]);else return Object.defineProperty(y,f,{configurable:!0,enumerable:!0,get(){return h[f]},set(U){h[f]=U}}),b;return y[f]=b,b},set(H,f,m,b){return f in y?y[f]=m:h[f]=m,!0},defineProperty(H,f,m){return Reflect.defineProperty(y,f,m)},deleteProperty(H,f){return Reflect.deleteProperty(y,f)}},P=Object.create(h);return new Proxy(P,C)},p=h=>({addListener(w,x,...y){w.addListener(h.get(x),...y)},hasListener(w,x){return w.hasListener(h.get(x))},removeListener(w,x){w.removeListener(h.get(x))}}),k=new l(h=>typeof h!="function"?h:function(x){const y=A(x,{},{getContent:{minArgs:0,maxArgs:0}});h(y)}),v=new l(h=>typeof h!="function"?h:function(x,y,C){let P=!1,H,f=new Promise(O=>{H=function($){P=!0,O($)}}),m;try{m=h(x,y,H)}catch(O){m=Promise.reject(O)}const b=m!==!0&&d(m);if(m!==!0&&!b&&!P)return!1;const U=O=>{O.then($=>{C($)},$=>{let j;$&&($ instanceof Error||typeof $.message=="string")?j=$.message:j="An unexpected error occurred",C({__mozWebExtensionPolyfillReject__:!0,message:j})}).catch($=>{console.error("Failed to send onMessage rejected reply",$)})};return U(b?m:f),!0}),L=({reject:h,resolve:w},x)=>{c.runtime.lastError?c.runtime.lastError.message===i?w():h(new Error(c.runtime.lastError.message)):x&&x.__mozWebExtensionPolyfillReject__?h(new Error(x.message)):w(x)},N=(h,w,x,...y)=>{if(y.length<w.minArgs)throw new Error(`Expected at least ${w.minArgs} ${E(w.minArgs)} for ${h}(), got ${y.length}`);if(y.length>w.maxArgs)throw new Error(`Expected at most ${w.maxArgs} ${E(w.maxArgs)} for ${h}(), got ${y.length}`);return new Promise((C,P)=>{const H=L.bind(null,{resolve:C,reject:P});y.push(H),x.sendMessage(...y)})},I={devtools:{network:{onRequestFinished:p(k)}},runtime:{onMessage:p(v),onMessageExternal:p(v),sendMessage:N.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:N.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},S={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":S},services:{"*":S},websites:{"*":S}},A(c,I,a)};n.exports=o(chrome)}else n.exports=globalThis.browser})})(Z);var zt=Z.exports;const z=D(zt),En="stork-prod-apps.auth.ap-northeast-1.amazoncognito.com",Bn="5msns4n49hmg3dftp2tp1t2iuh",In="https://app.stork.network",xe="https://app-api.jp.stork-oracle.network",kn="AUTH_STATE_CHANGED",Sn="INITIATE_LOGIN",vn="VALIDATION_UPDATE",be="ORACLE_VALIDATION",Dt="invalid_grant";async function Tn(e,t=3){for(let n=1;n<=t;n++)try{const r=await fetch(`https://${En}/oauth2/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",client_id:Bn,refresh_token:e})});if(!r.ok)throw r.status===400&&(await r.json()).error===Dt?new Error(Dt):new Error(`Token refresh failed with status: ${r.status}`);return await r.json()}catch(r){if(r instanceof Error&&r.message===Dt||(console.error(`Refresh attempt ${n}/${t} failed:`,r),n===t))throw r;await new Promise(s=>setTimeout(s,1e3))}}async function Nn(){try{const{accessToken:e,refreshToken:t}=await z.storage.local.get(["accessToken","refreshToken"]);if(!e||!t)return;const r=JSON.parse(atob(e.split(".")[1])).exp*1e3,s=3*60*1e3;if(Date.now()+s>=r){const i=await Tn(t);return await z.storage.local.set({accessToken:i.access_token,idToken:i.id_token}),i.access_token}return e}catch(e){throw e instanceof Error&&e.message===Dt?(console.log("Token expired, clearing auth state"),await z.storage.local.remove(["accessToken","idToken","refreshToken","isAuthenticated"])):console.error("Token refresh error:",e),e}}async function _n(){try{const e=z.identity.getRedirectURL(),t=new URL(In);t.searchParams.append("redirect_uri",e);const n=await z.identity.launchWebAuthFlow({url:t.toString(),interactive:!0}),r=new URL(n).searchParams,s=r.get("access_token"),i=r.get("id_token"),o=r.get("refresh_token");if(!s||!i||!o)throw new Error("Invalid response from Cognito");return await z.storage.local.set({accessToken:s,idToken:i,refreshToken:o,isAuthenticated:!0}),z.runtime.sendMessage({type:kn,isAuthenticated:!0}).catch(()=>{}),{success:!0}}catch(e){return console.error("Error during login:",e),{success:!1,error:e.message}}}const On=async e=>{const t=await fetch(`${xe}/v1/stork_signed_prices`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error(`Failed to get stork signed prices: ${t.status}`);const r=(await t.text()).replace(new RegExp('(?<!["\\d])\\b\\d{16,}\\b(?!["])',"g"),s=>`"${s}"`);return JSON.parse(r)},Un=async(e,t,n)=>{const r=await fetch(`${xe}/v1/stork_signed_prices/validations`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({msg_hash:t,valid:n})});if(!r.ok)throw new Error(`Failed to post validation: ${r.status}`);return r.json()},Ln="6.13.5";function Ee(e,t,n){for(let r in t){let s=t[r];Object.defineProperty(e,r,{enumerable:!0,value:s,writable:!1})}}function yt(e){if(e==null)return"null";if(Array.isArray(e))return"[ "+e.map(yt).join(", ")+" ]";if(e instanceof Uint8Array){const t="0123456789abcdef";let n="0x";for(let r=0;r<e.length;r++)n+=t[e[r]>>4],n+=t[e[r]&15];return n}if(typeof e=="object"&&typeof e.toJSON=="function")return yt(e.toJSON());switch(typeof e){case"boolean":case"symbol":return e.toString();case"bigint":return BigInt(e).toString();case"number":return e.toString();case"string":return JSON.stringify(e);case"object":{const t=Object.keys(e);return t.sort(),"{ "+t.map(n=>`${yt(n)}: ${yt(e[n])}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function Cn(e,t,n){let r=e;{const i=[];if(n){if("message"in n||"code"in n||"name"in n)throw new Error(`value will overwrite populated values: ${yt(n)}`);for(const o in n){if(o==="shortMessage")continue;const c=n[o];i.push(o+"="+yt(c))}}i.push(`code=${t}`),i.push(`version=${Ln}`),i.length&&(e+=" ("+i.join(", ")+")")}let s;switch(t){case"INVALID_ARGUMENT":s=new TypeError(e);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":s=new RangeError(e);break;default:s=new Error(e)}return Ee(s,{code:t}),n&&Object.assign(s,n),s.shortMessage==null&&Ee(s,{shortMessage:r}),s}function gt(e,t,n,r){if(!e)throw Cn(t,n,r)}function _(e,t,n,r){gt(e,t,"INVALID_ARGUMENT",{argument:n,value:r})}["NFD","NFC","NFKD","NFKC"].reduce((e,t)=>{try{if("test".normalize(t)!=="test")throw new Error("bad");if(t==="NFD"&&"é".normalize("NFD")!=="é")throw new Error("broken");e.push(t)}catch{}return e},[]);function $n(e,t,n){if(e!==t){let r=n,s="new";r+=".",s+=" "+n,gt(!1,`private constructor; use ${r}from* methods`,"UNSUPPORTED_OPERATION",{operation:s})}}function Be(e,t,n){if(e instanceof Uint8Array)return n?new Uint8Array(e):e;if(typeof e=="string"&&e.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const r=new Uint8Array((e.length-2)/2);let s=2;for(let i=0;i<r.length;i++)r[i]=parseInt(e.substring(s,s+2),16),s+=2;return r}_(!1,"invalid BytesLike value",t||"value",e)}function q(e,t){return Be(e,t,!1)}function Rt(e,t){return Be(e,t,!0)}function ee(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||typeof t=="number"&&e.length!==2+2*t||t===!0&&e.length%2!==0)}const Ie="0123456789abcdef";function F(e){const t=q(e);let n="0x";for(let r=0;r<t.length;r++){const s=t[r];n+=Ie[(s&240)>>4]+Ie[s&15]}return n}function Ht(e){return"0x"+e.map(t=>F(t).substring(2)).join("")}function xt(e){return ee(e,!0)?(e.length-2)/2:q(e).length}function ke(e,t,n){const r=q(e);gt(t>=r.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(r),length:t,offset:t+1});const s=new Uint8Array(t);return s.fill(0),n?s.set(r,t-r.length):s.set(r,0),F(s)}function Kt(e,t){return ke(e,t,!0)}function Pn(e,t){return ke(e,t,!1)}const ne=BigInt(0),qt=BigInt(1),bt=9007199254740991;function Rn(e,t){let n=Et(e,"value");const r=BigInt(Bt(t,"width")),s=qt<<r-qt;if(n<ne){n=-n,gt(n<=s,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e});const i=(qt<<r)-qt;return(~n&i)+qt}else gt(n<s,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:e});return n}function Et(e,t){switch(typeof e){case"bigint":return e;case"number":return _(Number.isInteger(e),"underflow",t||"value",e),_(e>=-bt&&e<=bt,"overflow",t||"value",e),BigInt(e);case"string":try{if(e==="")throw new Error("empty string");return e[0]==="-"&&e[1]!=="-"?-BigInt(e.substring(1)):BigInt(e)}catch(n){_(!1,`invalid BigNumberish string: ${n.message}`,t||"value",e)}}_(!1,"invalid BigNumberish value",t||"value",e)}function Se(e,t){const n=Et(e,t);return gt(n>=ne,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:e}),n}function Bt(e,t){switch(typeof e){case"bigint":return _(e>=-bt&&e<=bt,"overflow",t||"value",e),Number(e);case"number":return _(Number.isInteger(e),"underflow",t||"value",e),_(e>=-bt&&e<=bt,"overflow",t||"value",e),e;case"string":try{if(e==="")throw new Error("empty string");return Bt(BigInt(e),t)}catch(n){_(!1,`invalid numeric string: ${n.message}`,t||"value",e)}}_(!1,"invalid numeric value",t||"value",e)}function ve(e,t){let r=Se(e,"value").toString(16);{const s=Bt(t,"width");for(gt(s*2>=r.length,`value exceeds width (${s} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:e});r.length<s*2;)r="0"+r}return"0x"+r}function Te(e){const t=Se(e,"value");if(t===ne)return new Uint8Array([]);let n=t.toString(16);n.length%2&&(n="0"+n);const r=new Uint8Array(n.length/2);for(let s=0;s<r.length;s++){const i=s*2;r[s]=parseInt(n.substring(i,i+2),16)}return r}function Hn(e,t){_(typeof e=="string","invalid string value","str",e);let n=[];for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);if(s<128)n.push(s);else if(s<2048)n.push(s>>6|192),n.push(s&63|128);else if((s&64512)==55296){r++;const i=e.charCodeAt(r);_(r<e.length&&(i&64512)===56320,"invalid surrogate pair","str",e);const o=65536+((s&1023)<<10)+(i&1023);n.push(o>>18|240),n.push(o>>12&63|128),n.push(o>>6&63|128),n.push(o&63|128)}else n.push(s>>12|224),n.push(s>>6&63|128),n.push(s&63|128)}return new Uint8Array(n)}function Zt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function re(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function qn(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Zt(e.outputLen),Zt(e.blockLen)}function It(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ne(e,t){re(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const se=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _e=e=>e instanceof Uint8Array,Vn=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),ie=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),et=(e,t)=>e<<32-t|e>>>t;if(!(new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68))throw new Error("Non little-endian hardware is not supported");function Mn(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Gt(e){if(typeof e=="string"&&(e=Mn(e)),!_e(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function jn(...e){const t=new Uint8Array(e.reduce((r,s)=>r+s.length,0));let n=0;return e.forEach(r=>{if(!_e(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}class oe{clone(){return this._cloneInto()}}function Oe(e){const t=r=>e().update(Gt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Fn(e=32){if(se&&typeof se.getRandomValues=="function")return se.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class Ue extends oe{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,qn(t);const r=Gt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?t.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=t.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(t){return It(this),this.iHash.update(t),this}digestInto(t){It(this),re(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:s,destroyed:i,blockLen:o,outputLen:c}=this;return t=t,t.finished=s,t.destroyed=i,t.blockLen=o,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Le=(e,t,n)=>new Ue(e,t).update(n).digest();Le.create=(e,t)=>new Ue(e,t);function zn(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),c=Number(n&i),a=r?4:0,l=r?0:4;e.setUint32(t+a,o,r),e.setUint32(t+l,c,r)}class Dn extends oe{constructor(t,n,r,s){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ie(this.buffer)}update(t){It(this);const{view:n,buffer:r,blockLen:s}=this;t=Gt(t);const i=t.length;for(let o=0;o<i;){const c=Math.min(s-this.pos,i-o);if(c===s){const a=ie(t);for(;s<=i-o;o+=s)this.process(a,o);continue}r.set(t.subarray(o,o+c),this.pos),this.pos+=c,o+=c,this.pos===s&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){It(this),Ne(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:s,isLE:i}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let u=o;u<s;u++)n[u]=0;zn(r,s-8,BigInt(this.length*8),i),this.process(r,0);const c=ie(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)c.setUint32(4*u,d[u],i)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:s,finished:i,destroyed:o,pos:c}=this;return t.length=s,t.pos=c,t.finished=i,t.destroyed=o,s%n&&t.buffer.set(r),t}}const Kn=(e,t,n)=>e&t^~e&n,Zn=(e,t,n)=>e&t^e&n^t&n,Gn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),it=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ot=new Uint32Array(64);class Wn extends Dn{constructor(){super(64,32,8,!1),this.A=it[0]|0,this.B=it[1]|0,this.C=it[2]|0,this.D=it[3]|0,this.E=it[4]|0,this.F=it[5]|0,this.G=it[6]|0,this.H=it[7]|0}get(){const{A:t,B:n,C:r,D:s,E:i,F:o,G:c,H:a}=this;return[t,n,r,s,i,o,c,a]}set(t,n,r,s,i,o,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=c|0,this.H=a|0}process(t,n){for(let u=0;u<16;u++,n+=4)ot[u]=t.getUint32(n,!1);for(let u=16;u<64;u++){const E=ot[u-15],T=ot[u-2],B=et(E,7)^et(E,18)^E>>>3,g=et(T,17)^et(T,19)^T>>>10;ot[u]=g+ot[u-7]+B+ot[u-16]|0}let{A:r,B:s,C:i,D:o,E:c,F:a,G:l,H:d}=this;for(let u=0;u<64;u++){const E=et(c,6)^et(c,11)^et(c,25),T=d+E+Kn(c,a,l)+Gn[u]+ot[u]|0,g=(et(r,2)^et(r,13)^et(r,22))+Zn(r,s,i)|0;d=l,l=a,a=c,c=o+T|0,o=i,i=s,s=r,r=T+g|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,c=c+this.E|0,a=a+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(r,s,i,o,c,a,l,d)}roundClean(){ot.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Yn=Oe(()=>new Wn),Wt=BigInt(2**32-1),Ce=BigInt(32);function Xn(e,t=!1){return t?{h:Number(e&Wt),l:Number(e>>Ce&Wt)}:{h:Number(e>>Ce&Wt)|0,l:Number(e&Wt)|0}}function Jn(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let s=0;s<e.length;s++){const{h:i,l:o}=Xn(e[s],t);[n[s],r[s]]=[i,o]}return[n,r]}const Qn=(e,t,n)=>e<<n|t>>>32-n,tr=(e,t,n)=>t<<n|e>>>32-n,er=(e,t,n)=>t<<n-32|e>>>64-n,nr=(e,t,n)=>e<<n-32|t>>>64-n,[$e,Pe,Re]=[[],[],[]],rr=BigInt(0),Vt=BigInt(1),sr=BigInt(2),ir=BigInt(7),or=BigInt(256),cr=BigInt(113);for(let e=0,t=Vt,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],$e.push(2*(5*r+n)),Pe.push((e+1)*(e+2)/2%64);let s=rr;for(let i=0;i<7;i++)t=(t<<Vt^(t>>ir)*cr)%or,t&sr&&(s^=Vt<<(Vt<<BigInt(i))-Vt);Re.push(s)}const[ar,lr]=Jn(Re,!0),He=(e,t,n)=>n>32?er(e,t,n):Qn(e,t,n),qe=(e,t,n)=>n>32?nr(e,t,n):tr(e,t,n);function fr(e,t=24){const n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let o=0;o<10;o++)n[o]=e[o]^e[o+10]^e[o+20]^e[o+30]^e[o+40];for(let o=0;o<10;o+=2){const c=(o+8)%10,a=(o+2)%10,l=n[a],d=n[a+1],u=He(l,d,1)^n[c],E=qe(l,d,1)^n[c+1];for(let T=0;T<50;T+=10)e[o+T]^=u,e[o+T+1]^=E}let s=e[2],i=e[3];for(let o=0;o<24;o++){const c=Pe[o],a=He(s,i,c),l=qe(s,i,c),d=$e[o];s=e[d],i=e[d+1],e[d]=a,e[d+1]=l}for(let o=0;o<50;o+=10){for(let c=0;c<10;c++)n[c]=e[o+c];for(let c=0;c<10;c++)e[o+c]^=~n[(c+2)%10]&n[(c+4)%10]}e[0]^=ar[r],e[1]^=lr[r]}n.fill(0)}class ce extends oe{constructor(t,n,r,s=!1,i=24){if(super(),this.blockLen=t,this.suffix=n,this.outputLen=r,this.enableXOF=s,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Zt(r),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Vn(this.state)}keccak(){fr(this.state32,this.rounds),this.posOut=0,this.pos=0}update(t){It(this);const{blockLen:n,state:r}=this;t=Gt(t);const s=t.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);for(let c=0;c<o;c++)r[this.pos++]^=t[i++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:r,blockLen:s}=this;t[r]^=n,n&128&&r===s-1&&this.keccak(),t[s-1]^=128,this.keccak()}writeInto(t){It(this,!1),re(t),this.finish();const n=this.state,{blockLen:r}=this;for(let s=0,i=t.length;s<i;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,i-s);t.set(n.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Zt(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Ne(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:n,suffix:r,outputLen:s,rounds:i,enableXOF:o}=this;return t||(t=new ce(n,r,s,o,i)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=i,t.suffix=r,t.outputLen=s,t.enableXOF=o,t.destroyed=this.destroyed,t}}const ur=((e,t,n)=>Oe(()=>new ce(t,e,n)))(1,136,256/8);let Ve=!1;const Me=function(e){return ur(e)};let je=Me;function ct(e){const t=q(e,"data");return F(je(t))}ct._=Me,ct.lock=function(){Ve=!0},ct.register=function(e){if(Ve)throw new TypeError("keccak256 is locked");je=e},Object.freeze(ct);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fe=BigInt(0),Yt=BigInt(1),gr=BigInt(2),Xt=e=>e instanceof Uint8Array,hr=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function kt(e){if(!Xt(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=hr[e[n]];return t}function ze(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function ae(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function St(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const s=r*2,i=e.slice(s,s+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function ht(e){return ae(kt(e))}function le(e){if(!Xt(e))throw new Error("Uint8Array expected");return ae(kt(Uint8Array.from(e).reverse()))}function vt(e,t){return St(e.toString(16).padStart(t*2,"0"))}function fe(e,t){return vt(e,t).reverse()}function dr(e){return St(ze(e))}function X(e,t,n){let r;if(typeof t=="string")try{r=St(t)}catch(i){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${i}`)}else if(Xt(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const s=r.length;if(typeof n=="number"&&s!==n)throw new Error(`${e} expected ${n} bytes, got ${s}`);return r}function Mt(...e){const t=new Uint8Array(e.reduce((r,s)=>r+s.length,0));let n=0;return e.forEach(r=>{if(!Xt(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function mr(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ar(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function pr(e){let t;for(t=0;e>Fe;e>>=Yt,t+=1);return t}function wr(e,t){return e>>BigInt(t)&Yt}const yr=(e,t,n)=>e|(n?Yt:Fe)<<BigInt(t),ue=e=>(gr<<BigInt(e-1))-Yt,ge=e=>new Uint8Array(e),De=e=>Uint8Array.from(e);function Ke(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=ge(e),s=ge(e),i=0;const o=()=>{r.fill(1),s.fill(0),i=0},c=(...u)=>n(s,r,...u),a=(u=ge())=>{s=c(De([0]),u),r=c(),u.length!==0&&(s=c(De([1]),u),r=c())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const E=[];for(;u<t;){r=c();const T=r.slice();E.push(T),u+=r.length}return Mt(...E)};return(u,E)=>{o(),a(u);let T;for(;!(T=E(l()));)a();return o(),T}}const xr={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function jt(e,t,n={}){const r=(s,i,o)=>{const c=xr[i];if(typeof c!="function")throw new Error(`Invalid validator "${i}", expected function`);const a=e[s];if(!(o&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(s)}=${a} (${typeof a}), expected ${i}`)};for(const[s,i]of Object.entries(t))r(s,i,!1);for(const[s,i]of Object.entries(n))r(s,i,!0);return e}const br=Object.freeze(Object.defineProperty({__proto__:null,bitGet:wr,bitLen:pr,bitMask:ue,bitSet:yr,bytesToHex:kt,bytesToNumberBE:ht,bytesToNumberLE:le,concatBytes:Mt,createHmacDrbg:Ke,ensureBytes:X,equalBytes:mr,hexToBytes:St,hexToNumber:ae,numberToBytesBE:vt,numberToBytesLE:fe,numberToHexUnpadded:ze,numberToVarBytesBE:dr,utf8ToBytes:Ar,validateObject:jt},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const V=BigInt(0),R=BigInt(1),dt=BigInt(2),Er=BigInt(3),he=BigInt(4),Ze=BigInt(5),Ge=BigInt(8);BigInt(9),BigInt(16);function K(e,t){const n=e%t;return n>=V?n:t+n}function Br(e,t,n){if(n<=V||t<V)throw new Error("Expected power/modulo > 0");if(n===R)return V;let r=R;for(;t>V;)t&R&&(r=r*e%n),e=e*e%n,t>>=R;return r}function W(e,t,n){let r=e;for(;t-- >V;)r*=r,r%=n;return r}function de(e,t){if(e===V||t<=V)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=K(e,t),r=t,s=V,i=R;for(;n!==V;){const c=r/n,a=r%n,l=s-i*c;r=n,n=a,s=i,i=l}if(r!==R)throw new Error("invert: does not exist");return K(s,t)}function Ir(e){const t=(e-R)/dt;let n,r,s;for(n=e-R,r=0;n%dt===V;n/=dt,r++);for(s=dt;s<e&&Br(s,t,e)!==e-R;s++);if(r===1){const o=(e+R)/he;return function(a,l){const d=a.pow(l,o);if(!a.eql(a.sqr(d),l))throw new Error("Cannot find square root");return d}}const i=(n+R)/dt;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let l=r,d=c.pow(c.mul(c.ONE,s),n),u=c.pow(a,i),E=c.pow(a,n);for(;!c.eql(E,c.ONE);){if(c.eql(E,c.ZERO))return c.ZERO;let T=1;for(let g=c.sqr(E);T<l&&!c.eql(g,c.ONE);T++)g=c.sqr(g);const B=c.pow(d,R<<BigInt(l-T-1));d=c.sqr(B),u=c.mul(u,B),E=c.mul(E,d),l=T}return u}}function kr(e){if(e%he===Er){const t=(e+R)/he;return function(r,s){const i=r.pow(s,t);if(!r.eql(r.sqr(i),s))throw new Error("Cannot find square root");return i}}if(e%Ge===Ze){const t=(e-Ze)/Ge;return function(r,s){const i=r.mul(s,dt),o=r.pow(i,t),c=r.mul(s,o),a=r.mul(r.mul(c,dt),o),l=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(l),s))throw new Error("Cannot find square root");return l}}return Ir(e)}const Sr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function vr(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Sr.reduce((r,s)=>(r[s]="function",r),t);return jt(e,n)}function Tr(e,t,n){if(n<V)throw new Error("Expected power > 0");if(n===V)return e.ONE;if(n===R)return t;let r=e.ONE,s=t;for(;n>V;)n&R&&(r=e.mul(r,s)),s=e.sqr(s),n>>=R;return r}function Nr(e,t){const n=new Array(t.length),r=t.reduce((i,o,c)=>e.is0(o)?i:(n[c]=i,e.mul(i,o)),e.ONE),s=e.inv(r);return t.reduceRight((i,o,c)=>e.is0(o)?i:(n[c]=e.mul(i,n[c]),e.mul(i,o)),s),n}function We(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function _r(e,t,n=!1,r={}){if(e<=V)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:s,nByteLength:i}=We(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=kr(e),c=Object.freeze({ORDER:e,BITS:s,BYTES:i,MASK:ue(s),ZERO:V,ONE:R,create:a=>K(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return V<=a&&a<e},is0:a=>a===V,isOdd:a=>(a&R)===R,neg:a=>K(-a,e),eql:(a,l)=>a===l,sqr:a=>K(a*a,e),add:(a,l)=>K(a+l,e),sub:(a,l)=>K(a-l,e),mul:(a,l)=>K(a*l,e),pow:(a,l)=>Tr(c,a,l),div:(a,l)=>K(a*de(l,e),e),sqrN:a=>a*a,addN:(a,l)=>a+l,subN:(a,l)=>a-l,mulN:(a,l)=>a*l,inv:a=>de(a,e),sqrt:r.sqrt||(a=>o(c,a)),invertBatch:a=>Nr(c,a),cmov:(a,l,d)=>d?l:a,toBytes:a=>n?fe(a,i):vt(a,i),fromBytes:a=>{if(a.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${a.length}`);return n?le(a):ht(a)}});return Object.freeze(c)}function Ye(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Xe(e){const t=Ye(e);return t+Math.ceil(t/2)}function Or(e,t,n=!1){const r=e.length,s=Ye(t),i=Xe(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const o=n?ht(e):le(e),c=K(o,t-R)+R;return n?fe(c,s):vt(c,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ur=BigInt(0),me=BigInt(1);function Lr(e,t){const n=(s,i)=>{const o=i.negate();return s?o:i},r=s=>{const i=Math.ceil(t/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:n,unsafeLadder(s,i){let o=e.ZERO,c=s;for(;i>Ur;)i&me&&(o=o.add(c)),c=c.double(),i>>=me;return o},precomputeWindow(s,i){const{windows:o,windowSize:c}=r(i),a=[];let l=s,d=l;for(let u=0;u<o;u++){d=l,a.push(d);for(let E=1;E<c;E++)d=d.add(l),a.push(d);l=d.double()}return a},wNAF(s,i,o){const{windows:c,windowSize:a}=r(s);let l=e.ZERO,d=e.BASE;const u=BigInt(2**s-1),E=2**s,T=BigInt(s);for(let B=0;B<c;B++){const g=B*a;let A=Number(o&u);o>>=T,A>a&&(A-=E,o+=me);const p=g,k=g+Math.abs(A)-1,v=B%2!==0,L=A<0;A===0?d=d.add(n(v,i[p])):l=l.add(n(L,i[k]))}return{p:l,f:d}},wNAFCached(s,i,o,c){const a=s._WINDOW_SIZE||1;let l=i.get(s);return l||(l=this.precomputeWindow(s,a),a!==1&&i.set(s,c(l))),this.wNAF(a,l,o)}}}function Je(e){return vr(e.Fp),jt(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...We(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Cr(e){const t=Je(e);jt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:s}=t;if(n){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:$r,hexToBytes:Pr}=br,mt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=mt;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:$r(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=mt,n=typeof e=="string"?Pr(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:s,l:i}=mt._parseInt(n.subarray(2)),{d:o,l:c}=mt._parseInt(i);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(e){const t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{const d=l.toString(16);return d.length&1?`0${d}`:d},r=t(n(e.s)),s=t(n(e.r)),i=r.length/2,o=s.length/2,c=n(i),a=n(o);return`30${n(o+i+4)}02${a}${s}02${c}${r}`}},rt=BigInt(0),Y=BigInt(1);BigInt(2);const Qe=BigInt(3);BigInt(4);function Rr(e){const t=Cr(e),{Fp:n}=t,r=t.toBytes||((B,g,A)=>{const p=g.toAffine();return Mt(Uint8Array.from([4]),n.toBytes(p.x),n.toBytes(p.y))}),s=t.fromBytes||(B=>{const g=B.subarray(1),A=n.fromBytes(g.subarray(0,n.BYTES)),p=n.fromBytes(g.subarray(n.BYTES,2*n.BYTES));return{x:A,y:p}});function i(B){const{a:g,b:A}=t,p=n.sqr(B),k=n.mul(p,B);return n.add(n.add(k,n.mul(B,g)),A)}if(!n.eql(n.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function o(B){return typeof B=="bigint"&&rt<B&&B<t.n}function c(B){if(!o(B))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(B){const{allowedPrivateKeyLengths:g,nByteLength:A,wrapPrivateKey:p,n:k}=t;if(g&&typeof B!="bigint"){if(B instanceof Uint8Array&&(B=kt(B)),typeof B!="string"||!g.includes(B.length))throw new Error("Invalid key");B=B.padStart(A*2,"0")}let v;try{v=typeof B=="bigint"?B:ht(X("private key",B,A))}catch{throw new Error(`private key must be ${A} bytes, hex or bigint, not ${typeof B}`)}return p&&(v=K(v,k)),c(v),v}const l=new Map;function d(B){if(!(B instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(g,A,p){if(this.px=g,this.py=A,this.pz=p,g==null||!n.isValid(g))throw new Error("x required");if(A==null||!n.isValid(A))throw new Error("y required");if(p==null||!n.isValid(p))throw new Error("z required")}static fromAffine(g){const{x:A,y:p}=g||{};if(!g||!n.isValid(A)||!n.isValid(p))throw new Error("invalid affine point");if(g instanceof u)throw new Error("projective point not allowed");const k=v=>n.eql(v,n.ZERO);return k(A)&&k(p)?u.ZERO:new u(A,p,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const A=n.invertBatch(g.map(p=>p.pz));return g.map((p,k)=>p.toAffine(A[k])).map(u.fromAffine)}static fromHex(g){const A=u.fromAffine(s(X("pointHex",g)));return A.assertValidity(),A}static fromPrivateKey(g){return u.BASE.multiply(a(g))}_setWindowSize(g){this._WINDOW_SIZE=g,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:A}=this.toAffine();if(!n.isValid(g)||!n.isValid(A))throw new Error("bad point: x or y not FE");const p=n.sqr(A),k=i(g);if(!n.eql(p,k))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(n.isOdd)return!n.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){d(g);const{px:A,py:p,pz:k}=this,{px:v,py:L,pz:N}=g,I=n.eql(n.mul(A,N),n.mul(v,k)),S=n.eql(n.mul(p,N),n.mul(L,k));return I&&S}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:g,b:A}=t,p=n.mul(A,Qe),{px:k,py:v,pz:L}=this;let N=n.ZERO,I=n.ZERO,S=n.ZERO,h=n.mul(k,k),w=n.mul(v,v),x=n.mul(L,L),y=n.mul(k,v);return y=n.add(y,y),S=n.mul(k,L),S=n.add(S,S),N=n.mul(g,S),I=n.mul(p,x),I=n.add(N,I),N=n.sub(w,I),I=n.add(w,I),I=n.mul(N,I),N=n.mul(y,N),S=n.mul(p,S),x=n.mul(g,x),y=n.sub(h,x),y=n.mul(g,y),y=n.add(y,S),S=n.add(h,h),h=n.add(S,h),h=n.add(h,x),h=n.mul(h,y),I=n.add(I,h),x=n.mul(v,L),x=n.add(x,x),h=n.mul(x,y),N=n.sub(N,h),S=n.mul(x,w),S=n.add(S,S),S=n.add(S,S),new u(N,I,S)}add(g){d(g);const{px:A,py:p,pz:k}=this,{px:v,py:L,pz:N}=g;let I=n.ZERO,S=n.ZERO,h=n.ZERO;const w=t.a,x=n.mul(t.b,Qe);let y=n.mul(A,v),C=n.mul(p,L),P=n.mul(k,N),H=n.add(A,p),f=n.add(v,L);H=n.mul(H,f),f=n.add(y,C),H=n.sub(H,f),f=n.add(A,k);let m=n.add(v,N);return f=n.mul(f,m),m=n.add(y,P),f=n.sub(f,m),m=n.add(p,k),I=n.add(L,N),m=n.mul(m,I),I=n.add(C,P),m=n.sub(m,I),h=n.mul(w,f),I=n.mul(x,P),h=n.add(I,h),I=n.sub(C,h),h=n.add(C,h),S=n.mul(I,h),C=n.add(y,y),C=n.add(C,y),P=n.mul(w,P),f=n.mul(x,f),C=n.add(C,P),P=n.sub(y,P),P=n.mul(w,P),f=n.add(f,P),y=n.mul(C,f),S=n.add(S,y),y=n.mul(m,f),I=n.mul(H,I),I=n.sub(I,y),y=n.mul(H,C),h=n.mul(m,h),h=n.add(h,y),new u(I,S,h)}subtract(g){return this.add(g.negate())}is0(){return this.equals(u.ZERO)}wNAF(g){return T.wNAFCached(this,l,g,A=>{const p=n.invertBatch(A.map(k=>k.pz));return A.map((k,v)=>k.toAffine(p[v])).map(u.fromAffine)})}multiplyUnsafe(g){const A=u.ZERO;if(g===rt)return A;if(c(g),g===Y)return this;const{endo:p}=t;if(!p)return T.unsafeLadder(this,g);let{k1neg:k,k1:v,k2neg:L,k2:N}=p.splitScalar(g),I=A,S=A,h=this;for(;v>rt||N>rt;)v&Y&&(I=I.add(h)),N&Y&&(S=S.add(h)),h=h.double(),v>>=Y,N>>=Y;return k&&(I=I.negate()),L&&(S=S.negate()),S=new u(n.mul(S.px,p.beta),S.py,S.pz),I.add(S)}multiply(g){c(g);let A=g,p,k;const{endo:v}=t;if(v){const{k1neg:L,k1:N,k2neg:I,k2:S}=v.splitScalar(A);let{p:h,f:w}=this.wNAF(N),{p:x,f:y}=this.wNAF(S);h=T.constTimeNegate(L,h),x=T.constTimeNegate(I,x),x=new u(n.mul(x.px,v.beta),x.py,x.pz),p=h.add(x),k=w.add(y)}else{const{p:L,f:N}=this.wNAF(A);p=L,k=N}return u.normalizeZ([p,k])[0]}multiplyAndAddUnsafe(g,A,p){const k=u.BASE,v=(N,I)=>I===rt||I===Y||!N.equals(k)?N.multiplyUnsafe(I):N.multiply(I),L=v(this,A).add(v(g,p));return L.is0()?void 0:L}toAffine(g){const{px:A,py:p,pz:k}=this,v=this.is0();g==null&&(g=v?n.ONE:n.inv(k));const L=n.mul(A,g),N=n.mul(p,g),I=n.mul(k,g);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(I,n.ONE))throw new Error("invZ was invalid");return{x:L,y:N}}isTorsionFree(){const{h:g,isTorsionFree:A}=t;if(g===Y)return!0;if(A)return A(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:A}=t;return g===Y?this:A?A(u,this):this.multiplyUnsafe(t.h)}toRawBytes(g=!0){return this.assertValidity(),r(u,this,g)}toHex(g=!0){return kt(this.toRawBytes(g))}}u.BASE=new u(t.Gx,t.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const E=t.nBitLength,T=Lr(u,t.endo?Math.ceil(E/2):E);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:o}}function Hr(e){const t=Je(e);return jt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function qr(e){const t=Hr(e),{Fp:n,n:r}=t,s=n.BYTES+1,i=2*n.BYTES+1;function o(f){return rt<f&&f<n.ORDER}function c(f){return K(f,r)}function a(f){return de(f,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:d,weierstrassEquation:u,isWithinCurveOrder:E}=Rr({...t,toBytes(f,m,b){const U=m.toAffine(),O=n.toBytes(U.x),$=Mt;return b?$(Uint8Array.from([m.hasEvenY()?2:3]),O):$(Uint8Array.from([4]),O,n.toBytes(U.y))},fromBytes(f){const m=f.length,b=f[0],U=f.subarray(1);if(m===s&&(b===2||b===3)){const O=ht(U);if(!o(O))throw new Error("Point is not on curve");const $=u(O);let j=n.sqrt($);const G=(j&Y)===Y;return(b&1)===1!==G&&(j=n.neg(j)),{x:O,y:j}}else if(m===i&&b===4){const O=n.fromBytes(U.subarray(0,n.BYTES)),$=n.fromBytes(U.subarray(n.BYTES,2*n.BYTES));return{x:O,y:$}}else throw new Error(`Point of length ${m} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),T=f=>kt(vt(f,t.nByteLength));function B(f){const m=r>>Y;return f>m}function g(f){return B(f)?c(-f):f}const A=(f,m,b)=>ht(f.slice(m,b));class p{constructor(m,b,U){this.r=m,this.s=b,this.recovery=U,this.assertValidity()}static fromCompact(m){const b=t.nByteLength;return m=X("compactSignature",m,b*2),new p(A(m,0,b),A(m,b,2*b))}static fromDER(m){const{r:b,s:U}=mt.toSig(X("DER",m));return new p(b,U)}assertValidity(){if(!E(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!E(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(m){return new p(this.r,this.s,m)}recoverPublicKey(m){const{r:b,s:U,recovery:O}=this,$=S(X("msgHash",m));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const j=O===2||O===3?b+t.n:b;if(j>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const G=O&1?"03":"02",lt=l.fromHex(G+T(j)),ft=a(j),Ut=c(-$*ft),Ft=c(U*ft),ut=l.BASE.multiplyAndAddUnsafe(lt,Ut,Ft);if(!ut)throw new Error("point at infinify");return ut.assertValidity(),ut}hasHighS(){return B(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return St(this.toDERHex())}toDERHex(){return mt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return St(this.toCompactHex())}toCompactHex(){return T(this.r)+T(this.s)}}const k={isValidPrivateKey(f){try{return d(f),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const f=Xe(t.n);return Or(t.randomBytes(f),t.n)},precompute(f=8,m=l.BASE){return m._setWindowSize(f),m.multiply(BigInt(3)),m}};function v(f,m=!0){return l.fromPrivateKey(f).toRawBytes(m)}function L(f){const m=f instanceof Uint8Array,b=typeof f=="string",U=(m||b)&&f.length;return m?U===s||U===i:b?U===2*s||U===2*i:f instanceof l}function N(f,m,b=!0){if(L(f))throw new Error("first arg must be private key");if(!L(m))throw new Error("second arg must be public key");return l.fromHex(m).multiply(d(f)).toRawBytes(b)}const I=t.bits2int||function(f){const m=ht(f),b=f.length*8-t.nBitLength;return b>0?m>>BigInt(b):m},S=t.bits2int_modN||function(f){return c(I(f))},h=ue(t.nBitLength);function w(f){if(typeof f!="bigint")throw new Error("bigint expected");if(!(rt<=f&&f<h))throw new Error(`bigint expected < 2^${t.nBitLength}`);return vt(f,t.nByteLength)}function x(f,m,b=y){if(["recovered","canonical"].some(wt=>wt in b))throw new Error("sign() legacy options not supported");const{hash:U,randomBytes:O}=t;let{lowS:$,prehash:j,extraEntropy:G}=b;$==null&&($=!0),f=X("msgHash",f),j&&(f=X("prehashed msgHash",U(f)));const lt=S(f),ft=d(m),Ut=[w(ft),w(lt)];if(G!=null){const wt=G===!0?O(n.BYTES):G;Ut.push(X("extraEntropy",wt))}const Ft=Mt(...Ut),ut=lt;function ye(wt){const Lt=I(wt);if(!E(Lt))return;const pn=a(Lt),Ct=l.BASE.multiply(Lt).toAffine(),Q=c(Ct.x);if(Q===rt)return;const $t=c(pn*c(ut+Q*ft));if($t===rt)return;let wn=(Ct.x===Q?0:2)|Number(Ct.y&Y),yn=$t;return $&&B($t)&&(yn=g($t),wn^=1),new p(Q,yn,wn)}return{seed:Ft,k2sig:ye}}const y={lowS:t.lowS,prehash:!1},C={lowS:t.lowS,prehash:!1};function P(f,m,b=y){const{seed:U,k2sig:O}=x(f,m,b),$=t;return Ke($.hash.outputLen,$.nByteLength,$.hmac)(U,O)}l.BASE._setWindowSize(8);function H(f,m,b,U=C){var Ct;const O=f;if(m=X("msgHash",m),b=X("publicKey",b),"strict"in U)throw new Error("options.strict was renamed to lowS");const{lowS:$,prehash:j}=U;let G,lt;try{if(typeof O=="string"||O instanceof Uint8Array)try{G=p.fromDER(O)}catch(Q){if(!(Q instanceof mt.Err))throw Q;G=p.fromCompact(O)}else if(typeof O=="object"&&typeof O.r=="bigint"&&typeof O.s=="bigint"){const{r:Q,s:$t}=O;G=new p(Q,$t)}else throw new Error("PARSE");lt=l.fromHex(b)}catch(Q){if(Q.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if($&&G.hasHighS())return!1;j&&(m=t.hash(m));const{r:ft,s:Ut}=G,Ft=S(m),ut=a(Ut),ye=c(Ft*ut),wt=c(ft*ut),Lt=(Ct=l.BASE.multiplyAndAddUnsafe(lt,ye,wt))==null?void 0:Ct.toAffine();return Lt?c(Lt.x)===ft:!1}return{CURVE:t,getPublicKey:v,getSharedSecret:N,sign:P,verify:H,ProjectivePoint:l,Signature:p,utils:k}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Vr(e){return{hash:e,hmac:(t,...n)=>Le(e,t,jn(...n)),randomBytes:Fn}}function Mr(e,t){const n=r=>qr({...e,...Vr(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const tn=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),en=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),jr=BigInt(1),Ae=BigInt(2),nn=(e,t)=>(e+t/Ae)/t;function Fr(e){const t=tn,n=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),c=BigInt(44),a=BigInt(88),l=e*e*e%t,d=l*l*e%t,u=W(d,n,t)*d%t,E=W(u,n,t)*d%t,T=W(E,Ae,t)*l%t,B=W(T,s,t)*T%t,g=W(B,i,t)*B%t,A=W(g,c,t)*g%t,p=W(A,a,t)*A%t,k=W(p,c,t)*g%t,v=W(k,n,t)*d%t,L=W(v,o,t)*B%t,N=W(L,r,t)*l%t,I=W(N,Ae,t);if(!pe.eql(pe.sqr(I),e))throw new Error("Cannot find square root");return I}const pe=_r(tn,void 0,void 0,{sqrt:Fr}),at=Mr({a:BigInt(0),b:BigInt(7),Fp:pe,n:en,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=en,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-jr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,o=BigInt("0x100000000000000000000000000000000"),c=nn(i*e,t),a=nn(-r*e,t);let l=K(e-c*n-a*s,t),d=K(-c*r-a*i,t);const u=l>o,E=d>o;if(u&&(l=t-l),E&&(d=t-d),l>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:l,k2neg:E,k2:d}}}},Yn);BigInt(0),at.ProjectivePoint;const rn="0x0000000000000000000000000000000000000000000000000000000000000000",sn=BigInt(0),on=BigInt(1),cn=BigInt(2),an=BigInt(27),ln=BigInt(28),Jt=BigInt(35),Tt={};function fn(e){return Kt(Te(e),32)}const J=class J{constructor(t,n,r,s){Pt(this,Nt);Pt(this,_t);Pt(this,Ot);Pt(this,At);$n(t,Tt,"Signature"),tt(this,Nt,n),tt(this,_t,r),tt(this,Ot,s),tt(this,At,null)}get r(){return nt(this,Nt)}set r(t){_(xt(t)===32,"invalid r","value",t),tt(this,Nt,F(t))}get s(){return nt(this,_t)}set s(t){_(xt(t)===32,"invalid s","value",t);const n=F(t);_(parseInt(n.substring(0,3))<8,"non-canonical s","value",n),tt(this,_t,n)}get v(){return nt(this,Ot)}set v(t){const n=Bt(t,"value");_(n===27||n===28,"invalid v","v",t),tt(this,Ot,n)}get networkV(){return nt(this,At)}get legacyChainId(){const t=this.networkV;return t==null?null:J.getChainId(t)}get yParity(){return this.v===27?0:1}get yParityAndS(){const t=q(this.s);return this.yParity&&(t[0]|=128),F(t)}get compactSerialized(){return Ht([this.r,this.yParityAndS])}get serialized(){return Ht([this.r,this.s,this.yParity?"0x1c":"0x1b"])}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this.s}", yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const t=new J(Tt,this.r,this.s,this.v);return this.networkV&&tt(t,At,this.networkV),t}toJSON(){const t=this.networkV;return{_type:"signature",networkV:t!=null?t.toString():null,r:this.r,s:this.s,v:this.v}}static getChainId(t){const n=Et(t,"v");return n==an||n==ln?sn:(_(n>=Jt,"invalid EIP-155 v","v",t),(n-Jt)/cn)}static getChainIdV(t,n){return Et(t)*cn+BigInt(35+n-27)}static getNormalizedV(t){const n=Et(t);return n===sn||n===an?27:n===on||n===ln?28:(_(n>=Jt,"invalid v","v",t),n&on?27:28)}static from(t){function n(l,d){_(l,d,"signature",t)}if(t==null)return new J(Tt,rn,rn,27);if(typeof t=="string"){const l=q(t,"signature");if(l.length===64){const d=F(l.slice(0,32)),u=l.slice(32,64),E=u[0]&128?28:27;return u[0]&=127,new J(Tt,d,F(u),E)}if(l.length===65){const d=F(l.slice(0,32)),u=l.slice(32,64);n((u[0]&128)===0,"non-canonical s");const E=J.getNormalizedV(l[64]);return new J(Tt,d,F(u),E)}n(!1,"invalid raw signature length")}if(t instanceof J)return t.clone();const r=t.r;n(r!=null,"missing r");const s=fn(r),i=function(l,d){if(l!=null)return fn(l);if(d!=null){n(ee(d,32),"invalid yParityAndS");const u=q(d);return u[0]&=127,F(u)}n(!1,"missing s")}(t.s,t.yParityAndS);n((q(i)[0]&128)==0,"non-canonical s");const{networkV:o,v:c}=function(l,d,u){if(l!=null){const E=Et(l);return{networkV:E>=Jt?E:void 0,v:J.getNormalizedV(E)}}if(d!=null)return n(ee(d,32),"invalid yParityAndS"),{v:q(d)[0]&128?28:27};if(u!=null){switch(Bt(u,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}n(!1,"invalid yParity")}n(!1,"missing v")}(t.v,t.yParityAndS,t.yParity),a=new J(Tt,s,i,c);return o&&tt(a,At,o),n(t.yParity==null||Bt(t.yParity,"sig.yParity")===a.yParity,"yParity mismatch"),n(t.yParityAndS==null||t.yParityAndS===a.yParityAndS,"yParityAndS mismatch"),a}};Nt=new WeakMap,_t=new WeakMap,Ot=new WeakMap,At=new WeakMap;let Qt=J;const pt=class pt{constructor(t){Pt(this,st);_(xt(t)===32,"invalid private key","privateKey","[REDACTED]"),tt(this,st,F(t))}get privateKey(){return nt(this,st)}get publicKey(){return pt.computePublicKey(nt(this,st))}get compressedPublicKey(){return pt.computePublicKey(nt(this,st),!0)}sign(t){_(xt(t)===32,"invalid digest length","digest",t);const n=at.sign(Rt(t),Rt(nt(this,st)),{lowS:!0});return Qt.from({r:ve(n.r,32),s:ve(n.s,32),v:n.recovery?28:27})}computeSharedSecret(t){const n=pt.computePublicKey(t);return F(at.getSharedSecret(Rt(nt(this,st)),q(n),!1))}static computePublicKey(t,n){let r=q(t,"key");if(r.length===32){const i=at.getPublicKey(r,!!n);return F(i)}if(r.length===64){const i=new Uint8Array(65);i[0]=4,i.set(r,1),r=i}const s=at.ProjectivePoint.fromHex(r);return F(s.toRawBytes(n))}static recoverPublicKey(t,n){_(xt(t)===32,"invalid digest length","digest",t);const r=Qt.from(n);let s=at.Signature.fromCompact(Rt(Ht([r.r,r.s])));s=s.addRecoveryBit(r.yParity);const i=s.recoverPublicKey(Rt(t));return _(i!=null,"invalid signautre for digest","signature",n),"0x"+i.toHex(!1)}static addPoints(t,n,r){const s=at.ProjectivePoint.fromHex(pt.computePublicKey(t).substring(2)),i=at.ProjectivePoint.fromHex(pt.computePublicKey(n).substring(2));return"0x"+s.add(i).toHex(!!r)}};st=new WeakMap;let te=pt;const zr=BigInt(0),Dr=BigInt(36);function un(e){e=e.toLowerCase();const t=e.substring(2).split(""),n=new Uint8Array(40);for(let s=0;s<40;s++)n[s]=t[s].charCodeAt(0);const r=q(ct(n));for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&(t[s]=t[s].toUpperCase()),(r[s>>1]&15)>=8&&(t[s+1]=t[s+1].toUpperCase());return"0x"+t.join("")}const we={};for(let e=0;e<10;e++)we[String(e)]=String(e);for(let e=0;e<26;e++)we[String.fromCharCode(65+e)]=String(10+e);const gn=15;function Kr(e){e=e.toUpperCase(),e=e.substring(4)+e.substring(0,2)+"00";let t=e.split("").map(r=>we[r]).join("");for(;t.length>=gn;){let r=t.substring(0,gn);t=parseInt(r,10)%97+t.substring(r.length)}let n=String(98-parseInt(t,10)%97);for(;n.length<2;)n="0"+n;return n}const Zr=function(){const e={};for(let t=0;t<36;t++){const n="0123456789abcdefghijklmnopqrstuvwxyz"[t];e[n]=BigInt(t)}return e}();function Gr(e){e=e.toLowerCase();let t=zr;for(let n=0;n<e.length;n++)t=t*Dr+Zr[e[n]];return t}function hn(e){if(_(typeof e=="string","invalid address","address",e),e.match(/^(0x)?[0-9a-fA-F]{40}$/)){e.startsWith("0x")||(e="0x"+e);const t=un(e);return _(!e.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||t===e,"bad address checksum","address",e),t}if(e.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){_(e.substring(2,4)===Kr(e),"bad icap checksum","address",e);let t=Gr(e.substring(4)).toString(16);for(;t.length<40;)t="0"+t;return un("0x"+t)}_(!1,"invalid address","address",e)}function Wr(e){let t;return typeof e=="string"?t=te.computePublicKey(e,!1):t=e.publicKey,hn(ct("0x"+t.substring(4)).substring(26))}function Yr(e,t){return Wr(te.recoverPublicKey(e,t))}const Xr=new RegExp("^bytes([0-9]+)$"),Jr=new RegExp("^(u?int)([0-9]*)$"),Qr=new RegExp("^(.*)\\[([0-9]*)\\]$");function dn(e,t,n){switch(e){case"address":return q(n?Kt(t,32):hn(t));case"string":return Hn(t);case"bytes":return q(t);case"bool":return t=t?"0x01":"0x00",q(n?Kt(t,32):t)}let r=e.match(Jr);if(r){let s=r[1]==="int",i=parseInt(r[2]||"256");return _((!r[2]||r[2]===String(i))&&i%8===0&&i!==0&&i<=256,"invalid number type","type",e),n&&(i=256),s&&(t=Rn(t,i)),q(Kt(Te(t),i/8))}if(r=e.match(Xr),r){const s=parseInt(r[1]);return _(String(s)===r[1]&&s!==0&&s<=32,"invalid bytes type","type",e),_(xt(t)===s,`invalid value for ${e}`,"value",t),n?q(Pn(t,32)):t}if(r=e.match(Qr),r&&Array.isArray(t)){const s=r[1],i=parseInt(r[2]||String(t.length));_(i===t.length,`invalid array length for ${e}`,"value",t);const o=[];return t.forEach(function(c){o.push(dn(s,c,!0))}),q(Ht(o))}_(!1,"invalid type","type",e)}function mn(e,t){_(e.length===t.length,"wrong number of values; expected ${ types.length }","values",t);const n=[];return e.forEach(function(r,s){n.push(dn(r,t[s]))}),F(Ht(n))}function ts(e){const t=e.timestamped_signature.signature,n=e.timestamped_signature.msg_hash,r=e.public_key,s=e.encoded_asset_id,i=e.timestamped_signature.timestamp,o=e.publisher_merkle_root,c=e.calculation_alg.checksum,a=e.price,l=["address","bytes32","uint256","int256","bytes32","bytes32"],d=[r,s,i.toString(),a,o,"0x"+c],u=mn(l,d),E=ct(u),g=mn(["string","bytes32"],[`Ethereum Signed Message:
32`,E]),A=ct(g),p=Yr(A,t);return n===E&&p===r}const es=async()=>{const{isAuthenticated:e}=await z.storage.local.get(["isAuthenticated"]),{isVerifying:t}=await z.storage.local.get(["isVerifying"]);if(!(!e||!t))try{const n=await Nn(),r=await On(n);let s=0,i=0;const o=Date.now();for(const a in r.data){const l=r.data[a],d=ts(l);await Un(n,l.timestamped_signature.msg_hash,d),d?s++:i++}const c=Date.now();z.runtime.sendMessage({type:vn,timestamp:c,validationCount:s,failedValidationCount:i,durationMs:c-o})}catch(n){console.error("Validation error:",n)}},An=()=>{z.alarms.create(be,{periodInMinutes:5})};z.runtime.onInstalled.addListener(async()=>{try{An()}catch(e){console.error("Error during initialization:",e)}}),z.runtime.onStartup.addListener(async()=>{try{An()}catch(e){console.error("Error during initialization:",e)}}),z.alarms.onAlarm.addListener(e=>{e.name===be&&es()}),z.runtime.onMessage.addListener(async e=>{if(e.type===Sn)return await _n()})})();
